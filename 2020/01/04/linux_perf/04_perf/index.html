<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>2.2 perf 的原理与使用 | 宋涛的博客</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Linux性能调优" />
    
    <meta name="description" content="perf 感觉像是一个完全版的 top，可以帮助我们看到操作系统运行的全貌。perf 的使用非常复杂，本文只是一个入门，推荐大家去阅读大神 Brendangregg 的文章perf Examples。">
<meta name="keywords" content="Linux性能调优">
<meta property="og:type" content="article">
<meta property="og:title" content="2.2 perf 的原理与使用">
<meta property="og:url" content="http://yoursite.com/2020/01/04/linux_perf/04_perf/index.html">
<meta property="og:site_name" content="宋涛的博客">
<meta property="og:description" content="perf 感觉像是一个完全版的 top，可以帮助我们看到操作系统运行的全貌。perf 的使用非常复杂，本文只是一个入门，推荐大家去阅读大神 Brendangregg 的文章perf Examples。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/linux_pf/perf_events_map.png">
<meta property="og:updated_time" content="2020-06-01T13:46:07.194Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2.2 perf 的原理与使用">
<meta name="twitter:description" content="perf 感觉像是一个完全版的 top，可以帮助我们看到操作系统运行的全貌。perf 的使用非常复杂，本文只是一个入门，推荐大家去阅读大神 Brendangregg 的文章perf Examples。">
<meta name="twitter:image" content="http://yoursite.com/images/linux_pf/perf_events_map.png">
    

    
        <link rel="alternate" href="/" title="宋涛的博客" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">漫步在大陆上的海龟</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Go/">Go</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Python/">Python</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/分布式/">分布式</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/存储/">存储</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/运维/">运维</a></li></ul>
                                    
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/运维/">运维</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-linux_perf/04_perf" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        2.2 perf 的原理与使用
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2020/01/04/linux_perf/04_perf/" class="article-date">
            <time datetime="2020-01-03T16:00:00.000Z" itemprop="datePublished">2020-01-04</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Linux性能调优/">Linux性能调优<span class="tag-count">38</span></a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>perf 感觉像是一个完全版的 top，可以帮助我们看到操作系统运行的全貌。perf 的使用非常复杂，本文只是一个入门，推荐大家去阅读大神 Brendangregg 的文章<a href="http://www.brendangregg.com/perf.html" target="_blank" rel="external">perf Examples</a>。</p>
<a id="more"></a>
<h2 id="1-perf-简介"><a href="#1-perf-简介" class="headerlink" title="1. perf 简介"></a>1. perf 简介</h2><p>perf的原理是这样的：每隔一个固定的时间，就在CPU上（每个核上都有）产生一个中断，在中断上看看，当前是哪个pid，哪个函数，然后给对应的pid和函数加一个统计值，这样，我们就知道CPU有百分几的时间在某个pid，或者某个函数上了。</p>
<p>这种方式可以推广到各种事件，比如上一个博文我们介绍的ftrace的事件，你也可以在这个事件发生的时候上来冒个头，看看击中了谁，然后算出分布，我们就知道谁会引发特别多的那个事件了。</p>
<p>所以本质上 perf 属于一种抽样统计。既然是抽样统计我们就要警惕抽样带来的抽样误差。每次看perf report的报告，首先要去注意一下总共收集了多少个点，如果你只有几十个点，你这个报告就可能很不可信了。</p>
<h2 id="2-perf-的原理"><a href="#2-perf-的原理" class="headerlink" title="2. perf 的原理"></a>2. perf 的原理</h2><p><img src="/images/linux_pf/perf_events_map.png" alt="perf_events_map"></p>
<p>perf 可以利用我们所说的所有四种 event，可以直接跟踪到整个系统的所有程序（而不仅仅是内核），所以perf通常是我们分析的第一步。上面是 perf 的架构图。</p>
<h3 id="2-1-idle"><a href="#2-1-idle" class="headerlink" title="2.1 idle"></a>2.1 idle</h3><p>现代CPU基本上已经不用忙等的方式进入等待了，所以，如果CPU在idle，击中任务也会停止，所以，在Idle上是没有点的。看到Idle函数本身的点并非CPU Idle的点，而是准备进入Idle前后花的时间。所以，perf的统计不能用来让你分析CPU占用率的。ftrace和top等工具才能看CPU占用率，perf是不行的。</p>
<h3 id="2-2-中断"><a href="#2-2-中断" class="headerlink" title="2.2 中断"></a>2.2 中断</h3><p>perf还有一个问题是对中断的要求，perf很多事件都依赖中断，但Linux内核是可以关中断的，关中断以后，你就无法击中关中断的点了，你的中断会被延迟到开中断的时候，所以，在这样的平台上，你会看到很多开中断之后的函数被密集击中。但它们是无辜的。但更糟糕的是，如果在关中断的时候，发生了多个事件，由于中断控制器会合并相同的中断，你就会失去多次事件，让你的统计发生错误。</p>
<p>现代的Intel平台，基本上已经把PMU中断都切换为NMI中断了（不可屏蔽），所以前面这个问题不存在。但在大部分ARM/ARM64平台上，这个问题都没有解决，所以看这种平台的报告，都要特别小心，特别是你看到_raw_spin_unlock()一类的函数击中极高，你就要怀疑一下你的测试结果了（注意，这个结果也是能用的，只是看你怎么用）。</p>
<h3 id="3-perf-的使用"><a href="#3-perf-的使用" class="headerlink" title="3. perf 的使用"></a>3. perf 的使用</h3><h3 id="3-1-perf-安装"><a href="#3-1-perf-安装" class="headerlink" title="3.1 perf 安装"></a>3.1 perf 安装</h3><p>perf的源代码就是Linux的源代码目录中，因为它在相当程度上和内核是关联的。一般Linux 的各种发行版本都会安装好与内核相对应的 perf 命令。perf 有两种安装方式</p>
<ol>
<li>通过包管理进行安装，perf工具在 linux-tools-common工具包里，通过包管理软件安装的时候还需要依赖linux-tools-kernelversion包</li>
<li>源码编译：找到对应内核版本的源码包，在tools/perf目录下进行编译</li>
</ol>
<h3 id="2-2-perf"><a href="#2-2-perf" class="headerlink" title="2.2 perf"></a>2.2 perf</h3><p><code>perf [--version] [--help] [OPTIONS] COMMAND [ARGS]</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">子命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">list</td>
<td style="text-align:left">List all symbolic event types<br>列出当前系统支持的所有事件名,可分为三类：硬件事件、软件事件，检查点</td>
</tr>
<tr>
<td style="text-align:left">top</td>
<td style="text-align:left">System profiling tool.<br>对系统的性能进行分析，类似top命令</td>
</tr>
<tr>
<td style="text-align:left">record</td>
<td style="text-align:left">Run a command and record its profile into perf.data<br>    对程序运行过程中的事件进行分析和记录，并写入perf.data</td>
</tr>
<tr>
<td style="text-align:left">report</td>
<td style="text-align:left">Read perf.data (created by perf record) and display the profile<br>读取perf.data(由perf record生成) 并显示分析结果</td>
</tr>
<tr>
<td style="text-align:left">sched</td>
<td style="text-align:left">Tool to trace/measure scheduler properties (latencies)<br>针对调度器子系统的分析工具</td>
</tr>
<tr>
<td style="text-align:left">lock</td>
<td style="text-align:left">Analyze lock events<br>分析内核中的锁信息，包括锁的争用情况，等待延迟等</td>
</tr>
<tr>
<td style="text-align:left">mem</td>
<td style="text-align:left">Profile memory accesses<br>分析内存访问</td>
</tr>
<tr>
<td style="text-align:left">kmem</td>
<td style="text-align:left">Tool to trace/measure kernel memory properties<br>分析内核内存的使用</td>
</tr>
<tr>
<td style="text-align:left">kvm</td>
<td style="text-align:left">Tool to trace/measure kvm guest os<br>分析kvm虚拟机上的guest os</td>
</tr>
<tr>
<td style="text-align:left">stat</td>
<td style="text-align:left">Run a command and gather performance counter statistics<br>对程序运行过程中的性能计数器进行统计</td>
</tr>
<tr>
<td style="text-align:left">timechart</td>
<td style="text-align:left">Tool to visualize total system behavior during a workload<br>对record结果进行可视化分析输出，record命令需要加上timechart记录</td>
</tr>
<tr>
<td style="text-align:left">script</td>
<td style="text-align:left">Read perf.data (created by perf record) and display trace output<br>读取perf.data(由perf record生成)，生成trace记录，供其他分析工具使用</td>
</tr>
<tr>
<td style="text-align:left">data</td>
<td style="text-align:left">Data file related processing<br>把perf.data文件转换成其他格式</td>
</tr>
<tr>
<td style="text-align:left">diff</td>
<td style="text-align:left">Read perf.data files and display the differential profile<br>读取多个perf.data文件，并给出差异分析</td>
</tr>
<tr>
<td style="text-align:left">evlist</td>
<td style="text-align:left">List the event names in a perf.data file<br>列出perf.data中采集的事件列表</td>
</tr>
<tr>
<td style="text-align:left">bench</td>
<td style="text-align:left">General framework for benchmark suites<br>perf提供的基准套件的通用框架，可以对当前系统的调度，IPC，内存访问进行性能评估</td>
</tr>
<tr>
<td style="text-align:left">test</td>
<td style="text-align:left">Runs sanity tests.<br>    perf对当前软硬件平台进行健全性测试，可用此工具测试当前的软硬件平台是否能支持perf的所有功能</td>
</tr>
<tr>
<td style="text-align:left">probe</td>
<td style="text-align:left">Define new dynamic tracepoints<br>用于定义动态检查点</td>
</tr>
<tr>
<td style="text-align:left">trace</td>
<td style="text-align:left">strace inspired tool<br>类似于strace，跟踪目标的系统调用，但开销比strace小</td>
</tr>
<tr>
<td style="text-align:left">ftrace</td>
<td style="text-align:left">simple wrapper for kernel ftrace functionality<br></td>
</tr>
<tr>
<td style="text-align:left">annotate</td>
<td style="text-align:left">Read perf.data (created by perf record) and display annotated code<br>读取perf.data(由perf record生成)显示反汇编后的代码</td>
</tr>
<tr>
<td style="text-align:left">archive</td>
<td style="text-align:left">Create archive with object files with build-ids found in perf.data file<br>根据perf.data(由perf record生成)文件中的build-id将相关的目标文件打包</td>
</tr>
<tr>
<td style="text-align:left">buildid-cache</td>
<td style="text-align:left">Manage build-id cache.<br></td>
</tr>
<tr>
<td style="text-align:left">buildid-list</td>
<td style="text-align:left">List the buildids in a perf.data file<br></td>
</tr>
<tr>
<td style="text-align:left">c2c</td>
<td style="text-align:left">Shared Data C2C/HITM Analyzer.<br></td>
</tr>
<tr>
<td style="text-align:left">config</td>
<td style="text-align:left">Get and set variables in a configuration file.<br></td>
</tr>
<tr>
<td style="text-align:left">inject</td>
<td style="text-align:left">Filter to augment the events stream with additional information<br></td>
</tr>
<tr>
<td style="text-align:left">kallsyms</td>
<td style="text-align:left">Searches running kernel for symbols<br></td>
</tr>
<tr>
<td style="text-align:left">version</td>
<td style="text-align:left">display the version of perf binary<br></td>
</tr>
</tbody>
</table>
<h4 id="perf-list"><a href="#perf-list" class="headerlink" title="perf list"></a>perf list</h4><p><code>perf list [--no-desc] [--long-desc] [event_class]</code></p>
<ul>
<li>作用: 列出perf可以支持的所有事件</li>
<li>event_class: 事件的分类，包括:<ul>
<li><code>hw|sw|cache|pmu|sdt|metric|metricgroup</code></li>
<li><code>tracepoint</code>: 静态探针</li>
<li><code>event_glob</code>: 事件的通配符</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">perf list</div><div class="line"></div><div class="line">List of pre-defined events (to be used <span class="keyword">in</span> -e):</div><div class="line"></div><div class="line">  alignment-faults                                   [Software event]</div><div class="line">  bpf-output                                         [Software event]</div><div class="line">  context-switches OR cs                             [Software event]</div><div class="line">  cpu-clock                                          [Software event]</div><div class="line">  cpu-migrations OR migrations                       [Software event]</div><div class="line">  ..........</div></pre></td></tr></table></figure>
<p>perf list给出的事件是厂家上传上去给Linux社区的，但有些厂家会有自己的事件统计，没有上传出去，这需要从厂家的用户手册中获得，这种事件，可以直接用编号表示，比如格式是rXXXX，比如在我们的芯片里面，0x13号表示跨芯片内存访问，你就可以用<code>-e r0013</code>来跟踪软件的跨片访问次数</p>
<h4 id="perf-top"><a href="#perf-top" class="headerlink" title="perf top"></a>perf top</h4><p><code>perf top [-e &lt;EVENT&gt; | --event=EVENT] [&lt;options&gt;]</code></p>
<ul>
<li>作用: 可以动态收集和更新统计列表</li>
<li>options:<ul>
<li>-e:<ul>
<li>指定跟踪的事件，包括 perf list提供的所有事件以及 tracepoint</li>
<li>可以多次使用，也可以一次指定多个事件，事件使用逗号分隔</li>
<li>对于厂家为上传的事件可以直接是用编号，eg: <code>-e r0013</code> </li>
<li>事件可以指定后缀，用于限定跟踪范围</li>
</ul>
</li>
<li>-s:<ul>
<li>指定按什么参数来进行分类 </li>
<li>默认会按函数进行分类，按照 pid 分类需要指定 -s pid</li>
<li>-s也可以指定多个域（用逗号隔开）</li>
<li>可选值包括:<ul>
<li>pid, comm, dso, symbol, parent, srcline, weight, </li>
<li>local_weight, abort, in_tx, transaction, overhead, sample, period</li>
</ul>
</li>
</ul>
</li>
<li>-a：显示在所有CPU上的性能统计信息</li>
<li>-p：指定进程PID</li>
<li>-t：指定线程TID</li>
<li>-K：隐藏内核统计信息</li>
<li>-U：隐藏用户空间的统计信息</li>
<li>-S, –symbols: Only consider these symbols</li>
<li>-g, –call-graph: 得到函数的调用关系图<ul>
<li>格式: <code>&lt;print_type,threshold[,print_limit],order,sort_key[,branch],value&gt;</code></li>
<li>print_type:<ul>
<li>flat: single column, linear exposure of call chains.</li>
<li>graph: use a graph tree, displaying absolute overhead rates. (default)</li>
<li>fractal: like graph, but displays relative rates. Each branch of the tree is considered as a new profiled object.</li>
<li>folded: call chains are displayed in a line, separated by semicolons</li>
<li>none: disable call chain display.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. -e 指定多个事件</span></div><div class="line">&gt; sudo perf top -e branch-misses,cycles</div><div class="line"></div><div class="line"><span class="comment"># 2. 指定后缀，只跟踪用户态发生的分支预测失败</span></div><div class="line">&gt; sudo perf top -e branch-misses:u,cycles</div><div class="line">&gt; sudo perf top -e <span class="string">'&#123;branch-misses,cycles&#125;:u'</span></div><div class="line"></div><div class="line"><span class="comment"># 3. 指定分类</span></div><div class="line">&gt; sudo perf top -e <span class="string">'cycle'</span> -s comm,pid,dso</div></pre></td></tr></table></figure>
<h4 id="perf-stat"><a href="#perf-stat" class="headerlink" title="perf stat"></a>perf stat</h4><p>perf stat:</p>
<ul>
<li>命令格式:<ul>
<li><code>perf stat [-e &lt;EVENT&gt; | --event=EVENT] [-a] &lt;command&gt;</code></li>
<li><code>perf stat [-e &lt;EVENT&gt; | --event=EVENT] [-a] — &lt;command&gt; [&lt;options&gt;]</code></li>
<li><code>perf stat [-e &lt;EVENT&gt; | --event=EVENT] [-a] record [-o file] — &lt;command&gt; [&lt;options&gt;]</code></li>
<li><code>perf stat report [-i file]</code></li>
</ul>
</li>
<li>作用: 可以对程序运行过程中的性能计数器(包括Hardware，software counters)进行统计，分析程序的整体消耗情况</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$perf</span> <span class="built_in">stat</span> ls</div><div class="line">Performance counter stats <span class="keyword">for</span> <span class="string">'ls'</span>:</div><div class="line"></div><div class="line">          2.164836      task-clock (msec)         <span class="comment">#    0.808 CPUs utilized</span></div><div class="line">                51      context-switches          <span class="comment">#    0.024 M/sec</span></div><div class="line">                 4      cpu-migrations            <span class="comment">#    0.002 M/sec</span></div><div class="line">               333      page-faults               <span class="comment">#    0.154 M/sec</span></div><div class="line">           5506056                                <span class="comment">#    2.543 GHz</span></div><div class="line">                 0      stalled-cycles-frontend   <span class="comment">#    0.00% frontend cycles idle</span></div><div class="line">                 0      stalled-cycles-backend    <span class="comment">#    0.00% backend  cycles idle</span></div><div class="line">           6100570      instructions              <span class="comment">#    1.11  insns per cycle</span></div><div class="line">           1298744      branches                  <span class="comment">#  599.927 M/sec</span></div><div class="line">             18509      branch-misses             <span class="comment">#    1.43% of all branches</span></div><div class="line"></div><div class="line">       0.002679758 seconds time elapsed</div></pre></td></tr></table></figure>
<p>指标含义:</p>
<ol>
<li>task-clock (msec): cpu处理task所消耗的时间，单位ms，0.808 CPUs utilized的表示cpu使用率为80.8%，该值越高代表程序是CPU bound而非IO bound 类型</li>
<li>instructions：执行的指令条数， insns per cycle: 即IPC，每个cpu周期执行的指令条数，IPC比上面的CPU使用率更能说明CPU的使用情况</li>
<li>stalled-cycles-frontend和stalled-cycles-backend表示CPU停滞统计</li>
<li>branches：这段时间内发生分支预测的次数。现代的CPU都有分支预测方面的优化。</li>
<li>branches-misses：这段时间内分支预测失败的次数，这个值越小越好。</li>
</ol>
<h4 id="perf-record-report"><a href="#perf-record-report" class="headerlink" title="perf record/report"></a>perf record/report</h4><p>perf-record用来启动一次跟踪，而perf-report用来输出跟踪结果。</p>
<ol>
<li>perf record在当前目录产生一个perf.data文件，用来记录过程数据</li>
<li>如果这个文件已经存在，旧的文件会被改名为perf.data.old</li>
<li>perf.data只包含原始数据，perf report 需要访问本地的符号表，pid和进程的对应关系等信息来生成报告。</li>
<li>所以perf.data不能直接拷贝，可以通过perf-archive命令把所有这些数据打包，然后复制</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo perf record -e <span class="string">'cycles'</span> - myapplication arg1 arg2</div><div class="line">sudo perf report</div><div class="line"></div><div class="line">perf record -e probe:schedule -a sleep 1</div></pre></td></tr></table></figure>
<p><strong>perf record</strong></p>
<ul>
<li>命令格式:<ul>
<li><code>perf record [-e &lt;EVENT&gt; | --event=EVENT] [-a] &lt;command&gt;</code></li>
<li><code>perf record [-e &lt;EVENT&gt; | --event=EVENT] [-a] — &lt;command&gt; [&lt;options&gt;]</code></li>
</ul>
</li>
<li>参数:<ul>
<li><code>-p, --pid &lt;pid&gt;</code>: 指定跟踪固定的一组进程，即仅仅跟踪发生在特定pid的事件</li>
<li>-a, –all-cpus: 跟踪整个系统的性能，常用选项</li>
<li><code>-c, --count &lt;n&gt;</code>: 累计多少个事件记录一次</li>
<li>-g: 开启堆栈追踪，通常无需使用</li>
<li>-F: 事件采样的频率, 单位HZ, 更高的频率会获得更细的统计，但会带来更多的开销</li>
<li>sleep: 采样的时间</li>
<li><code>-g, --call-graph</code>: 展示调用栈<ul>
<li>格式: <code>&lt;print_type,threshold[,print_limit],order,sort_key[,branch],value&gt;</code><ul>
<li>print_type:     call graph printing style (graph|flat|fractal|folded|none)</li>
<li>threshold:      minimum call graph inclusion threshold (<code>&lt;percent&gt;</code>)</li>
<li>print_limit:    maximum number of call graph entry (<code>&lt;number&gt;</code>)</li>
<li>order:          call graph order (caller|callee)</li>
<li>sort_key:       call graph sort key (function|address)</li>
<li>branch:         include last branch info to call graph (branch)</li>
<li>value:          call graph value (percent|period|count)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 跟踪 Python 进程以及整个系统的性能</span></div><div class="line"><span class="comment"># 但不会包括其他用户进程占用的资源</span></div><div class="line">perf record -e <span class="string">'cycles'</span> -a python3.6 test.py</div></pre></td></tr></table></figure>
<p><strong>perf report</strong><br><code>perf report [-i &lt;file&gt; | --input=file]</code></p>
<ul>
<li>使用: 显示的是一个菜单项，回车可以查看折叠的代码，esc 或者 q 可以退出返回上一级</li>
<li>参数:<ul>
<li>–pid=: 指定 pid</li>
<li>–tid=: 指定 tid</li>
<li>-S, –symbols=: Only consider these symbols. </li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Show perf.data as a text report, with data coalesced and percentages:</span></div><div class="line">perf report --stdio</div><div class="line"></div><div class="line"><span class="comment"># Report, with stacks in folded format: one line per stack (needs 4.4):</span></div><div class="line">perf report --stdio -n -g folded</div></pre></td></tr></table></figure>
<h4 id="perf-diff"><a href="#perf-diff" class="headerlink" title="perf diff"></a>perf diff</h4><p><code>perf diff [baseline file] [data file1] [[data file2] ... ]</code></p>
<ul>
<li>作用: 比较两次运行的区别</li>
<li>场景: 可以用不同参数运行程序，看看两次运行的差别</li>
</ul>
<h4 id="perf-script"><a href="#perf-script" class="headerlink" title="perf script"></a>perf script</h4><p><code>perf script [&lt;options&gt;]</code></p>
<ul>
<li>作用: 对 perf.data 数据做格式转换</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. 导出原始分析数据</span></div><div class="line">&gt; perf record</div><div class="line">&gt; perf script <span class="comment"># 导出 perf record 中记录的原始数据</span></div><div class="line">&gt; perf script | ./stackcollapse-perf.pl | ./flamegraph.pl &gt; perf-kernel.svg</div><div class="line"></div><div class="line"><span class="comment"># List all perf.data events, with customized fields (&lt; Linux 4.1):</span></div><div class="line">perf script -f time,event,trace</div><div class="line"></div><div class="line"><span class="comment"># List all perf.data events, with customized fields (&gt;= Linux 4.1):</span></div><div class="line">perf script -F time,event,trace</div><div class="line"></div><div class="line"><span class="comment"># List all perf.data events, with my recommended fields (needs record -a; newer kernels):</span></div><div class="line">perf script --header -F comm,pid,tid,cpu,time,event,ip,sym,dso </div><div class="line"></div><div class="line"><span class="comment"># List all perf.data events, with my recommended fields (needs record -a; older kernels):</span></div><div class="line">perf script -f comm,pid,tid,cpu,time,event,ip,sym,dso</div><div class="line"></div><div class="line"><span class="comment"># Dump raw contents from perf.data as hex (for debugging):</span></div><div class="line">perf script -D</div></pre></td></tr></table></figure>
<h4 id="perf-chart"><a href="#perf-chart" class="headerlink" title="perf chart"></a>perf chart</h4><p>perf timechart输出的是进程运行过程中系统调度的情况，无法对程序的具体代码段进行性能分析，但可以看出总结运行情况：running，idle，I/O等，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">perf timechart record ./a.out     <span class="comment"># 记录数据</span></div><div class="line">perf timechart                    <span class="comment"># 生成 output.svg</span></div></pre></td></tr></table></figure>
<h3 id="2-3-堆栈追踪"><a href="#2-3-堆栈追踪" class="headerlink" title="2.3 堆栈追踪"></a>2.3 堆栈追踪</h3><p>假设 A 函数调用了函数 B，默认情况下在 perf record 的记录中，A 的运行时间是不包含 B 函数的运行时间的。大多数情况下这么记录是正确的，因为 report 才能够显示出真正耗时的位置。</p>
<p>假设我们想将 B 的耗时记录到 A 中，可以启动堆栈跟踪 -g，也就是每次击中的时候，向上回溯一下调用栈，让调用者的计数也加一。</p>
<p>使用堆栈跟踪要注意的是:</p>
<ol>
<li>堆栈跟踪受扫描深度的限制，太深的堆栈可能回溯不过去，这是有可能影响结果的。</li>
<li>有些我们从源代码看来是函数调用的，其实在汇编一级并不是函数调用<ul>
<li>比如inline函数，宏，都不是函数调用</li>
<li>另外，gcc在很多平台中，会自动把很短的函数变成inline函数，这也不产生函数调用</li>
<li>还有一种是，fastcall函数，通过寄存器传递参数，不会产生调用栈，也有可能不产生调用栈</li>
<li>部分平台使用简化的堆栈回溯机制，在堆栈中看见一个地址像是代码段的地址，就认为是调用栈</li>
</ul>
</li>
</ol>
<h2 id="3-perf-火焰图"><a href="#3-perf-火焰图" class="headerlink" title="3. perf 火焰图"></a>3. perf 火焰图</h2><p>Brendangregg写了两款对perf采样结果进行可视化分析的开源工具：</p>
<ol>
<li>FlameGraphs即所谓的火焰图，能清晰的展示程序各个函数的性能消耗</li>
<li>HeatMap可以从采样数据中的延迟数据来进行消耗展示</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 生成火焰图</span></div><div class="line">git <span class="built_in">clone</span> https://github.com/brendangregg/FlameGraph  <span class="comment"># or download it from github</span></div><div class="line"><span class="built_in">cd</span> FlameGraph</div><div class="line">perf record -F 99 -ag -- sleep 60</div><div class="line">perf script | ./stackcollapse-perf.pl &gt; out.perf-folded</div><div class="line">cat out.perf-folded | ./flamegraph.pl &gt; perf-kernel.svg</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.brendangregg.com/perf.html" target="_blank" rel="external">brendangregg-perf</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/22194920" target="_blank" rel="external">在Linux下做性能分析3：perf</a></li>
</ul>

        </div>
        <!--  -->
        <footer class="article-footer">
            



    <a data-url="http://yoursite.com/2020/01/04/linux_perf/04_perf/" data-id="ckbjfxmzd004f1ku9n1dj4o9j" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2020/01/05/linux_perf/05_perf_example/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            2.3 perf Examples 翻译
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2020/01/03/linux_perf/03_ftrace/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">2.1 ftrace 的原理与使用</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/06/17/linux_perf/附录_容器处理/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2020/06/17/linux_perf/附录_容器处理/" class="title"></a></p>
                            <p class="item-date"><time datetime="2020-06-17T14:17:36.878Z" itemprop="datePublished">2020-06-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/03/29/mysql/MySQL实战45讲/61_分区表/" class="thumbnail">
    
    
        <span style="background-image:url(/images/mysql/MySQL45讲/split_innodb.jpg)" alt="29 MYSQL 分区表" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/存储/">存储</a></p>
                            <p class="item-title"><a href="/2020/03/29/mysql/MySQL实战45讲/61_分区表/" class="title">29 MYSQL 分区表</a></p>
                            <p class="item-date"><time datetime="2020-03-28T16:00:00.000Z" itemprop="datePublished">2020-03-29</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/03/28/mysql/MySQL实战45讲/52_连接管理/" class="thumbnail">
    
    
        <span style="background-image:url(/images/mysql/MySQL45讲/kill_failure.png)" alt="28 MySQL 连接管理" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/存储/">存储</a></p>
                            <p class="item-title"><a href="/2020/03/28/mysql/MySQL实战45讲/52_连接管理/" class="title">28 MySQL 连接管理</a></p>
                            <p class="item-date"><time datetime="2020-03-27T16:00:00.000Z" itemprop="datePublished">2020-03-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/03/27/mysql/MySQL实战45讲/51_grant_privileges/" class="thumbnail">
    
    
        <span style="background-image:url(/images/mysql/MySQL45讲/grant_connect.png)" alt="27 MYSQL flush privileges" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/存储/">存储</a></p>
                            <p class="item-title"><a href="/2020/03/27/mysql/MySQL实战45讲/51_grant_privileges/" class="title">27 MYSQL flush privileges</a></p>
                            <p class="item-date"><time datetime="2020-03-26T16:00:00.000Z" itemprop="datePublished">2020-03-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/03/26/mysql/MySQL实战45讲/45_自增主键/" class="thumbnail">
    
    
        <span style="background-image:url(/images/mysql/MySQL45讲/auto_error.jpg)" alt="26 MYSQL 自增主键" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/存储/">存储</a></p>
                            <p class="item-title"><a href="/2020/03/26/mysql/MySQL实战45讲/45_自增主键/" class="title">26 MYSQL 自增主键</a></p>
                            <p class="item-date"><time datetime="2020-03-25T16:00:00.000Z" itemprop="datePublished">2020-03-26</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">56</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/存储/">存储</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">178</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">30</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">48</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">29</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">4</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8S/">K8S</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux基础/">Linux基础</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux性能调优/">Linux性能调优</a><span class="tag-list-count">38</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL实战45讲/">MySQL实战45讲</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go语言入门/">go语言入门</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql运维/">mysql运维</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wrapt/">wrapt</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/入门指南/">入门指南</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据密集型应用/">数据密集型应用</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构与算法/">数据结构与算法</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/极客时间/">极客时间</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马哥-Linux/">马哥 Linux</a><span class="tag-list-count">135</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马哥-MySQL-运维/">马哥 MySQL 运维</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能的MySQL/">高性能的MySQL</a><span class="tag-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/K8S/" style="font-size: 10px;">K8S</a> <a href="/tags/Linux基础/" style="font-size: 10.91px;">Linux基础</a> <a href="/tags/Linux性能调优/" style="font-size: 18.18px;">Linux性能调优</a> <a href="/tags/MySQL实战45讲/" style="font-size: 17.27px;">MySQL实战45讲</a> <a href="/tags/go语言入门/" style="font-size: 15.45px;">go语言入门</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/mysql运维/" style="font-size: 10px;">mysql运维</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/wrapt/" style="font-size: 16.36px;">wrapt</a> <a href="/tags/入门指南/" style="font-size: 10.91px;">入门指南</a> <a href="/tags/数据密集型应用/" style="font-size: 12.73px;">数据密集型应用</a> <a href="/tags/数据结构与算法/" style="font-size: 19.09px;">数据结构与算法</a> <a href="/tags/极客时间/" style="font-size: 17.27px;">极客时间</a> <a href="/tags/马哥-Linux/" style="font-size: 20px;">马哥 Linux</a> <a href="/tags/马哥-MySQL-运维/" style="font-size: 14.55px;">马哥 MySQL 运维</a> <a href="/tags/高性能的MySQL/" style="font-size: 13.64px;">高性能的MySQL</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">讨论区</h3>
        <div class="widget">
            <h4> 联系我 <h4>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2020 宋涛</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'http://yoursite.com/2020/01/04/linux_perf/04_perf/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
