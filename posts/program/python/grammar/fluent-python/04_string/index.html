<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>文本和字节序列 - LoveIt</title><meta name="Description" content="Python 文本和字节序列"><meta property="og:title" content="文本和字节序列" />
<meta property="og:description" content="Python 文本和字节序列" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" /><meta property="og:image" content="https://hotttao.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-04T22:00:00+08:00" />
<meta property="article:modified_time" content="2022-03-10T13:09:11+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hotttao.github.io/logo.png"/>

<meta name="twitter:title" content="文本和字节序列"/>
<meta name="twitter:description" content="Python 文本和字节序列"/>
<meta name="application-name" content="宋涛的个人博客">
<meta name="apple-mobile-web-app-title" content="宋涛的个人博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" /><link rel="prev" href="https://hotttao.github.io/posts/linux/linux_mt/04-linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" /><link rel="next" href="https://hotttao.github.io/posts/linux/linux_mt/04-linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/bash%E5%B8%B8%E8%A7%81%E7%89%B9%E6%80%A7/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "文本和字节序列",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/hotttao.github.io\/posts\/program\/python\/grammar\/fluent-python\/04_string\/"
        },"image": ["https:\/\/hotttao.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "python 进阶","wordcount":  4541 ,
        "url": "https:\/\/hotttao.github.io\/posts\/program\/python\/grammar\/fluent-python\/04_string\/","datePublished": "2018-01-04T22:00:00+08:00","dateModified": "2022-03-10T13:09:11+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/hotttao.github.io\/images\/hugo\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "宋涛"
            },"description": "Python 文本和字节序列"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="LoveIt"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>宋涛的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/go/"> Go </a><a class="menu-item" href="/categories/linux/"> Linux </a><a class="menu-item" href="/categories/distributed/"> 分布式 </a><a class="menu-item" href="/categories/distributed/"> 架构 </a><a class="menu-item" href="/posts/about/"> 关于 </a><a class="menu-item" href="https://github.com/hotttao/" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="LoveIt"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>宋涛的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/go/" title="">Go</a><a class="menu-item" href="/categories/linux/" title="">Linux</a><a class="menu-item" href="/categories/distributed/" title="">分布式</a><a class="menu-item" href="/categories/distributed/" title="">架构</a><a class="menu-item" href="/posts/about/" title="">关于</a><a class="menu-item" href="https://github.com/hotttao/" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">文本和字节序列</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://hotttao.github.io/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>宋涛</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/python/"><i class="far fa-folder fa-fw"></i>Python</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2018-01-04">2018-01-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4541 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 10 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-字符与字节">1. 字符与字节</a>
      <ul>
        <li><a href="#11-字符的理解">1.1 字符的理解</a></li>
        <li><a href="#12-python-中的字符对象">1.2 Python 中的字符对象</a></li>
      </ul>
    </li>
    <li><a href="#2-二进制序列类型">2. 二进制序列类型</a>
      <ul>
        <li><a href="#21-bytes-和-bytearray">2.1 bytes 和 bytearray</a>
          <ul>
            <li><a href="#字面量表示法">字面量表示法</a></li>
            <li><a href="#可用方法">可用方法</a></li>
          </ul>
        </li>
        <li><a href="#22-内存视图">2.2 内存视图</a>
          <ul>
            <li><a href="#memoryview">memoryview</a></li>
            <li><a href="#struct-模块">struct 模块</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-编解码问题">3. 编解码问题</a>
      <ul>
        <li><a href="#31-编解码异常">3.1 编解码异常</a></li>
        <li><a href="#32-编码识别">3.2 编码识别</a></li>
        <li><a href="#33-bom---鬼符">3.3 BOM - 鬼符</a></li>
      </ul>
    </li>
    <li><a href="#4-文本处理">4. 文本处理</a></li>
    <li><a href="#5-文本规范化和排序">5. 文本规范化和排序</a>
      <ul>
        <li><a href="#51-文本规范化">5.1 文本规范化</a></li>
        <li><a href="#52-unicode文本排序">5.2 Unicode文本排序</a></li>
        <li><a href="#53-unicode数据库">5.3 Unicode数据库</a></li>
        <li><a href="#54-双模式-api">5.4 双模式 API</a>
          <ul>
            <li><a href="#re">re</a></li>
          </ul>
        </li>
        <li><a href="#os函数中的字符串和字节序列">os函数中的字符串和字节序列？？</a>
          <ul>
            <li><a href="#背景">背景:</a></li>
            <li><a href="#可用函数">可用函数</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#延伸阅读">延伸阅读</a>
      <ul>
        <li><a href="#python">Python:</a></li>
        <li><a href="#blog">blog:</a></li>
        <li><a href="#实用工具">实用工具</a></li>
        <li><a href="#书籍">书籍:</a></li>
      </ul>
    </li>
    <li><a href="#杂谈">杂谈</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="1-字符与字节">1. 字符与字节</h2>
<h3 id="11-字符的理解">1.1 字符的理解</h3>
<p><strong>字符</strong>:</p>
<ul>
<li>&ldquo;字符&quot;的最佳定义是 Unicode 字符</li>
<li>Unicode 标准把 <strong>字符的标识</strong> 和 <strong>具体的字节表述</strong> 进行了如下的明确区分</li>
</ul>
<p><strong>字符的标识</strong></p>
<ol>
<li>字符的标识，即码位，是 0~1 114 111 的数字（十进制）</li>
<li>Unicode 标准中以 4~6 个十六进制数字表示，而且加前缀&quot;U+&rdquo;</li>
<li>在 Unicode 6.3 中（这是 Python 3.4 使用的标准），约 10% 的有效码位有对应的字符</li>
</ol>
<p><strong>字符的字节表述</strong></p>
<ol>
<li>字符的具体表述取决于所用的编码</li>
<li>编码是在码位和字节序列之间转换时使用的算法</li>
</ol>
<p><strong>编码</strong>: 把码位转换成字节序列的过程<br>
<strong>解码</strong>: 把字节序列转换成码位的过程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;café&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>                        <span class="c1"># café&#39; 字符串有 4 个 Unicode 字符</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="c1"># 使用 UTF-8 把 str 对象编码成 bytes 对象</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;caf</span><span class="se">\xc3\xa9</span><span class="s1">&#39;</span> <span class="c1"># bytes 字面量以 b 开头</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>             <span class="c1"># 字节序列 b 有 5 个字节</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="c1"># ➎</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;café&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="12-python-中的字符对象">1.2 Python 中的字符对象</h3>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">Python2.7</th>
<th style="text-align:left">Python3.4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">unicdoe</td>
<td style="text-align:left">字符的标识</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">str</td>
<td style="text-align:left">字符的字节表示<br>各个元素是单个的字符<br>不可变类型</td>
<td style="text-align:left">字符的标识<br>相当于Python2.7 中的unicode</td>
</tr>
<tr>
<td style="text-align:left">bytes</td>
<td style="text-align:left">str类型的别名</td>
<td style="text-align:left">字符的字节表示<br>各个元素是介于 0~255（含）之间的整数<br>不可变类型</td>
</tr>
<tr>
<td style="text-align:left">bytearray</td>
<td style="text-align:left">字符的字节表示<br>各个元素是介于 0~255（含）之间的整数<br>可变类型</td>
<td style="text-align:left">同Python2.7</td>
</tr>
</tbody>
</table>
<ul>
<li>附注:
<ul>
<li>s[0] == s[:1] 只对 python3-str, python2-(str, unicode) 成立</li>
<li>对其他各个序列类型来说， s[i]返回一个元素，而 s[i:i+1] 返回一个相同类型的序列</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># python2 str 与 python3 bytes 对比</span>
</span></span><span class="line"><span class="cl"><span class="c1"># python27</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">=</span><span class="s2">&#34;中国&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;</span><span class="se">\xe4\xb8\xad\xe5\x9b\xbd</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 各个元素是单个的字符</span>
</span></span><span class="line"><span class="cl"><span class="nb">str</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># 切片和对应位置的元素相同</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># python34</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">=</span><span class="sa">b</span><span class="s2">&#34;中国&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xe4\xb8\xad\xe5\x9b\xbd</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># 各个元素是介于 0~255（含）之间的整数</span>
</span></span><span class="line"><span class="cl"><span class="mi">184</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-二进制序列类型">2. 二进制序列类型</h2>
<p>二进制序列:</p>
<ul>
<li>包括: bytes 和 bytearray,  memoryview</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;café&#39;</span><span class="p">,</span>  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf_8&#39;</span><span class="p">)</span> <span class="err">➊</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;caf</span><span class="se">\xc3\xa9</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     <span class="c1"># 各个元素是 range(256) 内的整数</span>
</span></span><span class="line"><span class="cl"><span class="mi">99</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># 切片还是 bytes 对象</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;c&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe_arr</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">cafe</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe_arr</span>        <span class="c1"># bytearray 对象没有字面量句法</span>
</span></span><span class="line"><span class="cl"><span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;caf</span><span class="se">\xc3\xa9</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>   <span class="c1"># bytearray 对象的切片还是 bytearray 对象</span>
</span></span><span class="line"><span class="cl"><span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xa9</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="21-bytes-和-bytearray">2.1 bytes 和 bytearray</h3>
<h4 id="字面量表示法">字面量表示法</h4>
<ul>
<li>可打印的 ASCII 范围内的字节（从空格到 ~），使用 ASCII 字符本身</li>
<li>制表符、换行符、回车符和 \ 对应的字节，使用转义序列 \t、 \n、 \r 和 \</li>
<li>其他字节的值，使用十六进制转义序列（例如， \x00 是空字节）</li>
</ul>
<h4 id="可用方法">可用方法</h4>
<p><strong>类 str 方法</strong></p>
<ul>
<li>除以下str类型方法外，都支持bytes和bytearray
<ul>
<li>格式化方法 format和format_map</li>
<li>处理Unicode数据的方法(包括casefold、isdecimal、isidentifier、isnumeric、
isprintable和encode)</li>
</ul>
</li>
<li>如果正则表达式编译自二进制列而不是字符串， re 模块中的正则表达式函数也能处理二进制序列</li>
</ul>
<p><strong>实例构建方法</strong></p>
<ol>
<li>bytes.fromhex():解析十六进制数字对(数字对之间的空格是可选的)，构建二进制序列</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;31 4B CE A9&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;1K</span><span class="se">\xce\xa9</span><span class="s1">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>向构造函数传入以下参数:</li>
</ol>
<ul>
<li>一个 str 对象和一个 encoding 关键字参数</li>
<li>一个可迭代对象，提供 0~255 之间的数值</li>
<li>一个整数，使用空字节创建对应长度的二进制序列 - python3.6将过时</li>
<li>一个实现了缓冲协议的对象（如 bytes、 bytearray、 memoryview、 array.array）
此时，把源对象中的字节序列 <strong>复制</strong> 到新建的二进制序列中</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">cafe</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;café&#39;</span><span class="p">,</span>  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf_8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">array</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">octets</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>  <span class="c1"># 指定类型代码 h，创建一个短整数（ 16 位）数组</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">octets</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xfe\xff\xff\xff\x00\x00\x01\x00\x02\x00</span><span class="s1">&#39;</span> <span class="c1"># 表示那 5 个短整数的 10 个字节</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-内存视图">2.2 内存视图</h3>
<h4 id="memoryview">memoryview</h4>
<p>memoryview</p>
<ul>
<li>作用: 允许在二进制数据结构之间共享内存,
<ul>
<li>通过其他二进制序列、打包的数组构建 memoryvideo对象时，不会复制字节序列</li>
<li>对 memoryview 对象的切片，也不会复制字节序列</li>
</ul>
</li>
<li>介绍:
<ul>
<li><a href="http://stackoverflow.com/questions/4845418/when-should-a-memoryview-be-used/" target="_blank" rel="noopener noreffer">http://stackoverflow.com/questions/4845418/when-should-a-memoryview-be-used/</a></li>
<li><a href="https://docs.python.org/3/library/stdtypes.html#memory-views" target="_blank" rel="noopener noreffer">https://docs.python.org/3/library/stdtypes.html#memory-views</a></li>
</ul>
</li>
</ul>
<p>memoryview.cast</p>
<ul>
<li>类似于类型转换，能用不同的方式读写同一块内存数据</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 通过改变数组中的一个字节来更新数组里某个元素的值 44 页</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">memv</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="err">➊</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">memv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">memv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="err">➋</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">memv_oct</span> <span class="o">=</span> <span class="n">memv</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span> <span class="err">➌</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">memv_oct</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="err">➍</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">254</span><span class="p">,</span>  <span class="mi">255</span><span class="p">,</span>  <span class="mi">255</span><span class="p">,</span>  <span class="mi">255</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">memv_oct</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="err">➎</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">numbers</span>
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1024</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="struct-模块">struct 模块</h4>
<ul>
<li>作用: 从二进制序列中提取结构化信息</li>
<li>介绍: <a href="https://docs.python.org/3/library/struct.html" target="_blank" rel="noopener noreffer">https://docs.python.org/3/library/struct.html</a></li>
<li>功能:
<ul>
<li>一些函数，把打包的字节序列转换成不同类型字段组成的元组</li>
<li>一些函数用于执行反向转换，把元组转换成打包的字节序列</li>
<li>能处理 bytes、bytearray 和 memoryview 对象</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">struct</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 结构体的格式:  &lt; 是小字节序， 3s3s 是两个 3 字节序列， HH 是两个 16 位二进制整数</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&lt;3s3sHH&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filter.gif&#39;</span><span class="p">,</span>  <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="n">img</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span> <span class="c1"># 创建一个 memoryview 对象</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">header</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># 使用它的切片再创建一个 memoryview 对象; 这里不会复制字节序列</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="c1"># 转换成字节序列，这只是为了显示</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;GIF89a+</span><span class="se">\x02\xe6\x00</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span>  <span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span>  <span class="sa">b</span><span class="s1">&#39;89a&#39;</span><span class="p">,</span>  <span class="mi">555</span><span class="p">,</span>  <span class="mi">230</span><span class="p">)</span> <span class="c1"># 拆包 memoryview 对象，得到一个元组，包含类型、版本、宽度和高度</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="k">del</span> <span class="n">header</span> <span class="c1"># ➏</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="k">del</span> <span class="n">img</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-编解码问题">3. 编解码问题</h2>
<h3 id="31-编解码异常">3.1 编解码异常</h3>
<p>异常类型:</p>
<ul>
<li>UnicodeEncodeError: 编码错误</li>
<li>UnicodeDecodeError: 解码异常</li>
<li>SyntaxError: 源码的编码与预期不符，加载 Python 模块触发的异常</li>
</ul>
<p>SyntaxError:</p>
<ul>
<li>Python 3 默认使用 UTF-8 编码源码</li>
<li>Python 2（从 2.5 开始）则默认使用 ASCII</li>
<li>如果加载的 .py 模块中包含默认编码之外的数据，而且没有声明编码，会触发SyntaxError: 异常</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">Non</span><span class="o">-</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="n">code</span> <span class="n">starting</span> <span class="k">with</span> <span class="s1">&#39;</span><span class="se">\xe1</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">file</span> <span class="n">ola</span><span class="o">.</span><span class="n">py</span> <span class="n">on</span> <span class="n">line</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="p">,</span>  <span class="n">but</span> <span class="n">no</span> <span class="n">encoding</span> <span class="n">declared</span><span class="p">;</span> <span class="n">see</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">peps</span><span class="o">/</span><span class="n">pep</span><span class="o">-</span><span class="mi">0263</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">details</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>编码声明 - # coding: cp1252</li>
</ul>
<p>errors参数:</p>
<ul>
<li>说明: 编码方法或函数中的参数，用于指明对错误进行处理的方式</li>
<li>error=&lsquo;struct&rsquo;: 默认值，出现错误则触发异常</li>
<li>error=&lsquo;ignore&rsquo;: 跳过无法编码的字符，通常很是不妥</li>
<li>error=&lsquo;replace&rsquo;，把无法编码的字符替换成 &lsquo;?&rsquo;</li>
<li>error=&lsquo;xmlcharrefreplace&rsquo;: 把无法编码的字符替换成 XML 实体</li>
<li>错误处理方式是可扩展的，为 errors 参数注册额外的字符串:
<ul>
<li>方法是把一个名称和一个错误处理函数传给 codecs.register_error 函数</li>
<li>参考 <a href="https://docs.python.org/3/library/codecs.html#codecs.register_error" target="_blank" rel="noopener noreffer">https://docs.python.org/3/library/codecs.html#codecs.register_error</a></li>
</ul>
</li>
</ul>
<h3 id="32-编码识别">3.2 编码识别</h3>
<p>Chardet:</p>
<ul>
<li>作用: 编码侦测包,  能识别所支持的 30 种编码</li>
<li>文档: <a href="https://pypi.python.org/pypi/chardet" target="_blank" rel="noopener noreffer">https://pypi.python.org/pypi/chardet</a></li>
<li>介绍: Chardet 是一个 Python 库,  也提供了命令行工具 chardetect</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ chardetect 04-text-byte.asciidoc
</span></span><span class="line"><span class="cl">04-text-byte.asciidoc: utf-8 with confidence 0.99
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-bom---鬼符">3.3 BOM - 鬼符</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">u16</span> <span class="o">=</span> <span class="s1">&#39;El Niño&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf_16&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">u16</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff\xfe</span><span class="s1">E</span><span class="se">\x00</span><span class="s1">l</span><span class="se">\x00</span><span class="s1"> </span><span class="se">\x00</span><span class="s1">N</span><span class="se">\x00</span><span class="s1">i</span><span class="se">\x00\xf1\x00</span><span class="s1">o</span><span class="se">\x00</span><span class="s1">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>b&rsquo;\xff\xfe&rsquo;:</p>
<ul>
<li>这是 BOM，即字节序标记（ byte-order mark）</li>
<li>指明编码时使用Intel CPU 的小字节序</li>
<li>小字节序设备中，各个码位的最低有效字节在前面</li>
</ul>
<p>UTF-16:</p>
<ul>
<li>为了避免混淆， UTF-16 编码在要编码的文本前面加上特殊的不可见字符
ZERO WIDTH NOBREAK SPACE(U+FEFF)在小字节序系统中，这个字符编码为
b&rsquo;\xff\xfe&rsquo;(十进制数255,  254)</li>
<li>UTF-16LE，显式指明使用小字节序</li>
<li>UTF-16BE，显式指明使用大字节序</li>
<li>如果使用这两个变种，不会生成 BOM</li>
<li>根据标准，如果文件使用 UTF-16 编码，而且没有 BOM，
那么应该假定使用的是 UTF-16BE（大字节序）编码</li>
</ul>
<p>附注:</p>
<ul>
<li>与字节序有关的问题只对一个字占多个字节的编码(如 UTF-16 和 UTF-32)有影响</li>
<li>UTF-8 的一大优势是，不管设备使用哪种字节序，生成的字节序列始终一致，因此不需要 BOM
但是某些应用依旧会在 UTF-8 编码的文件中添加 BOM</li>
<li>Excel 会根据有没有 BOM 确定文件是不是 UTF-8 编码，否则，
假设内容使用 Windows 代码页(codepage)编码</li>
</ul>
<h2 id="4-文本处理">4. 文本处理</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/fluent_python/string_coding.png"
        data-srcset="/images/fluent_python/string_coding.png, /images/fluent_python/string_coding.png 1.5x, /images/fluent_python/string_coding.png 2x"
        data-sizes="auto"
        alt="/images/fluent_python/string_coding.png"
        title="文本处理最佳模式" /></p>
<ul>
<li>要尽早把输入（例如读取文件时）的字节序列解码成字符串</li>
<li>程序的业务逻辑，只处理字符串对象</li>
<li>对输出来说，则要尽量晚地把字符串编码成字节序列</li>
<li>打开文件时始终应该明确传入 encoding= 参数</li>
</ul>
<h2 id="5-文本规范化和排序">5. 文本规范化和排序</h2>
<h3 id="51-文本规范化">5.1 文本规范化</h3>
<p>内容太多，详见数 99-105</p>
<h3 id="52-unicode文本排序">5.2 Unicode文本排序</h3>
<p>PyUCA:</p>
<ul>
<li>作用: Unicode 排序算法(UCA)的纯 Python 实现</li>
<li>文档: <a href="https://pypi.python.org/pypi/pyuca/" target="_blank" rel="noopener noreffer">https://pypi.python.org/pypi/pyuca/</a></li>
<li>附注:
<ul>
<li>PyUCA 没有考虑区域设置</li>
<li>定制排序方式，可以把自定义的排序表路径传给Collator()构造方法</li>
<li>默认使用项目自带的allkeys.txt 即Unicode 6.3.0 的副本</li>
<li><a href="http://www.unicode.org/Public/UCA/6.3.0/allkeys.txt" target="_blank" rel="noopener noreffer">http://www.unicode.org/Public/UCA/6.3.0/allkeys.txt</a></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pyuca</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">coll</span> <span class="o">=</span> <span class="n">pyuca</span><span class="o">.</span><span class="n">Collator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;caju&#39;</span><span class="p">,</span>  <span class="s1">&#39;atemoia&#39;</span><span class="p">,</span>  <span class="s1">&#39;cajá&#39;</span><span class="p">,</span>  <span class="s1">&#39;açaí&#39;</span><span class="p">,</span>  <span class="s1">&#39;acerola&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">sorted_fruits</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fruits</span><span class="p">,</span>  <span class="n">key</span><span class="o">=</span><span class="n">coll</span><span class="o">.</span><span class="n">sort_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">sorted_fruits</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;açaí&#39;</span><span class="p">,</span>  <span class="s1">&#39;acerola&#39;</span><span class="p">,</span>  <span class="s1">&#39;atemoia&#39;</span><span class="p">,</span>  <span class="s1">&#39;cajá&#39;</span><span class="p">,</span>  <span class="s1">&#39;caju&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="53-unicode数据库">5.3 Unicode数据库</h3>
<p>数据库内容:</p>
<ul>
<li>码位与字符名称之间的映射</li>
<li>各个字符的元数据</li>
<li>字符之间的关系</li>
<li>eg: 字符是否可以打印、是不是字母、是不是数字，或者是不是其他数值符号</li>
<li>字符串的 isidentifier、 isprintable、 isdecimal 等方法就是靠这些信息作判断</li>
</ul>
<p>unicodedata</p>
<ul>
<li>作用: 获取字符的元数据</li>
<li>文档: <a href="https://docs.python.org/3/library/unicodedata.html" target="_blank" rel="noopener noreffer">https://docs.python.org/3/library/unicodedata.html</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">unicodedata</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">re_digit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sample</span> <span class="o">=</span> <span class="s1">&#39;1</span><span class="se">\xbc\xb2\u0969\u136b\u216b\u2466\u2480\u3285</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;U+</span><span class="si">%04x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">char</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;re_dig&#39;</span> <span class="k">if</span> <span class="n">re_digit</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;isdig&#39;</span> <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;isnum&#39;</span> <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nb">format</span><span class="p">(</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">char</span><span class="p">),</span>  <span class="s1">&#39;5.2f&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54-双模式-api">5.4 双模式 API</h3>
<p>能接受字符串或字节序列为参数，然后根据类型进行特殊处理的函数</p>
<h4 id="re">re</h4>
<p>双模式:</p>
<ul>
<li>如果使用字节序列构建正则表达式， \d 和 \w 等模式只能匹配 ASCII 字符</li>
<li>如果是字符串模式，就能匹配 ASCII 之外的 Unicode 数字或字母</li>
<li>字节序列只能用字节序列正则表达式搜索</li>
<li>字符串正则表达式有个 re.ASCII 标志，它让 \w、 \W、 \b、 \B、 \d、 \D、 \s 和 \S
只匹配ASCII 字符</li>
</ul>
<p>附注:</p>
<ul>
<li>re 模块对 Unicode 的支持并不充分</li>
<li>PyPI 中新开发的regex 模块，用以取代 re 模块，以提供更好的 Unicode 支持</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">re_numbers_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">)</span>  <span class="c1"># 前两个正则表达式是字符串类型</span>
</span></span><span class="line"><span class="cl"><span class="n">re_words_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">re_numbers_bytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rb</span><span class="s1">&#39;\d+&#39;</span><span class="p">)</span> <span class="c1"># 后两个正则表达式是字节序列类型</span>
</span></span><span class="line"><span class="cl"><span class="n">re_words_bytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rb</span><span class="s1">&#39;\w+&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">text_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;Ramanujan saw </span><span class="se">\u0be7\u0bed\u0be8\u0bef</span><span class="s2">&#34;</span> <span class="err">➌</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; as 1729 = 1³ + 12³ = 9³ + 10³.&#34;</span><span class="p">)</span> <span class="err">➍</span>
</span></span><span class="line"><span class="cl"><span class="n">text_bytes</span> <span class="o">=</span> <span class="n">text_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf_8&#39;</span><span class="p">)</span> <span class="c1"># 字节序列只能用字节序列正则表达式搜索。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span>  <span class="nb">repr</span><span class="p">(</span><span class="n">text_str</span><span class="p">),</span>  <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Numbers&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; str :&#39;</span><span class="p">,</span>  <span class="n">re_numbers_str</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text_str</span><span class="p">))</span> <span class="err">➏</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; bytes:&#39;</span><span class="p">,</span>  <span class="n">re_numbers_bytes</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text_bytes</span><span class="p">))</span> <span class="err">➐</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Words&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; str :&#39;</span><span class="p">,</span>  <span class="n">re_words_str</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text_str</span><span class="p">))</span> <span class="err">➑</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; bytes:&#39;</span><span class="p">,</span>  <span class="n">re_words_bytes</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text_bytes</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="os函数中的字符串和字节序列">os函数中的字符串和字节序列？？</h3>
<h4 id="背景">背景:</h4>
<ul>
<li>GNU/Linux 内核不理解 Unicode，对任何合理的编码方案来说，在文
件名中使用字节序列都是无效的，无法解码成字符串</li>
<li>为解决这个问题，os模块中的所有函数、文件名或路径名参数既能使用字符
串，也能使用字节序列</li>
<li>如果函数使用字符串参数调用，该参数会使用 sys.getfilesystemencoding()
得到的编解码器自动编码，然后操作系统会使用相同的编解码器解码</li>
<li>如果必须处理（也可能是修正）那些无法使用上述方式自动处理的文件名，可以把
字节序列参数传给 os 模块中的函数，得到字节序列返回值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="c1"># ➊</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;abc.txt&#39;</span><span class="p">,</span>  <span class="s1">&#39;digits-of-π.txt&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="c1"># 参数是字节序列， listdir 函数返回的文件名也是字节序列</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;abc.txt&#39;</span><span class="p">,</span>  <span class="sa">b</span><span class="s1">&#39;digits-of-</span><span class="se">\xcf\x80</span><span class="s1">.txt&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="可用函数">可用函数</h4>
<p>fsencode(filename):</p>
<ul>
<li>如果 filename 是 str 类型（此外还可能是 bytes 类型），使用
sys.getfilesystemencoding()返回的编解码器把 filename 编码成字节序列;
否则，返回未经修改的 filename 字节序列</li>
</ul>
<p>fsdecode(filename):</p>
<ul>
<li>如果 filename 是 bytes 类型（此外还可能是 str 类型），使用
sys.getfilesystemencoding() 返回的编解码器把 filename 解码成字符串;
否则，返回未经修改的 filename字符串</li>
</ul>
<p>在 Unix 衍生平台中，上述函数使用 surrogateescape 错误处理方式</p>
<ul>
<li>作用: 是处理意外字节序列或未知编码的一种方式, 可以避免遇到意外字节序列时卡住</li>
<li>文档: <a href="https://www.python.org/dev/peps/pep-0383/" target="_blank" rel="noopener noreffer">https://www.python.org/dev/peps/pep-0383/</a></li>
<li>实现:
<ul>
<li>把每个无法解码的字节替换成 Unicode 中 U+DC00 到 U+DCFF 之间的码位</li>
<li>这些码位是保留的，没有分配字符，供应用程序内部使用</li>
<li>编码时，这些码位会还原成被替换的字节值</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;abc.txt&#39;</span><span class="p">,</span>  <span class="s1">&#39;digits-of-π.txt&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>   <span class="c1"># 假设我们不知道编码，获取文件名的字节序列形式。</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;abc.txt&#39;</span><span class="p">,</span>  <span class="sa">b</span><span class="s1">&#39;digits-of-</span><span class="se">\xcf\x80</span><span class="s1">.txt&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">pi_name_bytes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 &#39;ascii&#39; 编解码器和 &#39;surrogateescape&#39; 错误处理方式把它解码成字符串</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">pi_name_str</span> <span class="o">=</span> <span class="n">pi_name_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span>  <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">pi_name_str</span> <span class="c1"># 非 ASCII 字节替换成代替码位:  &#39;\xcf\x80&#39; 变成了 &#39;\udccf\udc80&#39;</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;digits-of-</span><span class="se">\udccf\udc80</span><span class="s1">.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">pi_name_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span>  <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span> <span class="err">➏</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;digits-of-</span><span class="se">\xcf\x80</span><span class="s1">.txt&#39;</span> <span class="c1"># 编码成 ASCII 字节序列: 各个代替码位还原成被替换的字节</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="延伸阅读">延伸阅读</h2>
<h3 id="python">Python:</h3>
<p>标准库</p>
<ul>
<li>mmap:</li>
<li>作用: 将文件打开为内存映射文件</li>
<li>url: <a href="https://docs.python.org/3/library/mmap.html" target="_blank" rel="noopener noreffer">https://docs.python.org/3/library/mmap.html</a></li>
<li>unicode:
<ul>
<li><a href="https://docs.python.org/3/howto/unicode.html" target="_blank" rel="noopener noreffer">https://docs.python.org/3/howto/unicode.html</a></li>
</ul>
</li>
<li>codecs:
<ul>
<li><a href="https://docs.python.org/3/library/codecs.html#standard-encodings" target="_blank" rel="noopener noreffer">https://docs.python.org/3/library/codecs.html#standard-encodings</a></li>
<li><a href="https://hg.python.org/cpython/file/6dcc96fa3970/Tools/unicode/listcodecs.py" target="_blank" rel="noopener noreffer">https://hg.python.org/cpython/file/6dcc96fa3970/Tools/unicode/listcodecs.py</a></li>
</ul>
</li>
</ul>
<p>Python3.5新特性</p>
<ul>
<li>二进制序列引入新的构造方法和方法
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0467/" target="_blank" rel="noopener noreffer">https://www.python.org/dev/peps/pep-0467/</a></li>
</ul>
</li>
<li>Adding % formatting to bytes
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0461/" target="_blank" rel="noopener noreffer">https://www.python.org/dev/peps/pep-0461/</a></li>
</ul>
</li>
</ul>
<h3 id="blog">blog:</h3>
<p>unicode 文本规范</p>
<ul>
<li><a href="http://nedbatchelder.com/text/unipain.html" target="_blank" rel="noopener noreffer">http://nedbatchelder.com/text/unipain.html</a></li>
<li><a href="http://www.slideshare.net/fischertrav/character-encoding-unicode-how-towith-dignity-33352863" target="_blank" rel="noopener noreffer">http://www.slideshare.net/fischertrav/character-encoding-unicode-how-towith-dignity-33352863</a></li>
<li><a href="http://pyvideo.org/pycon-us-2014/character-encoding-and-unicodein-python.html" target="_blank" rel="noopener noreffer">http://pyvideo.org/pycon-us-2014/character-encoding-and-unicodein-python.html</a></li>
<li><a href="https://regebro.wordpress.com/2011/03/23/unconfusing-unicode-what-is-unicode/" target="_blank" rel="noopener noreffer">https://regebro.wordpress.com/2011/03/23/unconfusing-unicode-what-is-unicode/</a></li>
</ul>
<p>python 版本差异:</p>
<ul>
<li><a href="https://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-ofunicode-vs-8-bit" target="_blank" rel="noopener noreffer">https://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-ofunicode-vs-8-bit</a></li>
<li><a href="http://lucumr.pocoo.org/2013/7/2/theupdated-guide-to-unicode/" target="_blank" rel="noopener noreffer">http://lucumr.pocoo.org/2013/7/2/theupdated-guide-to-unicode/</a></li>
</ul>
<p>文本与二进制序列</p>
<ul>
<li><a href="http://python-notes.curiousefficiency.org/en/latest/python3/binary_protocols.html" target="_blank" rel="noopener noreffer">http://python-notes.curiousefficiency.org/en/latest/python3/binary_protocols.html</a></li>
<li><a href="http://python-notes.curiousefficiency.org/en/latest/python3/text_file_processing.html" target="_blank" rel="noopener noreffer">http://python-notes.curiousefficiency.org/en/latest/python3/text_file_processing.html</a></li>
</ul>
<p>sys.getdefaultencoding()</p>
<ul>
<li><a href="http://blog.startifact.com/posts/older/changing-the-python-default-encoding-considered-harmful.html" target="_blank" rel="noopener noreffer">http://blog.startifact.com/posts/older/changing-the-python-default-encoding-considered-harmful.html</a></li>
<li><a href="http://blog.ziade.org/2008/01/08/syssetdefaultencoding-isevil/" target="_blank" rel="noopener noreffer">http://blog.ziade.org/2008/01/08/syssetdefaultencoding-isevil/</a></li>
</ul>
<h3 id="实用工具">实用工具</h3>
<p>AsciiDoc:</p>
<ul>
<li><a href="http://www.methods.co.nz/asciidoc/" target="_blank" rel="noopener noreffer">http://www.methods.co.nz/asciidoc/</a></li>
</ul>
<h3 id="书籍">书籍:</h3>
<p>Dive into Python:</p>
<ul>
<li><a href="http://www.diveintopython3.net" target="_blank" rel="noopener noreffer">http://www.diveintopython3.net</a></li>
<li><a href="http://www.diveintopython3.net/strings.html" target="_blank" rel="noopener noreffer">http://www.diveintopython3.net/strings.html</a></li>
<li><a href="http://getpython3.com/diveintopython3/case-study-porting-chardet-to-python-3.html" target="_blank" rel="noopener noreffer">http://getpython3.com/diveintopython3/case-study-porting-chardet-to-python-3.html</a></li>
</ul>
<p>Programming with Unicode:</p>
<ul>
<li><a href="http://unicodebook.readthedocs.org/index.html" target="_blank" rel="noopener noreffer">http://unicodebook.readthedocs.org/index.html</a></li>
</ul>
<p>unicdoe规范化:</p>
<ul>
<li><a href="https://www.w3.org/International/wiki/Case_folding" target="_blank" rel="noopener noreffer">https://www.w3.org/International/wiki/Case_folding</a></li>
<li><a href="https://www.w3.org/TR/charmod-norm/" target="_blank" rel="noopener noreffer">https://www.w3.org/TR/charmod-norm/</a></li>
<li><a href="http://unicode.org/reports/tr15/" target="_blank" rel="noopener noreffer">http://unicode.org/reports/tr15/</a></li>
<li><a href="http://www.unicode.org/faq/normalization.htm" target="_blank" rel="noopener noreffer">http://www.unicode.org/faq/normalization.htm</a></li>
<li><a href="http://www.macchiato.com/unicode/nfc-faq" target="_blank" rel="noopener noreffer">http://www.macchiato.com/unicode/nfc-faq</a></li>
</ul>
<h2 id="杂谈">杂谈</h2>
<p>在RAM 中如何表示字符串</p>
<ul>
<li>详细介绍: <a href="https://www.python.org/dev/peps/pep-0393/" target="_blank" rel="noopener noreffer">https://www.python.org/dev/peps/pep-0393/</a></li>
<li>在 Python 3.3 之前，编译 CPython 时可以配置在内存中使用 16 位或 32 位存储各个码位</li>
<li>从 Python 3.3 起，创建 str 对象时，解释器会检查里面的字符，
然后为该字符串选择最经济的内存布局</li>
<li>灵活的字符串表述类似于 Python 3 对 int 类型的处理方式: 如果一个整数在一个机器
字中放得下，那就存储在一个机器字中; 否则解释器切换成变长表述，类似于 Python 2中的 long 类型</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-03-10&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/30628257d547483ceb89c29b3683ac87ee0e5112" target="_blank" title="commit by tsong(tsong@example.com) 30628257d547483ceb89c29b3683ac87ee0e5112: python 语法和 wrapt的模块">
                                    <i class="fas fa-hashtag fa-fw"></i>3062825</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/program/python/grammar/fluent-python/04_string/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" data-title="文本和字节序列" data-hashtags="python 进阶"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" data-hashtag="python 进阶"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" data-title="文本和字节序列"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" data-title="文本和字节序列"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hotttao.github.io/posts/program/python/grammar/fluent-python/04_string/" data-title="文本和字节序列" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/python-%E8%BF%9B%E9%98%B6/">python 进阶</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/linux/linux_mt/04-linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" class="prev" rel="prev" title="4.1 Linux目录结构"><i class="fas fa-angle-left fa-fw"></i>4.1 Linux目录结构</a>
            <a href="/posts/linux/linux_mt/04-linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/bash%E5%B8%B8%E8%A7%81%E7%89%B9%E6%80%A7/" class="next" rel="next" title="4.2 bash常见特性">4.2 bash常见特性<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.93.3">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">宋涛</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{"gitalk":{"admin":["hotttao"],"clientID":"7b48df1b81d23057c798","clientSecret":"65c6f9e6ca6ae4d8105f757578b6b594e3668e61","id":"2018-01-04T22:00:00+08:00","owner":"hotttao","repo":"hotttao.github.io","title":"文本和字节序列"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
