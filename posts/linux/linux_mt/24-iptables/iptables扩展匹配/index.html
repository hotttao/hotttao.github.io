<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>21.3 iptables扩展匹配 - LoveIt</title><meta name="Description" content="21.3 iptables扩展匹配"><meta property="og:title" content="21.3 iptables扩展匹配" />
<meta property="og:description" content="21.3 iptables扩展匹配" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" /><meta property="og:image" content="https://hotttao.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-31T22:10:00+08:00" />
<meta property="article:modified_time" content="2018-03-31T22:10:00+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hotttao.github.io/logo.png"/>

<meta name="twitter:title" content="21.3 iptables扩展匹配"/>
<meta name="twitter:description" content="21.3 iptables扩展匹配"/>
<meta name="application-name" content="宋涛的个人博客">
<meta name="apple-mobile-web-app-title" content="宋涛的个人博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" /><link rel="prev" href="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/" /><link rel="next" href="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/%E7%BD%91%E7%BB%9C%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "21.3 iptables扩展匹配",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/hotttao.github.io\/posts\/linux\/linux_mt\/24-iptables\/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D\/"
        },"image": ["https:\/\/hotttao.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "马哥 Linux","wordcount":  3702 ,
        "url": "https:\/\/hotttao.github.io\/posts\/linux\/linux_mt\/24-iptables\/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D\/","datePublished": "2018-03-31T22:10:00+08:00","dateModified": "2018-03-31T22:10:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/hotttao.github.io\/images\/hugo\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "宋涛"
            },"description": "21.3 iptables扩展匹配"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="LoveIt"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>宋涛的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/go/"> Go </a><a class="menu-item" href="/categories/linux/"> Linux </a><a class="menu-item" href="/categories/distributed/"> 分布式 </a><a class="menu-item" href="/categories/distributed/"> 架构 </a><a class="menu-item" href="/posts/about/"> 关于 </a><a class="menu-item" href="https://github.com/hotttao/" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="LoveIt"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>宋涛的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/go/" title="">Go</a><a class="menu-item" href="/categories/linux/" title="">Linux</a><a class="menu-item" href="/categories/distributed/" title="">分布式</a><a class="menu-item" href="/categories/distributed/" title="">架构</a><a class="menu-item" href="/posts/about/" title="">关于</a><a class="menu-item" href="https://github.com/hotttao/" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">21.3 iptables扩展匹配</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://hotttao.github.io/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>宋涛</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/linux/"><i class="far fa-folder fa-fw"></i>Linux</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2018-03-31">2018-03-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3702 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-iptables-可用显示扩展">1. iptables 可用显示扩展</a>
      <ul>
        <li><a href="#11-multiport扩展">1.1 multiport扩展</a></li>
        <li><a href="#12-iprange扩展">1.2 iprange扩展</a></li>
        <li><a href="#13-string扩展">1.3 string扩展</a></li>
        <li><a href="#14-time扩展">1.4 time扩展</a></li>
        <li><a href="#15-connlimit扩展">1.5 connlimit扩展</a></li>
        <li><a href="#16-limit扩展">1.6 limit扩展</a></li>
      </ul>
    </li>
    <li><a href="#2-state扩展">2. state扩展</a>
      <ul>
        <li><a href="#21-连接追踪">2.1 连接追踪</a></li>
        <li><a href="#22-连接追踪相关配置">2.2 连接追踪相关配置</a></li>
        <li><a href="#23-state-扩展">2.3 state 扩展</a></li>
        <li><a href="#24-state-扩展相关问题">2.4 state 扩展相关问题</a></li>
        <li><a href="#25-如何开放被动模式的ftp服务">2.5 如何开放被动模式的ftp服务</a></li>
      </ul>
    </li>
    <li><a href="#3-iptables-规则管理">3. iptables 规则管理</a>
      <ul>
        <li><a href="#31-规则优化">3.1 规则优化</a></li>
        <li><a href="#32-自定义链">3.2 自定义链</a></li>
        <li><a href="#33-规则的保存及重载">3.3 规则的保存及重载</a>
          <ul>
            <li><a href="#iptables-save">iptables-save</a></li>
            <li><a href="#iptables-restore">iptables-restore</a></li>
          </ul>
        </li>
        <li><a href="#34-iptables-规则开机自动载入">3.4 iptables 规则开机自动载入</a>
          <ul>
            <li><a href="#centos-6">Centos 6</a></li>
            <li><a href="#centos-7">CentOS 7</a></li>
          </ul>
        </li>
        <li><a href="#5-练习">5. 练习</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>iptables扩展匹配</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/linux_mt/linux_iptables.jpg"
        data-srcset="/images/linux_mt/linux_iptables.jpg, /images/linux_mt/linux_iptables.jpg 1.5x, /images/linux_mt/linux_iptables.jpg 2x"
        data-sizes="auto"
        alt="/images/linux_mt/linux_iptables.jpg"
        title="linux-mt" /></p>
<!-- more -->
<p>上一节我们基本上把 iptables 基本使用方法讲完了，而且我们提到过 iptables 是高度模块化的，为在报文匹配和处理动作提供了很多扩展模块，本节我们就来介绍这些扩展模块的使用。可以使用如下命令查看这些扩展模块的帮助信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># CentOS 6
</span></span><span class="line"><span class="cl">man iptables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># CentOS 7
</span></span><span class="line"><span class="cl">man iptables-extensions
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rpm -ql iptables|grep &#39;[[:lower:]]\+\.so$&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="1-iptables-可用显示扩展">1. iptables 可用显示扩展</h2>
<h3 id="11-multiport扩展">1.1 multiport扩展</h3>
<ul>
<li>作用: 以离散方式定义多端口匹配；最多指定15个端口；</li>
<li>参数:
<ul>
<li><code>[!] --source-ports,--sports port[,port|,port:port]</code>&hellip;：指定多个源端口；</li>
<li><code>[!] --destination-ports,--dports port[,port|,port:port]</code>&hellip;：指定多个目标端口；</li>
<li><code>[!] --ports port[,port|,port:port]</code>&hellip;：指明多个端口；</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -A INPUT -s 172.16.0.0/16 -d 172.16.100.67 -p tcp -m multiport --dports 22,80 -j ACCEPT
</span></span><span class="line"><span class="cl">&gt; iptables -A OUTPUT -s 172.16.100.67 -d  172.16.0.0/16 -p tcp -m multiport --sports 22,80 -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="12-iprange扩展">1.2 iprange扩展</h3>
<ul>
<li>作用: 指明连续的（但一般不能扩展为整个网络）ip地址范围；</li>
<li>参数:
<ul>
<li><code>[!] --src-range from[-to]</code>：源IP地址；</li>
<li><code>[!] --dst-range from[-to]</code>：目标IP地址；</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -A INPUT -d 172.16.100.67 -p tcp --dport 80 -m iprange --src-range 172.16.100.5-172.16.100.10 -j DROP
</span></span><span class="line"><span class="cl">&gt; iptables -I INPUT -d 172.16.100.67 -p tcp -m multiport 22:23,80 -m iprange --src-range 172.16.100.1-172.168.100.120 -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13-string扩展">1.3 string扩展</h3>
<ul>
<li>作用: 对报文中的应用层数据做字符串模式匹配检测；</li>
<li>参数:
<ul>
<li><code>--algo {bm|kmp}</code>：字符串匹配检测算法；
<ul>
<li>bm：Boyer-Moore</li>
<li>kmp：Knuth-Pratt-Morris</li>
</ul>
</li>
<li><code>[!] --string pattern</code>：要检测的字符串模式；</li>
<li><code>[!] --hex-string pattern</code>：要检测的字符串模式，16进制格式；</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -A OUTPUT -s 172.16.100.67 -d 172.16.0.0/16 -p tcp --sport 80 -m string --algo bm --string &#34;gay&#34; -j REJECT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="14-time扩展">1.4 time扩展</h3>
<ul>
<li>作用: 根据将报文到达的时间与指定的时间范围进行匹配；</li>
<li>参数:
<ul>
<li><code>--datestart YYYY[-MM[-DD[Thh[:mm[:ss]]]]]</code></li>
<li><code>--timestart hh:mm[:ss]</code></li>
<li><code>--datestop YYYY[-MM[-DD[Thh[:mm[:ss]]]]]</code></li>
<li><code>--timestop hh:mm[:ss]</code></li>
<li><code>[!] --monthdays day[,day...]</code></li>
<li><code>[!] --weekdays day[,day...]</code></li>
<li><code>--kerneltz</code>：使用内核上的时区，而非默认的UTC；</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -A INPUT -s 172.16.0.0/16 -d 172.16.100.67 -p tcp --dport 80 -m time --timestart 14:30 --timestop 18:30 --weekdays Sat,Sun --kerneltz -j DROP
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="15-connlimit扩展">1.5 connlimit扩展</h3>
<ul>
<li>作用: 根据每客户端IP(也可以是地址块)做并发连接数数量匹配；</li>
<li>参数:
<ul>
<li><code>--connlimit-upto n</code>：连接的数量小于等于n时匹配；</li>
<li><code>--connlimit-above n</code>：连接的数量大于n时匹配；</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -A INPUT -d 172.16.100.67 -p tcp --dport 21 -m connlimit --connlimit-above 2 -j REJECT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="16-limit扩展">1.6 limit扩展</h3>
<ul>
<li>作用: 基于收发报文的速率做匹配，匹配的发送报文数，而不是报文大小</li>
<li>原理: 令牌桶过滤器，进程在发送报文之前必需获取令牌，一个报文一个，通过限制令牌的发放速率达到限制报文发送速率</li>
<li>参数:
<ul>
<li><code>--limit rate[/second|/minute|/hour|/day]</code>: 报文发送的速率</li>
<li><code>--limit-burst number</code>: 进程在空闲时可收集的最大令排数</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -I INPUT -d 172.16.100.67 -p icmp --icmp-type 8 -m limit --limit 30/minute --limit-burst 5 -j ACCEPT
</span></span><span class="line"><span class="cl">&gt; iptables -I INPUT 2 -p icmp -j REJECT
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-state扩展">2. state扩展</h2>
<h3 id="21-连接追踪">2.1 连接追踪</h3>
<p>iptables 的 state 会启动内核的连接追踪机制，即内核在会在内存中记录一段时间内与主机通信过的主机，这样在相应主机再次访问本机时，就能追踪其连接状态。iptables 就能根据”连接追踪机制“去检查连接的状态。连接追踪与通信协议没有任何关系，是内核记录连接状态的一种机制，它有如下几种状态:</p>
<ul>
<li><code>NEW</code>：新发出请求；连接追踪模板中不存在此连接的相关信息条目，因此，将其识别为第一次发出的请求；</li>
<li><code>ESTABLISHED</code>：NEW状态之后，连接追踪模板中为其建立的条目失效之前期间内所进行的通信状态；</li>
<li><code>RELATED</code>：相关联的连接；如ftp协议中的数据连接与命令连接之间的关系；</li>
<li><code>INVALID</code>：无效的连接；</li>
<li><code>UNTRACKED</code>：未进行追踪的连接</li>
</ul>
<p>连接追踪有时长限制，如果一条连接在设置的时长范围内没有再次发生连接，此连接记录就会被删除。下此与对应的主机再次建立连接时就会被当作新连接被重新记录。连接追踪机制非常耗费内容，如果连接追踪占据了所有的内存，新的连接就无法建立，因此不要在连接非常繁忙的反代服务器上开启连接追踪机制。如果一定要开启连接追踪机制，一是要准备足够大的内存，二是调大 <code>nf_conntrack_max</code> 的值。</p>
<h3 id="22-连接追踪相关配置">2.2 连接追踪相关配置</h3>
<p>内核会在如下文件中记录连接追踪相关的信息:</p>
<ol>
<li><code>/proc/net/nf_conntrack</code>:
<ul>
<li>作用: 已经追踪到并记录下来的连接</li>
</ul>
</li>
<li><code>/proc/sys/net/netfilter/nf_conntrack_max</code>
<ul>
<li>作用: 连接追踪功能所能够容纳的最大连接数量的配置文件</li>
<li>注意: 在一个非常繁忙的服务器上，一是要准备足够大的内存，二是将此配置调大</li>
</ul>
</li>
<li><code>/proc/sys/net/netfilter/*timeout*</code>: 不同的协议的连接追踪时长</li>
</ol>
<h3 id="23-state-扩展">2.3 state 扩展</h3>
<ul>
<li>作用: 对连接追踪的状态做匹配</li>
<li>参数: <code>[!] --state state</code></li>
<li>配置:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; iptables -A INPUT -d 172.16.100.67 -p tcp -m multiport --dports 22,80 -m state --state NEW,ESTABLISHED -j ACCEPT
</span></span><span class="line"><span class="cl">&gt; iptables -A OUTPUT -s 172.16.100.67 -p tcp -m multiport --sports 22,80 -m state --state ESTABLISHED -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; iptables -I OUTPUT -m state --state ESTABLISHED -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="24-state-扩展相关问题">2.4 state 扩展相关问题</h3>
<p>iptables的链接跟踪表最大容量为<code>/proc/sys/net/netfilter/nf_conntrack_max</code>配置的值，
链接碰到各种状态的超时后就会从表中删除；当内存满载时，后续的连接可能会超时
解決方法一般有两个：</p>
<ol>
<li>加大 nf_conntrack_max 值</li>
<li>降低 nf_conntrack timeout时间</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 加大 nf_conntrack_max 值
</span></span><span class="line"><span class="cl">vi /etc/sysctl.conf
</span></span><span class="line"><span class="cl">net.ipv4.nf_conntrack_max = 393216
</span></span><span class="line"><span class="cl">net.ipv4.netfilter.nf_conntrack_max = 393216
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 降低 nf_conntrack timeout时间
</span></span><span class="line"><span class="cl">vi /etc/sysctl.conf
</span></span><span class="line"><span class="cl">net.ipv4.netfilter.nf_conntrack_tcp_timeout_established = 300
</span></span><span class="line"><span class="cl">net.ipv4.netfilter.nf_conntrack_tcp_timeout_time_wait = 120
</span></span><span class="line"><span class="cl">net.ipv4.netfilter.nf_conntrack_tcp_timeout_close_wait = 60
</span></span><span class="line"><span class="cl">net.ipv4.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">iptables -t nat -L -n
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="25-如何开放被动模式的ftp服务">2.5 如何开放被动模式的ftp服务</h3>
<ol>
<li>装载ftp连接追踪的专用模块：</li>
<li>放行命令连接(假设Server地址为172.16.100.67)：</li>
<li>放行数据连接(假设Server地址为172.16.100.67)：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1. 装载ftp连接追踪的专用模块
</span></span><span class="line"><span class="cl">&gt; modinfo /lib/modules/3.10.0-514.el7.x86_64/kernel/net/netfilter/nf_conntrack_ftp
</span></span><span class="line"><span class="cl">&gt; modproble  nf_conntrack_ftp
</span></span><span class="line"><span class="cl">&gt; lsmod
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 2. 放行请求报文
</span></span><span class="line"><span class="cl">#    命令连接: NEW, ESTABLISHED
</span></span><span class="line"><span class="cl">#    数据连接: RELATED(仅数据连接的第一次连接建立), ESTABLISHED
</span></span><span class="line"><span class="cl">&gt; iptables -A INPUT -d 172.16.100.67 -p tcp --dport 21 -m state --state **NEW,ESTABLISHED** -j ACCEPT
</span></span><span class="line"><span class="cl">&gt; iptables -A OUTPUT -s 172.16.100.67 -p tcp --sport 21 -m state --state ESTABLISHED -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 3. 放行响应报文  ESTABLISHED
</span></span><span class="line"><span class="cl">&gt; iptables -A INPUT -d 172.16.100.67 -p tcp -m state --state **RELATED,ESTABLISHED** -j ACCEPT
</span></span><span class="line"><span class="cl">&gt; iptables -I OUTPUT -s 172.16.100.67 -p tcp -m state --state ESTABLISHED -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 4. 合并 iptables 规则
</span></span><span class="line"><span class="cl">iptables -t filter -A INPUT -m --state ESTABLISHED,RELATED -j ACCEPT
</span></span><span class="line"><span class="cl">iptables -t filter -A INPUT -p tcp -d 192.168.1.108 -m multiport --dports 21,22,80 -m state --state NEW -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">iptable -t filter -A OUTPUT -m --state ESTABLISHED -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-iptables-规则管理">3. iptables 规则管理</h2>
<h3 id="31-规则优化">3.1 规则优化</h3>
<p>我们已经学习了很多 iptables 的扩展模块，有一些通用原则可以帮助我们优化 iptables 的规则</p>
<ol>
<li>使用自定义链管理特定应用的相关规则，模块化管理</li>
<li>可安全放行所有入站的状态为ESTABLISHED状态的连接；</li>
<li>可安全放行所有出站的状态为ESTABLISHED状态的连接；</li>
<li>谨慎放行入站的新请求</li>
<li>有特殊目的限制访问功能，要于放行规则之前加以拒绝；</li>
<li>载规则的最后自定义默认策略，而不是直接使用 iptables 的默认策略，放置意外将 iptables 规则清空导致 ssh 无法连接至服务器</li>
</ol>
<h3 id="32-自定义链">3.2 自定义链</h3>
<p>自定义链需要被内置链调用才能生效，且自定义链最后需要定义返回内置链。返回规则使用的处理动作叫做 <code>RETURN</code>，默认自定义链最后会自动 return 到调用链，提前返回需要提前显示 return。下面是自定义链的一个示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ iptables -N ping_rule   # 创建自定义链
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 向自定义链添加规则
</span></span><span class="line"><span class="cl">$ iptables -A ping_rule -d 192.168.1.168 -p icmp --icmp-type 8 -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 被内置链调用
</span></span><span class="line"><span class="cl">$ iptables -A INPUT -d 192.168.1.168 -p icmp -j ping_rule
</span></span><span class="line"><span class="cl">$ iptales -L
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-规则的保存及重载">3.3 规则的保存及重载</h3>
<p>使用iptables命令定义的规则，会立刻送往内核，手动删除之前，其生效期限为kernel存活期限。永久保存需要手动保存规则至指定的文件中，需要时可重载保存于文件中的规则。</p>
<h4 id="iptables-save">iptables-save</h4>
<p><code>iptables-save &gt; path</code>:</p>
<ul>
<li>作用: 输出当前的 iptables 规则至终端，保存至文件需要重定向</li>
</ul>
<h4 id="iptables-restore">iptables-restore</h4>
<p><code>iptables-restore options &lt; path</code></p>
<ul>
<li>作用: 重载文件中的 iptables 规则</li>
<li>选项:
<ul>
<li><code>-n --noflush</code>: 默认会清除已有规则，此选项表示不清除已有规则，只追加</li>
<li><code>-t --test</code>: 仅分析生成规则集，不提交</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1. 保存规则</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CentOS 6：</span>
</span></span><span class="line"><span class="cl">iptables-save  &gt;  /PATH/TO/SOME_RULES_FILE
</span></span><span class="line"><span class="cl">service  iptables  save  <span class="c1"># 将规则保存至/etc/sysconfig/iptables文件中；</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CentOS 7:</span>
</span></span><span class="line"><span class="cl">iptables-save  &gt;  /PATH/TO/SOME_RULES_FILE
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. 重载规则: 重新载入预存规则文件中的规则          </span>
</span></span><span class="line"><span class="cl">iptables-restore &lt;  /PATH/FROM/SOME_RULES_FILE
</span></span><span class="line"><span class="cl">service  iptables  restart  <span class="c1"># 从 /etc/sysconfig/iptables文件中重载规则，仅限于Centos6</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="34-iptables-规则开机自动载入">3.4 iptables 规则开机自动载入</h3>
<h4 id="centos-6">Centos 6</h4>
<p>Centos 中 iptables 是独立的服务，其管理配置如下所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 开机启动 iptables
</span></span><span class="line"><span class="cl">chkconfig iptables on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables 服务启动脚本
</span></span><span class="line"><span class="cl">/etc/rc.d/init.d/iptables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables 规则的默认配置文件
</span></span><span class="line"><span class="cl">/etc/sysconfig/iptables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables 服务的配置文件
</span></span><span class="line"><span class="cl">/etc/sysconfig/iptables-config
</span></span><span class="line"><span class="cl">  IPTABLES_MODULE=&#34;  # 此选项配置要装载的模块
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 开机自动导入可用脚本保存各iptables命令；让此脚本开机后自动运行；
</span></span><span class="line"><span class="cl"># 或者载自定义脚本中使用 iptables-restore 重载规则文件即可
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="centos-7">CentOS 7</h4>
<p>Centos7 引入了新的iptables前端管理服务工具 firewalld，其包括很多管理工具，比如 <code>firewalld-cmd</code>，<code>firewalld-config</code>。其详细使用方式参见文档: <a href="http://www.ibm.com/developerworks/cn/linux/1507_caojh/index.html" target="_blank" rel="noopener noreffer">http://www.ibm.com/developerworks/cn/linux/1507_caojh/index.html</a></p>
<p>所以在 Centos7 中实现规则开机自动载入，可以</p>
<ol>
<li>编写 Unit 配置文件通过 systemctl 调用 <code>iptables-restore</code> 实现</li>
<li>借助于 firewalld</li>
<li>编写脚本，对于 iptables，最好还是使用此种方式，而且最好不要开机自动载入以免产生问题</li>
</ol>
<h3 id="5-练习">5. 练习</h3>
<p>练习：INPUT和OUTPUT默认策略为DROP；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、限制本地主机的web服务器在周一不允许访问；新请求的速率不能超过100个每秒；web服务器包含了admin字符串的页面不允许访问；web服务器仅允许响应报文离开本机；
</span></span><span class="line"><span class="cl">2、在工作时间，即周一到周五的8:30-18:00，开放本机的ftp服务给172.16.0.0网络中的主机访问；数据下载请求的次数每分钟不得超过5个；
</span></span><span class="line"><span class="cl">3、开放本机的ssh服务给172.16.x.1-172.16.x.100中的主机，x为你的学号，新请求建立的速率一分钟不得超过2个；仅允许响应报文通过其服务端口离开本机；
</span></span><span class="line"><span class="cl">4、拒绝TCP标志位全部为1及全部为0的报文访问本机；
</span></span><span class="line"><span class="cl">5、允许本机ping别的主机；但不开放别的主机ping本机；
</span></span></code></pre></td></tr></table>
</div>
</div><p>练习：判断下述规则的意义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># iptables -N clean_in
</span></span><span class="line"><span class="cl"># iptables -A clean_in -d 255.255.255.255 -p icmp -j DROP
</span></span><span class="line"><span class="cl"># iptables -A clean_in -d 172.16.255.255 -p icmp -j DROP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables -A clean_in -p tcp ! --syn -m state --state NEW -j DROP
</span></span><span class="line"><span class="cl"># iptables -A clean_in -p tcp --tcp-flags ALL ALL -j DROP
</span></span><span class="line"><span class="cl"># iptables -A clean_in -p tcp --tcp-flags ALL NONE -j DROP
</span></span><span class="line"><span class="cl"># iptables -A clean_in -d 172.16.100.7 -j RETURN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables -A INPUT -d 172.16.100.7 -j clean_in
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables -A INPUT  -i lo -j ACCEPT
</span></span><span class="line"><span class="cl"># iptables -A OUTPUT -o lo -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables -A INPUT  -i eth0 -m multiport -p tcp --dports 53,113,135,137,139,445 -j DROP
</span></span><span class="line"><span class="cl"># iptables -A INPUT  -i eth0 -m multiport -p udp --dports 53,113,135,137,139,445 -j DROP
</span></span><span class="line"><span class="cl"># iptables -A INPUT  -i eth0 -p udp --dport 1026 -j DROP
</span></span><span class="line"><span class="cl"># iptables -A INPUT  -i eth0 -m multiport -p tcp --dports 1433,4899 -j DROP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># iptables -A INPUT  -p icmp -m limit --limit 10/second -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2018-03-31</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" data-title="21.3 iptables扩展匹配" data-hashtags="马哥 Linux"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" data-hashtag="马哥 Linux"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" data-title="21.3 iptables扩展匹配"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" data-title="21.3 iptables扩展匹配"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hotttao.github.io/posts/linux/linux_mt/24-iptables/iptables%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D/" data-title="21.3 iptables扩展匹配" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E9%A9%AC%E5%93%A5-linux/">马哥 Linux</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/linux/linux_mt/24-iptables/iptables%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/" class="prev" rel="prev" title="21.2 iptables使用入门"><i class="fas fa-angle-left fa-fw"></i>21.2 iptables使用入门</a>
            <a href="/posts/linux/linux_mt/24-iptables/%E7%BD%91%E7%BB%9C%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE/" class="next" rel="next" title="21.4 网络防火墙配置">21.4 网络防火墙配置<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.93.3">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">宋涛</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{"gitalk":{"admin":["hotttao"],"clientID":"7b48df1b81d23057c798","clientSecret":"65c6f9e6ca6ae4d8105f757578b6b594e3668e61","id":"2018-03-31T22:10:00+08:00","owner":"hotttao","repo":"hotttao.github.io","title":"21.3 iptables扩展匹配"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
