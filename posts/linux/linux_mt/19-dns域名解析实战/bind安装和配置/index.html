<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>16.3 bind安装和配置 - LoveIt</title><meta name="Description" content="16.3 bind安装和配置"><meta property="og:title" content="16.3 bind安装和配置" />
<meta property="og:description" content="16.3 bind安装和配置" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" /><meta property="og:image" content="https://hotttao.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-09T22:10:00+08:00" />
<meta property="article:modified_time" content="2018-03-09T22:10:00+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hotttao.github.io/logo.png"/>

<meta name="twitter:title" content="16.3 bind安装和配置"/>
<meta name="twitter:description" content="16.3 bind安装和配置"/>
<meta name="application-name" content="宋涛的个人博客">
<meta name="apple-mobile-web-app-title" content="宋涛的个人博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" /><link rel="prev" href="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/dns%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" /><link rel="next" href="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "16.3 bind安装和配置",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/hotttao.github.io\/posts\/linux\/linux_mt\/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98\/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE\/"
        },"image": ["https:\/\/hotttao.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "马哥 Linux","wordcount":  3057 ,
        "url": "https:\/\/hotttao.github.io\/posts\/linux\/linux_mt\/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98\/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE\/","datePublished": "2018-03-09T22:10:00+08:00","dateModified": "2018-03-09T22:10:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/hotttao.github.io\/images\/hugo\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "宋涛"
            },"description": "16.3 bind安装和配置"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="LoveIt"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>宋涛的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/go/"> Go </a><a class="menu-item" href="/categories/linux/"> Linux </a><a class="menu-item" href="/categories/distributed/"> 分布式 </a><a class="menu-item" href="/categories/distributed/"> 架构 </a><a class="menu-item" href="/posts/about/"> 关于 </a><a class="menu-item" href="https://github.com/hotttao/" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="LoveIt"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>宋涛的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/go/" title="">Go</a><a class="menu-item" href="/categories/linux/" title="">Linux</a><a class="menu-item" href="/categories/distributed/" title="">分布式</a><a class="menu-item" href="/categories/distributed/" title="">架构</a><a class="menu-item" href="/posts/about/" title="">关于</a><a class="menu-item" href="https://github.com/hotttao/" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">16.3 bind安装和配置</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://hotttao.github.io/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>宋涛</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/linux/"><i class="far fa-folder fa-fw"></i>Linux</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2018-03-09">2018-03-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3057 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-bind">1. BIND</a>
      <ul>
        <li><a href="#11-bind-安装">1.1 bind 安装</a>
          <ul>
            <li><a href="#rpm-包组成">rpm 包组成</a></li>
            <li><a href="#程序文件">程序文件</a></li>
            <li><a href="#named-checkconf">named-checkconf</a></li>
            <li><a href="#named-checkzone">named-checkzone</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#12-bind-配置文件">1.2 bind 配置文件</a>
      <ul>
        <li><a href="#13-bind-进程管理">1.3 bind 进程管理</a>
          <ul>
            <li><a href="#rndc">rndc</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#2-bind-配置">2. bind 配置</a>
      <ul>
        <li><a href="#21-配置格式">2.1 配置格式</a></li>
        <li><a href="#22-缓存名-dns-服务器配置">2.2 缓存名 DNS 服务器配置</a></li>
      </ul>
    </li>
    <li><a href="#3-正反向解析区域配置">3. 正反向解析区域配置</a>
      <ul>
        <li><a href="#31-正向区域配置">3.1 正向区域配置</a>
          <ul>
            <li><a href="#定义区域">定义区域</a></li>
            <li><a href="#建立区域数据文件">建立区域数据文件</a></li>
            <li><a href="#重启服务">重启服务</a></li>
          </ul>
        </li>
        <li><a href="#32-反向解析区域配置">3.2 反向解析区域配置</a>
          <ul>
            <li><a href="#定义区域-1">定义区域</a></li>
            <li><a href="#建立区域数据文件-1">建立区域数据文件</a></li>
            <li><a href="#重启服务-1">重启服务</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#4-dns-测试工具">4. DNS 测试工具</a>
      <ul>
        <li>
          <ul>
            <li><a href="#dig">dig</a></li>
            <li><a href="#host">host</a></li>
            <li><a href="#nslookup">nslookup</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>bind安装和配置</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/linux_mt/dns_title.jpg"
        data-srcset="/images/linux_mt/dns_title.jpg, /images/linux_mt/dns_title.jpg 1.5x, /images/linux_mt/dns_title.jpg 2x"
        data-sizes="auto"
        alt="/images/linux_mt/dns_title.jpg"
        title="linux-mt" /></p>
<!-- more -->
<p>bind 全称为 Berkeley Internet Name Domain，是 DNS 协议的一种开源实现。由伯克利分校开发，现由 ISC 维护，也是现在使用最为广泛的DNS服务器软件，本节我们就来介绍如何使用 bind 配置一个 DNS 服务器。</p>
<h2 id="1-bind">1. BIND</h2>
<h3 id="11-bind-安装">1.1 bind 安装</h3>
<h4 id="rpm-包组成">rpm 包组成</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ yum install bind
</span></span><span class="line"><span class="cl">$ yum list all bind*
</span></span><span class="line"><span class="cl">已安装的软件包
</span></span><span class="line"><span class="cl">bind.x86_64                   32:9.9.4-61.el7      @base
</span></span><span class="line"><span class="cl">bind-libs.x86_64              32:9.9.4-61.el7      @base
</span></span><span class="line"><span class="cl">bind-libs-lite.x86_64         32:9.9.4-61.el7      @base
</span></span><span class="line"><span class="cl">bind-license.noarch           32:9.9.4-61.el7      @base
</span></span><span class="line"><span class="cl">bind-utils.x86_64             32:9.9.4-61.el7      @base
</span></span></code></pre></td></tr></table>
</div>
</div><p>bind 的 rpm 包主要由以下几个:</p>
<ul>
<li><code>bind</code>：提供的dns server程序、以及几个常用的测试程序；</li>
<li><code>bind-utils</code>：bind客户端程序集，例如dig, host, nslookup等，可用于测试 dns 服务；</li>
<li><code>bind-libs</code>：被bind和bind-utils包中的程序共同用到的库文件；</li>
<li><code>bind-chroot</code>：选装，让named运行于jail模式下,目的是限定 bind 的运行环境，更加安全</li>
</ul>
<h4 id="程序文件">程序文件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ rpm -ql bind<span class="p">|</span>grep sbin
</span></span><span class="line"><span class="cl">/usr/sbin/arpaname
</span></span><span class="line"><span class="cl">/usr/sbin/ddns-confgen
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-checkds      <span class="c1"># DNS 安全扩展</span>
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-coverage
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-dsfromkey
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-importkey
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-keyfromlabel
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-keygen
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-revoke
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-settime
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-signzone
</span></span><span class="line"><span class="cl">/usr/sbin/dnssec-verify
</span></span><span class="line"><span class="cl">/usr/sbin/genrandom
</span></span><span class="line"><span class="cl">/usr/sbin/isc-hmac-fixup
</span></span><span class="line"><span class="cl">/usr/sbin/lwresd
</span></span><span class="line"><span class="cl">/usr/sbin/named                <span class="c1"># bind serve 进程</span>
</span></span><span class="line"><span class="cl">/usr/sbin/named-checkconf      <span class="c1"># bind 配置文件检查</span>
</span></span><span class="line"><span class="cl">/usr/sbin/named-checkzone      <span class="c1"># DNS 数据库区域文件检查</span>
</span></span><span class="line"><span class="cl">/usr/sbin/named-compilezone
</span></span><span class="line"><span class="cl">/usr/sbin/named-journalprint
</span></span><span class="line"><span class="cl">/usr/sbin/nsec3hash
</span></span><span class="line"><span class="cl">/usr/sbin/rndc                <span class="c1"># bind 的远程控制工具</span>
</span></span><span class="line"><span class="cl">/usr/sbin/rndc-confgen
</span></span></code></pre></td></tr></table>
</div>
</div><p>bind rpm 包提供了以下核心程序:</p>
<ul>
<li><code>dnssec-*</code>: Domain Name System Security Extensions,DNS 安全扩展</li>
<li><code>rndc</code>: named 进程远程控制工具</li>
<li><code>named</code>: bind server 的核心程序</li>
<li><code>named-checkconf</code>: 用于检查 named 配置文件是否存在语法错误</li>
<li><code>named-checkzone</code>: 用于检查 DNS 的区域解析库文件是否存在语法错误</li>
</ul>
<h4 id="named-checkconf">named-checkconf</h4>
<p><code>named-checkconf [named.conf]</code></p>
<ul>
<li>作用: 检查 named 配置文件是否存在语法错误</li>
<li>参数: named.conf 配置文件位置，默认为 <code>/etc/named.conf</code></li>
</ul>
<h4 id="named-checkzone">named-checkzone</h4>
<p><code>named-checkzone zonename filename</code></p>
<ul>
<li>作用: 用于检查 DNS 的区域解析库文件是否存在语法错误</li>
<li>参数:
<ul>
<li><code>zonename</code>: 区域名称</li>
<li><code>filename</code>: 区域数据库文件所在位置</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ named-checkzone magedu.com.  /var/named/magedu.com.zone
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="12-bind-配置文件">1.2 bind 配置文件</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ rpm -ql bind<span class="p">|</span>egrep <span class="s2">&#34;etc|var&#34;</span><span class="p">|</span>grep -v <span class="s2">&#34;share&#34;</span>
</span></span><span class="line"><span class="cl">/etc/logrotate.d/named
</span></span><span class="line"><span class="cl">/etc/named                 
</span></span><span class="line"><span class="cl">/etc/named.conf            <span class="c1"># 核心配置文件</span>
</span></span><span class="line"><span class="cl">/etc/named.iscdlv.key      <span class="c1"># 核心配置文件内使用 include 包含的辅助配置文件</span>
</span></span><span class="line"><span class="cl">/etc/named.rfc1912.zones
</span></span><span class="line"><span class="cl">/etc/named.root.key
</span></span><span class="line"><span class="cl">/etc/rndc.conf             <span class="c1"># rndc 配置文件</span>
</span></span><span class="line"><span class="cl">/etc/rndc.key
</span></span><span class="line"><span class="cl">/etc/rwtab.d/named
</span></span><span class="line"><span class="cl">/etc/sysconfig/named
</span></span><span class="line"><span class="cl">/var/log/named.log        <span class="c1"># 日志文件</span>
</span></span><span class="line"><span class="cl">/var/named                <span class="c1"># DNS 数据库区域解析文件默认所在的目录</span>
</span></span><span class="line"><span class="cl">/var/named/data
</span></span><span class="line"><span class="cl">/var/named/dynamic
</span></span><span class="line"><span class="cl">/var/named/named.ca       <span class="c1"># 顶级域的配置文件</span>
</span></span><span class="line"><span class="cl">/var/named/named.empty
</span></span><span class="line"><span class="cl">/var/named/named.localhost
</span></span><span class="line"><span class="cl">/var/named/named.loopback
</span></span><span class="line"><span class="cl">/var/named/slaves
</span></span></code></pre></td></tr></table>
</div>
</div><p>bind 的配置文件包括两个部分:</p>
<ol>
<li>主配置文件：<code>/etc/named.conf</code></li>
<li>主配置文件内使用 include 包含进来辅助配置文件:
<ul>
<li><code>/etc/named.iscdlv.key</code></li>
<li><code>/etc/named.rfc1912.zones</code></li>
<li><code>/etc/named.root.key</code></li>
</ul>
</li>
</ol>
<p>解析库文件默认存放在 <code>/var/named/</code>目录下；一般名字为：ZONE_NAME.zone。一台DNS服务器可同时为多个区域提供解析，且必需包含如下几个区域解析库文件:</p>
<ol>
<li>根区域解析库文件： <code>named.ca</code></li>
<li>localhost 的正向解析库：<code>named.localhost</code></li>
<li>127.0.0.1 的反向解析库：<code>named.loopback</code></li>
</ol>
<p>默认情况下，上述的区域解析库文件在 bind 安装时，已由 rpm 包自动提供。</p>
<h3 id="13-bind-进程管理">1.3 bind 进程管理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ rpm -ql bind|grep systemd
</span></span><span class="line"><span class="cl">/usr/lib/systemd/system/named-setup-rndc.service
</span></span><span class="line"><span class="cl">/usr/lib/systemd/system/named.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>bind程序安装完成之后，默认即可做缓存名称服务器使用；如果没有专门负责解析的区域，直接即可启动服务。</p>
<ul>
<li>CentOS 6: <code>service  named  start</code></li>
<li>CentOS 7: <code>systemctl  start  named.service</code></li>
</ul>
<p>named 进程启动后，默认会监听 tcp 的 953 号端口，rndc 可通过此端口对 named 进程进行远程控制。但是 named 进程默认只监听在 127.0.0.1 上，因此仅允许本地使用。</p>
<h4 id="rndc">rndc</h4>
<p>rndc：remote name domain contoller</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rndc [-b address] [-c config] [-s server] [-p port]
</span></span><span class="line"><span class="cl">	[-k key-file ] [-y key] [-V] command
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">command is one of the following:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    reload  Reload configuration file and zones.
</span></span><span class="line"><span class="cl">    reload zone [class [view]]  Reload a single zone.
</span></span><span class="line"><span class="cl">    refresh zone [class [view]]   Schedule immediate maintenance for a zone.
</span></span><span class="line"><span class="cl">    stats     Write server statistics to the statistics file.
</span></span><span class="line"><span class="cl">    status   Display status of the server.
</span></span><span class="line"><span class="cl">    stop       Save pending updates to master files and stop the server.
</span></span><span class="line"><span class="cl">    stop -p   Save pending updates to master files and stop the server
</span></span><span class="line"><span class="cl">    flush     Flushes all of the server&#39;s caches.
</span></span><span class="line"><span class="cl">    flush [view]  Flushes the server&#39;s cache for a view.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-bind-配置">2. bind 配置</h2>
<h3 id="21-配置格式">2.1 配置格式</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat /etc/named.conf
</span></span><span class="line"><span class="cl">options <span class="o">{</span>                                 <span class="c1"># 全局配置段</span>
</span></span><span class="line"><span class="cl">	listen-on port <span class="m">53</span> <span class="o">{</span> 127.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	listen-on-v6 port <span class="m">53</span> <span class="o">{</span> ::1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	directory 	<span class="s2">&#34;/var/named&#34;</span><span class="p">;</span>               <span class="c1"># 区域解析库文件的默认存放目录</span>
</span></span><span class="line"><span class="cl">	dump-file 	<span class="s2">&#34;/var/named/data/cache_dump.db&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	statistics-file <span class="s2">&#34;/var/named/data/named_stats.txt&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	memstatistics-file <span class="s2">&#34;/var/named/data/named_mem_stats.txt&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	allow-query     <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	recursion yes<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	dnssec-enable yes<span class="p">;</span>
</span></span><span class="line"><span class="cl">	dnssec-validation yes<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	/* Path to ISC DLV key */
</span></span><span class="line"><span class="cl">	bindkeys-file <span class="s2">&#34;/etc/named.iscdlv.key&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	managed-keys-directory <span class="s2">&#34;/var/named/dynamic&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	pid-file <span class="s2">&#34;/run/named/named.pid&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	session-keyfile <span class="s2">&#34;/run/named/session.key&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">logging <span class="o">{</span>                                <span class="c1"># 日志配置段</span>
</span></span><span class="line"><span class="cl">        channel default_debug <span class="o">{</span>
</span></span><span class="line"><span class="cl">                file <span class="s2">&#34;data/named.run&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                severity dynamic<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">zone <span class="s2">&#34;.&#34;</span> IN <span class="o">{</span>                            <span class="c1"># 顶级域解析库配置文件</span>
</span></span><span class="line"><span class="cl">	<span class="nb">type</span> hint<span class="p">;</span>
</span></span><span class="line"><span class="cl">	file <span class="s2">&#34;named.ca&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">include <span class="s2">&#34;/etc/named.rfc1912.zones&#34;</span><span class="p">;</span>     <span class="c1"># 包含的辅助配置文件</span>
</span></span><span class="line"><span class="cl">include <span class="s2">&#34;/etc/named.root.key&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>bind 的主配置 <code>/etc/named.conf</code> 由三个部分组成:</p>
<ol>
<li>全局配置段：<code>options { ... }</code></li>
<li>日志配置段: <code>logging { ... }</code></li>
<li>区域配置段: <code>zone { ... }</code> 配置那些由本机负责解析的区域，或转发的区域</li>
</ol>
<p><code>/etc/named.conf</code>有如下语法要求:</p>
<ol>
<li>每个配置语句必须以分号结尾</li>
<li><code>{}</code> 左右都必需要有空格</li>
<li>使用 <code>//</code> 或 <code>/* */</code> 进行注释</li>
</ol>
<h3 id="22-缓存名-dns-服务器配置">2.2 缓存名 DNS 服务器配置</h3>
<p>named 进程默认启动后，即可作为缓存 DNS 服务器，但是默认配置只允许本地查询，无法对外提供服务，因此需要做如下修改。</p>
<ol>
<li>更改 named 监听的地址，使其能与外部主机通信的地址；</li>
<li>学习使用时，建议关闭 dnssec</li>
<li>关闭仅允许本地查询配置</li>
</ol>
<p>配置文件修改后应该使用<code>named-checkconf</code>，检查配置文件语法是否存在错误，在重起 named 进程。下面是配置过程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vim /etc/named.conf
</span></span><span class="line"><span class="cl">	<span class="c1"># 修改监听地址，使其能与外部主机通信的地址；					</span>
</span></span><span class="line"><span class="cl">	listen-on port 53<span class="p">;</span>
</span></span><span class="line"><span class="cl">	listen-on port <span class="m">53</span> <span class="o">{</span> 172.16.100.67<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># 学习时，建议关闭dnssec</span>
</span></span><span class="line"><span class="cl">	dnssec-enable no<span class="p">;</span>
</span></span><span class="line"><span class="cl">	dnssec-validation no<span class="p">;</span>
</span></span><span class="line"><span class="cl">	dnssec-lookaside no<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># 关闭仅允许本地查询：</span>
</span></span><span class="line"><span class="cl">	//allow-query  <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 检查配置文件语法</span>
</span></span><span class="line"><span class="cl">$ named-checkconf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-正反向解析区域配置">3. 正反向解析区域配置</h2>
<p>上一节我们学习过区域解析库文件的语法格式，现在我们就来学习，如何配置正向和反向区域。我们将以配置<code>magedu.com</code> 这个二级域为例。</p>
<h3 id="31-正向区域配置">3.1 正向区域配置</h3>
<p>配置一个正向解析区域需要:</p>
<ol>
<li>定义区域: 在主配置文件中或主配置文件辅助配置文件中定义区域，<strong>区域名字即为域名</strong></li>
<li>建立区域数据文件，正向区域的主要记录为A或AAAA记录，并更改配置文件属性</li>
<li>重启服务: 检查语法错误，然后让服务器重载配置文件和区域数据文件</li>
</ol>
<p>下面是配置的详细过程:</p>
<h4 id="定义区域">定义区域</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vim /etc/named.rfc1912.zones  <span class="c1"># 追加</span>
</span></span><span class="line"><span class="cl">zone  <span class="s2">&#34;magedu.com.&#34;</span>  IN  <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="nb">type</span>  master<span class="p">;</span>   
</span></span><span class="line"><span class="cl">	file  <span class="s2">&#34;magedu.com.zone&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>区域定义参数:</p>
<ul>
<li><code>type</code>: 用于定义区域的主机类型，可选值为
<ul>
<li><code>master</code>: 主服务器</li>
<li><code>slave</code>: 从服务器</li>
<li><code>hint</code>: 根域</li>
<li><code>forward</code></li>
</ul>
</li>
<li><code>file</code>: 指定区域数据库文件位置，使用相对路经，则在 <code>/etc/named.conf</code> 配置的默认路经<code>/var/named</code>之下</li>
</ul>
<h4 id="建立区域数据文件">建立区域数据文件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> /var/named          
</span></span><span class="line"><span class="cl">$ touch /var/named/magedu.com.zone          <span class="c1"># 创建区域数据文件</span>
</span></span><span class="line"><span class="cl">$ chgrp  named  /var/named/magedu.com.zone  <span class="c1"># 更改权限及属组</span>
</span></span><span class="line"><span class="cl">$ chmod  <span class="nv">o</span><span class="o">=</span>  /var/named/magedu.com.zone
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ vim /var/named/magedu.com.zone
</span></span><span class="line"><span class="cl"><span class="nv">$TTL</span> <span class="m">3600</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ORIGIN</span> magedu.com.        <span class="c1">#  ORIGIN 会自动补全下面 ns，mx1 的域名</span>
</span></span><span class="line"><span class="cl">@	   IN	  SOA	 ns1.magedu.com.   dnsadmin.magedu.com. <span class="o">(</span>
</span></span><span class="line"><span class="cl">							<span class="m">2017010801</span>
</span></span><span class="line"><span class="cl">							1H
</span></span><span class="line"><span class="cl">							10M
</span></span><span class="line"><span class="cl">							3D
</span></span><span class="line"><span class="cl">							1D<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    IN	  NS	    ns1
</span></span><span class="line"><span class="cl">      IN	  MX   <span class="m">10</span> mx1
</span></span><span class="line"><span class="cl">      IN	  MX   <span class="m">20</span> mx2
</span></span><span class="line"><span class="cl">ns1	  IN	  A	   172.16.100.67
</span></span><span class="line"><span class="cl">mx1	  IN	  A	   172.16.100.68
</span></span><span class="line"><span class="cl">mx2	  IN	  A	   172.16.100.69
</span></span><span class="line"><span class="cl">www	  IN	  A	   172.16.100.67
</span></span><span class="line"><span class="cl">web	  IN	  CNAME   www
</span></span><span class="line"><span class="cl">bbs	  IN	  A	   172.16.100.70
</span></span><span class="line"><span class="cl">bbs	  IN	  A	   172.16.100.71
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="重启服务">重启服务</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 检查语法错误</span>
</span></span><span class="line"><span class="cl">$ named-checkzone magedu.com.  /var/named/magedu.com.zone
</span></span><span class="line"><span class="cl">$ named-checkconf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重起服务</span>
</span></span><span class="line"><span class="cl">$ rndc  reload   <span class="c1"># 或</span>
</span></span><span class="line"><span class="cl">$ systemctl  reload  named.service
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-反向解析区域配置">3.2 反向解析区域配置</h3>
<p>配置反向区域与配置正向区域类似，只不过<strong>区域名称</strong>和<strong>区域数据库文件</strong>不同:</p>
<ol>
<li>反向区域的名字格式为: <code>反写的网段地址.in-addr.arpa</code>, 例如区域 <code>172.16.100</code> 的区域名称为 <code>100.16.172.in-addr.arpa</code></li>
<li>反向区域没有 <code>MX</code> 资源记录，主要为 <code>PTR</code> 资源记录</li>
</ol>
<h4 id="定义区域-1">定义区域</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vim /etc/named.rfc1912.zones  <span class="c1"># 追加</span>
</span></span><span class="line"><span class="cl">zone  <span class="s2">&#34;100.16.172.in-addr.arpa&#34;</span>  IN  <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="nb">type</span>  master<span class="p">;</span>   
</span></span><span class="line"><span class="cl">	file  <span class="s2">&#34;172.16.100.zone&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="建立区域数据文件-1">建立区域数据文件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> /var/named          
</span></span><span class="line"><span class="cl">$ touch /var/named/172.16.100.zone          <span class="c1"># 创建区域数据文件</span>
</span></span><span class="line"><span class="cl">$ chgrp  named  /var/named/172.16.100.zone  <span class="c1"># 更改权限及属组</span>
</span></span><span class="line"><span class="cl">$ chmod  <span class="nv">o</span><span class="o">=</span>  /var/named/172.16.100.zone
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ vim /var/named/172.16.100.zone
</span></span><span class="line"><span class="cl"><span class="nv">$TTL</span> <span class="m">3600</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ORIGIN</span> 100.16.172.in-addr.arpa.
</span></span><span class="line"><span class="cl">@	   IN	  SOA	 ns1.magedu.com.  nsadmin.magedu.com. <span class="o">(</span>
</span></span><span class="line"><span class="cl">						  <span class="m">2017010801</span>
</span></span><span class="line"><span class="cl">						  1H
</span></span><span class="line"><span class="cl">						  10M
</span></span><span class="line"><span class="cl">						  3D
</span></span><span class="line"><span class="cl">						  12H <span class="o">)</span>
</span></span><span class="line"><span class="cl">		  IN	  NS	 ns1.magedu.com.      
</span></span><span class="line"><span class="cl">67	  IN	  PTR	 ns1.magedu.com.   <span class="c1"># 域名必需写全，此时 ORIGIN 不能补全</span>
</span></span><span class="line"><span class="cl">68	  IN	  PTR	 mx1.magedu.com.
</span></span><span class="line"><span class="cl">69	  IN	  PTR	 mx2.magedu.com.
</span></span><span class="line"><span class="cl">70	  IN	  PTR	 bbs.magedu.com.
</span></span><span class="line"><span class="cl">71	  IN	  PTR	 bbs.magedu.com.
</span></span><span class="line"><span class="cl">67	  IN	  PTR	 www.magedu.com.					
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="重启服务-1">重启服务</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 检查语法错误</span>
</span></span><span class="line"><span class="cl">$ named-checkzone 100.16.172.in-addr.arpa  /var/named/172.16.100.zone
</span></span><span class="line"><span class="cl">$ named-checkconf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重起服务</span>
</span></span><span class="line"><span class="cl">$ rndc  reload   <span class="c1"># 或</span>
</span></span><span class="line"><span class="cl">$ systemctl  reload  named.service
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4-dns-测试工具">4. DNS 测试工具</h2>
<h4 id="dig">dig</h4>
<p><code>dig  [-t RR_TYPE]  name  [@SERVER]  [query options]</code></p>
<ul>
<li>作用: 用于测试dns系统，因此其不会查询hosts文件；</li>
<li>参数:
<ul>
<li><code>name</code>: DNS 资源记录的名称</li>
<li><code>@SERVER</code>: 可选，使用的 DNS 服务器，默认为本机</li>
</ul>
</li>
<li>选项：
<ul>
<li><code>-t RR_TYPE</code>: 指定查询的资源记录类型</li>
<li><code>+[no]trace</code>：跟踪解析过程</li>
<li><code>+[no]recurse</code>：进行递归解析；</li>
<li><code>-x IP</code>:进行反向解析测试</li>
</ul>
</li>
<li>常用:
<ul>
<li>反向解析测试 : <code>dig -x IP</code></li>
<li>模拟完全区域传送： <code>dig -t axfr DOMAIN [@server]</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 正向解析测试</span>
</span></span><span class="line"><span class="cl">$  dig -t NS baidu.com.
</span></span><span class="line"><span class="cl">$  dig -t A  www.baidu.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span> &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-61.el7 &lt;&lt;&gt;&gt; -t A www.baidu.com +recurse
</span></span><span class="line"><span class="cl"><span class="p">;;</span> global options: +cmd
</span></span><span class="line"><span class="cl"><span class="p">;;</span> Got answer:
</span></span><span class="line"><span class="cl"><span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">36303</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;;</span> QUESTION SECTION:
</span></span><span class="line"><span class="cl"><span class="p">;</span>www.baidu.com.			IN	A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;;</span> ANSWER SECTION:
</span></span><span class="line"><span class="cl">www.baidu.com.		126	IN	CNAME	www.a.shifen.com.
</span></span><span class="line"><span class="cl">www.a.shifen.com.	126	IN	A	61.135.169.125
</span></span><span class="line"><span class="cl">www.a.shifen.com.	126	IN	A	61.135.169.121
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;;</span> Query time: <span class="m">47</span> msec
</span></span><span class="line"><span class="cl"><span class="p">;;</span> SERVER: 192.168.1.1#53<span class="o">(</span>192.168.1.1<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> WHEN: 二 8月 <span class="m">14</span> 11:54:53 CST <span class="m">2018</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> MSG SIZE  rcvd: <span class="m">90</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 反向解析测试</span>
</span></span><span class="line"><span class="cl">$ dig  -x  61.135.169.125
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="host">host</h4>
<p><code>host  [-t  RR_TYPE]  name  [SERVER_IP]</code></p>
<ul>
<li>作用: 用于测试dns系统，不会查询hosts文件；</li>
<li>参数:
<ul>
<li><code>name</code>: DNS 资源记录的名称</li>
<li><code>SERVER_IP</code>: 可选，使用的 DNS 服务器，默认为本机</li>
</ul>
</li>
<li>选项：
<ul>
<li><code>-t RR_TYPE</code>: 指定查询的资源记录类型</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ host -t A www.baidu.com
</span></span><span class="line"><span class="cl">www.baidu.com is an alias for www.a.shifen.com.
</span></span><span class="line"><span class="cl">www.a.shifen.com has address 61.135.169.125
</span></span><span class="line"><span class="cl">www.a.shifen.com has address 61.135.169.121
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ host -t PTR 61.135.169.121
</span></span><span class="line"><span class="cl">Host 121.169.135.61.in-addr.arpa. not found: 3(NXDOMAIN)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="nslookup">nslookup</h4>
<p><code>nslookup  [-options]  [name]  [server]</code></p>
<ul>
<li>作用: 用于测试dns系统，默认进入交互式环境</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nslookup&gt;
</span></span><span class="line"><span class="cl">server  IP      <span class="c1"># 指定DNS服务器</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span>  <span class="nv">q</span><span class="o">=</span>RR_TYPE  <span class="c1"># 要查询的资源记录类型；</span>
</span></span><span class="line"><span class="cl">name           <span class="c1"># 要查询的名称</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ nslookup
</span></span><span class="line"><span class="cl">&gt; <span class="nb">set</span> <span class="nv">q</span><span class="o">=</span>A
</span></span><span class="line"><span class="cl">&gt; www.baidu.com
</span></span><span class="line"><span class="cl">Server:		192.168.1.1
</span></span><span class="line"><span class="cl">Address:	192.168.1.1#53
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Non-authoritative answer:
</span></span><span class="line"><span class="cl">www.baidu.com	canonical <span class="nv">name</span> <span class="o">=</span> www.a.shifen.com.
</span></span><span class="line"><span class="cl">Name:	www.a.shifen.com
</span></span><span class="line"><span class="cl">Address: 61.135.169.121
</span></span><span class="line"><span class="cl">Name:	www.a.shifen.com
</span></span><span class="line"><span class="cl">Address: 61.135.169.125
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2018-03-09</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" data-title="16.3 bind安装和配置" data-hashtags="马哥 Linux"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" data-hashtag="马哥 Linux"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" data-title="16.3 bind安装和配置"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" data-title="16.3 bind安装和配置"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hotttao.github.io/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" data-title="16.3 bind安装和配置" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E9%A9%AC%E5%93%A5-linux/">马哥 Linux</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/dns%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" class="prev" rel="prev" title="16.2 DNS区域数据库文件格式"><i class="fas fa-angle-left fa-fw"></i>16.2 DNS区域数据库文件格式</a>
            <a href="/posts/linux/linux_mt/19-dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98/bind%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" class="next" rel="next" title="16.4 bind 高级配置">16.4 bind 高级配置<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.111.2">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">宋涛</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{"gitalk":{"admin":["hotttao"],"clientID":"7b48df1b81d23057c798","clientSecret":"65c6f9e6ca6ae4d8105f757578b6b594e3668e61","id":"2018-03-09T22:10:00+08:00","owner":"hotttao","repo":"hotttao.github.io","title":"16.3 bind安装和配置"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
