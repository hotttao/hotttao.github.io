<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>4. x86 汇编基础 | 宋涛的博客</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="x86 汇编" />
    
    <meta name="description" content="CPU 实模式(一)">
<meta name="keywords" content="x86 汇编">
<meta property="og:type" content="article">
<meta property="og:title" content="4. x86 汇编基础">
<meta property="og:url" content="http://yoursite.com/2021/07/04/assembley/x86/x86_04/index.html">
<meta property="og:site_name" content="宋涛的博客">
<meta property="og:description" content="CPU 实模式(一)">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/assembly/video.png">
<meta property="og:updated_time" content="2021-11-06T03:42:53.834Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4. x86 汇编基础">
<meta name="twitter:description" content="CPU 实模式(一)">
<meta name="twitter:image" content="http://yoursite.com/images/assembly/video.png">
    

    
        <link rel="alternate" href="/" title="宋涛的博客" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">漫步在大陆上的海龟</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Go/">Go</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Python/">Python</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/分布式/">分布式</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端/">前端</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/存储/">存储</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/操作系统/">操作系统</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/运维/">运维</a></li></ul>
                                    
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Go/">Go</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-assembley/x86/x86_04" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        4. x86 汇编基础
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2021/07/04/assembley/x86/x86_04/" class="article-date">
            <time datetime="2021-07-03T16:00:00.000Z" itemprop="datePublished">2021-07-04</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/x86-汇编/">x86 汇编<span class="tag-count">11</span></a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>CPU 实模式(一)<br><a id="more"></a></p>
<h2 id="1-内容概述"><a href="#1-内容概述" class="headerlink" title="1. 内容概述"></a>1. 内容概述</h2><p>按照 CPU 功能升级迭代的顺序，CPU 的工作模式有实模式、保护模式、长模式。今天我们就来学习最基本的实模式，我们将实现一个在屏幕上输出数字的示例的三种实现，介绍汇编语言的基础知识，包括:</p>
<ol>
<li>实现一，我们将介绍最基本的汇编指令使用</li>
<li>实现二，我们将介绍如何在汇编内使用循环和判断</li>
<li>实现三，我们将介绍栈和栈的使用</li>
</ol>
<h2 id="2-在屏幕上显示文字"><a href="#2-在屏幕上显示文字" class="headerlink" title="2. 在屏幕上显示文字"></a>2. 在屏幕上显示文字</h2><p>为了显示文字，通常需要两种硬件，一是显示器，二是显卡:</p>
<ol>
<li>显卡的职责是为显示器提供内容，并控制显示器的显示模式和状态</li>
<li>显示器的职责是将那些内容以视觉可见的方式呈现在屏幕上</li>
</ol>
<p>显卡控制显示器的最小单位是像素，一个像素对应着屏幕上的一个点。屏幕上通常有数十万乃至更多的像素，通过控制每个像素的明暗和颜色，我们就能让这大量的像素形成文字和美丽的图像。</p>
<p>显卡都有自己的存储器，因为它位于显卡上，故称显示存储器（Video RAM：VRAM），简称显存。显存的第1 个字节对应着屏幕左上角连续的8 个像素；第2 个字节对应着屏幕上后续的8 个像素，后面的以此类推。</p>
<p>显卡有<strong>文本模式</strong>和<strong>图形模式</strong>两种基本工作模式，可以用指令访问显卡，设置它的显示模式。不同的工作模式下，显卡对显存内容的解释是不同的。</p>
<h3 id="2-1-图形模式"><a href="#2-1-图形模式" class="headerlink" title="2.1 图形模式"></a>2.1 图形模式</h3><p>在图形模式下，显卡周期性地从显存中提取这些比特，并把它们按顺序显示在屏幕上，如下图所示，显存中，第1 个字节的内容是11110000，屏幕左上角先是显示4 个亮点，再显示4 个黑点。</p>
<p><img src="/images/assembly/video.png" alt="显存的图形模式"></p>
<p>黑色和白色只需要1 个比特就能表示，但要显示更多的颜色，1 个比特就不够了。现在最流行的，是用24 个比特，即3 个字节，来对应一个像素。</p>
<h3 id="2-2-文字模式"><a href="#2-2-文字模式" class="headerlink" title="2.2 文字模式"></a>2.2 文字模式</h3><p>操作显存里的比特，使得屏幕上能显示出字符的形状，是非常麻烦，工程师们设计了文字模式，所有在个人计算机上使用的显卡，在加电自检之后都会把自己初始化到80× 25 的文本模式。在这种模式下，屏幕上可以显示25 行，每行80 个字符，每屏总共2000 个字符。如下图所示，为了给出要显示的字符，处理器只需要访问显存，把字符的 ASCII 码写进去。第1 个代码对应着屏幕左上角第1 个字符，第2 个代码对应着屏幕左上角第2 个字符，然后由字符发生器和控制电路来控制屏幕上的像素。</p>
<p><img src="/images/assembly/video_text.png" alt="显存的文字模式"></p>
<p>前面我们介绍了 8086 的内存地址空间，因此只需要将字符的 ASCII 码写入显存映射的内存空间，就可以将字符ASCII码写入显存，从而往显卡在屏幕上显示对应的字符。如图所示，8086 可以访问1MB 内存。其中:</p>
<ol>
<li>0x00000～9FFFF 属于常规内存，由内存条提供；</li>
<li>0xF0000～0xFFFFF 由主板上的一个芯片提供，即ROM-BIOS。</li>
<li>中间还有一个320KB 的空洞，即0xA0000～0xEFFFF，这段地址空间由特定的外围设备来提供，其中就包括显卡。</li>
<li>0xB8000～0xBFFFF 这段物理地址空间，就是留给显卡的，由显卡来提供，用来显示文本。</li>
</ol>
<p>由于历史的原因，所有在个人计算机上使用的显卡，在加电自检之后都会把自己初始化到80× 25 的文本模式。在这种模式下，屏幕上可以显示25 行，每行80 个字符，每屏总共2000 个字符。</p>
<p><img src="/images/assembly/memory_address.png" alt="内存地址空间"></p>
<p>和访问主内存一样，为了访问显存，也需要使用逻辑地址，也就是采用“段地址：偏移地址”的形式，文本模式下显存的起始物理地址是0xB8000，这块内存可以看成是段地址为0xB800，偏移地址从0x0000 延伸到0xFFFF 的区域，因此我们可以把段地址定为0xB800。(这里介绍的显存映射的内存地址空间与前面所说的范围 A0000-BFFFF 不同，应该是文字模式和图形模式之间的差别，并没有求证。)</p>
<p>用于初始化访问显存的汇编代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mov ax,0xb800                 ;使用 ES 来指向显存所在的段</div><div class="line">mov es,ax</div></pre></td></tr></table></figure>
<h4 id="显示字符"><a href="#显示字符" class="headerlink" title="显示字符"></a>显示字符</h4><p>用于显示字符的 ASCII 码这里就不过多介绍，不过需要了解的是，屏幕上的每个字符对应着显存中的两个连续字节，前一个是字符的ASCII 代码，后面是字符的显示属性，包括字符颜色（前景色）和底色（背景色）</p>
<p><img src="/images/assembly/video_text_show.png" alt="显存的文字模式"></p>
<p>如图所示，字符的显示属性（1 字节）分为两部分，低4 位定义的是前景色，高4 位定义的是背景色。色彩主要由红（R）、绿（G）、蓝（B）这3 位决定，K 是闪烁位，为0 时不闪烁，为1 时闪烁；I 是亮度位，为0时正常亮度，为1 时呈高亮。屏幕上什么都没有时，显示的全是黑底白字的空白字符，也叫空格字符（Space），ASCII代码是0x20。</p>
<p>下面是显示字符的汇编代码示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mov byte [es:0x00],&apos;L&apos; ;等效于 mov byte [es:0x00],0x4c</div><div class="line">mov byte [es:0x01],0x07</div></pre></td></tr></table></figure>
<p>可以使用字符的字面值，这个字符必须用引号围起来，就像上面一样。在源程序的编译阶段，汇编语言编译器会将它转换成ASCII 码的形式。如果没有附加任何指示，段地址默认在段寄存器DS，显存的段地址位于段寄存器ES 中，因此，这里使用了段超越前缀“es:”</p>
<p>还需要注意的是，因为目的操作数给出的是一个内存地址，我们要用源操作数来修改这个地址里的内容，所以，目的操作数必须用方括号围起来，以表明它是一个地址，处理器应该用这个地址再次访问内存，将源操作数写进这个单元。实际上，这类似于高级语言里的指针。</p>
<p>最后，关键字“byte”用来修饰目的操作数，指出本次传送是以字节的方式进行的。在16 位的处理器上，单次操作的数据宽度可以是8 位，也可以是16 位。到底是8 位，还是16 位，可以根据目的操作数或者源操作数(即使用的寄存器的宽度)来判断。如果无法判断必须用“byte”或者“word”进行修饰。</p>
<h2 id="3-示例实现一"><a href="#3-示例实现一" class="headerlink" title="3. 示例实现一"></a>3. 示例实现一</h2><p>我们的示例实现一是使用的是最基本的汇编指令，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line">       ;代码清单5-1 </div><div class="line">       ;文件名：c05_mbr.asm</div><div class="line">       ;文件说明：硬盘主引导扇区代码</div><div class="line">       ;创建日期：2011-3-31 21:15 </div><div class="line">       </div><div class="line">       mov ax,0xb800                 ;指向文本模式的显示缓冲区</div><div class="line">       mov es,ax</div><div class="line"></div><div class="line">       ;以下显示字符串&quot;Label offset:&quot;</div><div class="line">       mov byte [es:0x00],&apos;L&apos;</div><div class="line">       mov byte [es:0x01],0x07</div><div class="line">       mov byte [es:0x02],&apos;a&apos;</div><div class="line">       mov byte [es:0x03],0x07</div><div class="line">       mov byte [es:0x04],&apos;b&apos;</div><div class="line">       mov byte [es:0x05],0x07</div><div class="line">       mov byte [es:0x06],&apos;e&apos;</div><div class="line">       mov byte [es:0x07],0x07</div><div class="line">       mov byte [es:0x08],&apos;l&apos;</div><div class="line">       mov byte [es:0x09],0x07</div><div class="line">       mov byte [es:0x0a],&apos; &apos;</div><div class="line">       mov byte [es:0x0b],0x07</div><div class="line">       mov byte [es:0x0c],&quot;o&quot;</div><div class="line">       mov byte [es:0x0d],0x07</div><div class="line">       mov byte [es:0x0e],&apos;f&apos;</div><div class="line">       mov byte [es:0x0f],0x07</div><div class="line">       mov byte [es:0x10],&apos;f&apos;</div><div class="line">       mov byte [es:0x11],0x07</div><div class="line">       mov byte [es:0x12],&apos;s&apos;</div><div class="line">       mov byte [es:0x13],0x07</div><div class="line">       mov byte [es:0x14],&apos;e&apos;</div><div class="line">       mov byte [es:0x15],0x07</div><div class="line">       mov byte [es:0x16],&apos;t&apos;</div><div class="line">       mov byte [es:0x17],0x07</div><div class="line">       mov byte [es:0x18],&apos;:&apos;</div><div class="line">       mov byte [es:0x19],0x07</div><div class="line"></div><div class="line">       mov ax,number                 ;取得标号number的偏移地址</div><div class="line">       mov bx,10</div><div class="line"></div><div class="line">       ;设置数据段的基地址</div><div class="line">       mov cx,cs</div><div class="line">       mov ds,cx</div><div class="line"></div><div class="line">       ;求个位上的数字</div><div class="line">       mov dx,0</div><div class="line">       div bx</div><div class="line">       mov [0x7c00+number+0x00],dl   ;保存个位上的数字</div><div class="line"></div><div class="line">       ;求十位上的数字</div><div class="line">       xor dx,dx</div><div class="line">       div bx</div><div class="line">       mov [0x7c00+number+0x01],dl   ;保存十位上的数字</div><div class="line"></div><div class="line">       ;求百位上的数字</div><div class="line">       xor dx,dx</div><div class="line">       div bx</div><div class="line">       mov [0x7c00+number+0x02],dl   ;保存百位上的数字</div><div class="line"></div><div class="line">       ;求千位上的数字</div><div class="line">       xor dx,dx</div><div class="line">       div bx</div><div class="line">       mov [0x7c00+number+0x03],dl   ;保存千位上的数字</div><div class="line"></div><div class="line">       ;求万位上的数字 </div><div class="line">       xor dx,dx</div><div class="line">       div bx</div><div class="line">       mov [0x7c00+number+0x04],dl   ;保存万位上的数字</div><div class="line"></div><div class="line">       ;以下用十进制显示标号的偏移地址</div><div class="line">       mov al,[0x7c00+number+0x04]</div><div class="line">       add al,0x30</div><div class="line">       mov [es:0x1a],al</div><div class="line">       mov byte [es:0x1b],0x04</div><div class="line">       </div><div class="line">       mov al,[0x7c00+number+0x03]</div><div class="line">       add al,0x30</div><div class="line">       mov [es:0x1c],al</div><div class="line">       mov byte [es:0x1d],0x04</div><div class="line">       </div><div class="line">       mov al,[0x7c00+number+0x02]</div><div class="line">       add al,0x30</div><div class="line">       mov [es:0x1e],al</div><div class="line">       mov byte [es:0x1f],0x04</div><div class="line"></div><div class="line">       mov al,[0x7c00+number+0x01]</div><div class="line">       add al,0x30</div><div class="line">       mov [es:0x20],al</div><div class="line">       mov byte [es:0x21],0x04</div><div class="line"></div><div class="line">       mov al,[0x7c00+number+0x00]</div><div class="line">       add al,0x30</div><div class="line">       mov [es:0x22],al</div><div class="line">       mov byte [es:0x23],0x04</div><div class="line">       </div><div class="line">       mov byte [es:0x24],&apos;D&apos;</div><div class="line">       mov byte [es:0x25],0x07</div><div class="line">        </div><div class="line"> infi: jmp near infi                 ;无限循环</div><div class="line">    </div><div class="line">number db 0,0,0,0,0</div><div class="line"></div><div class="line">times 203 db 0</div><div class="line">          db 0x55,0xaa</div></pre></td></tr></table></figure>
<p>大多数代码都比较直观，但是有以下需要注意的几个点:</p>
<ol>
<li><code>infi: jmp near infi</code>: 表示无限循环<ul>
<li>infi 是一个标号，以代表和指示该指令的汇编地址</li>
<li>标号之后的冒号是可选的，也单独占用一行的位置</li>
<li>jmp 是代码跳转指令，关键字near表示目标位置依然在当前代码段内</li>
<li>jmp near 对应的是一个3 字节指令，操作码是0xE9，后跟一个16 位（两字节）的操作数。但是，该操作数并非目标位置的偏移地址，而是目标位置相对于当前指令处的偏移量（以字节为单位）。在编译阶段，编译器是这么做的：用标号（目标位置）处的汇编地址减去当前指令的汇编地址，再减去当前指令的长度（3），在指令执行阶段，处理器用指令指针寄存器IP 的内容加上该指令的操作数，再加上该指令的长度（3），就得到了要转移的实际偏移地址，同时CS 寄存器的内容不变。</li>
<li>jmp 是如何区分绝对地址跳转还是相对跳转呢？很简单，当它看到JMP 之后是一个绝对地址，如0xF000:0x2000 时，它就知道应当编译成使用操作码0xEA 的直接绝对转移指令。相反地，如果它发现JMP 之后是一个标号，那么，它就会编译成使用操作码为0xE9 的相对转移指令。关键字“near”不是最主要的，它仅仅用于指示相对量是16 位的。</li>
</ul>
</li>
<li><code>db 0,0,0,0,0</code>: 在程序中声明并初始化数据<ul>
<li>DB 的意思是声明字节（Declare Byte）</li>
<li>DW（Declare Word）用于声明字数据</li>
<li>DQ（Declare Quad Word）用于声明四字数据</li>
<li>DB、DW、DD 和DQ 并不是处理器指令，它只是编译器提供的汇编指令</li>
<li>和指令不同，对于在程序中声明的数值，在编译阶段，编译器会在它们被声明的汇编地址处原样保留</li>
</ul>
</li>
<li><code>mov dx,0 - div bx</code>: 32 位除法<ul>
<li>通常用“DX:AX”来描述32 位的被除数</li>
<li>div 指令用DX:AX 作为被除数，除以BX 的内容，执行后得到的商在AX 中，余数在DX 中。因为除数是10，余数自然比10 小，我们可以从DL 中取得</li>
<li><code>xor dx,dx</code> 用于将 dx 清零</li>
</ul>
</li>
<li><code>mov al,[0x7c00+number+0x01]</code>:<ul>
<li>0x7c00 的由来是，主引导扇区代码是被加载到0x0000:0x7C00 处的，而非0x0000:0x0000</li>
</ul>
</li>
<li><code>db 0x55,0xaa</code>:<ul>
<li>一个有效的主引导扇区，其最后两个字节的数据必须是0x55 和0xAA</li>
<li>如果采用dw 版本，应该这样写：dw 0xaa55，因为，在Intel 处理器上，将一个字写入内存时，是采用低端字节序的，低字节0x55 置入低地址端（在前），高字节0xAA 在高地址端（在后）</li>
</ul>
</li>
<li><code>times 203 db 0</code><ul>
<li>伪指令times 可用于重复它后面的指令若干次。用于将代码填充到正好一个扇区大小(512bytes)</li>
</ul>
</li>
</ol>
<h2 id="4-示例实现二"><a href="#4-示例实现二" class="headerlink" title="4. 示例实现二"></a>4. 示例实现二</h2><p>在实现一的基础上，我们加上循环和判断来简化代码的实现:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">       ;代码清单6-1</div><div class="line">       ;文件名：c06_mbr.asm</div><div class="line">       ;文件说明：硬盘主引导扇区代码</div><div class="line">       ;创建日期：2011-4-12 22:12 </div><div class="line">    </div><div class="line">       jmp near start</div><div class="line">       </div><div class="line">mytext db &apos;L&apos;,0x07,&apos;a&apos;,0x07,&apos;b&apos;,0x07,&apos;e&apos;,0x07,&apos;l&apos;,0x07,&apos; &apos;,0x07,&apos;o&apos;,0x07,\</div><div class="line">          &apos;f&apos;,0x07,&apos;f&apos;,0x07,&apos;s&apos;,0x07,&apos;e&apos;,0x07,&apos;t&apos;,0x07,&apos;:&apos;,0x07</div><div class="line">number db 0,0,0,0,0</div><div class="line"></div><div class="line">start:</div><div class="line">       mov ax,0x7c0                  ;设置数据段基地址 </div><div class="line">       mov ds,ax</div><div class="line">       </div><div class="line">       mov ax,0xb800                 ;设置附加段基地址 </div><div class="line">       mov es,ax</div><div class="line">       </div><div class="line">       cld</div><div class="line">       mov si,mytext                 </div><div class="line">       mov di,0</div><div class="line">       mov cx,(number-mytext)/2      ;实际上等于 13</div><div class="line">       rep movsw</div><div class="line">   </div><div class="line">       ;得到标号所代表的偏移地址</div><div class="line">       mov ax,number</div><div class="line">       </div><div class="line">       ;计算各个数位</div><div class="line">       mov bx,ax</div><div class="line">       mov cx,5                      ;循环次数 </div><div class="line">       mov si,10                     ;除数 </div><div class="line">digit: </div><div class="line">       xor dx,dx</div><div class="line">       div si</div><div class="line">       mov [bx],dl                   ;保存数位</div><div class="line">       inc bx </div><div class="line">       loop digit</div><div class="line">       </div><div class="line">       ;显示各个数位</div><div class="line">       mov bx,number </div><div class="line">       mov si,4                      </div><div class="line"> show:</div><div class="line">       mov al,[bx+si]</div><div class="line">       add al,0x30</div><div class="line">       mov ah,0x04</div><div class="line">       mov [es:di],ax</div><div class="line">       add di,2</div><div class="line">       dec si</div><div class="line">       jns show</div><div class="line">       </div><div class="line">       mov word [es:di],0x0744</div><div class="line"></div><div class="line">       jmp near $</div><div class="line"></div><div class="line">times 510-($-$$) db 0</div><div class="line">                 db 0x55,0xaa</div></pre></td></tr></table></figure>
<p>改进的地方有以下几点:</p>
<ol>
<li>数据段的起始地址改为 0x7c0，避免了 0x7c00+number 这种重复硬编码</li>
<li><code>rep movsw</code>: <ul>
<li>使用 movsb 或者 movsw 指令进行数据传送</li>
<li>movsb 每次传送一个字节</li>
<li>movsw 每次传送一个字</li>
<li>指令前缀rep（repeat），意思是CX 不为零则重复。rep movsw 的操作码是0xF3 0xA5，它将重复执行movsw 直到CX 的内容为零。</li>
</ul>
</li>
<li>loop: 使用循环分解数位</li>
<li><code>jns show</code>: 条件跳转指令，另一种循环表示</li>
<li><code>jmp near $</code>: 无线循环指令<ul>
<li>NASM 编译器提供了一个标记“$”，该标记等同于标号，你可以把它看成是一个隐藏在当前行行首的标号。</li>
<li>因此，jmp near $的意思是，转移到当前指令继续执行</li>
</ul>
</li>
<li><code>times 510-($-$$) db 0</code><ul>
<li>$是当前行的汇编地址；$$是NASM 编译器提供的另一个标记，代表当前汇编节（段）的起始汇编地址。</li>
<li>当前程序没有定义节或段，就默认地自成一个汇编段，而且起始的汇编地址是0（程序起始处）</li>
</ul>
</li>
</ol>
<p>接下来分别来介绍这些指令的详细用法。</p>
<h3 id="4-1-movsw-movsb"><a href="#4-1-movsw-movsb" class="headerlink" title="4.1 movsw/movsb"></a>4.1 movsw/movsb</h3><p>movsw/movsb: 用于把数据从内存中的一个地方批量地传送（复制）到另一个地方 movsb 和 movsw 指令执行时:</p>
<ul>
<li>原始数据串的段地址由DS 指定，偏移地址由SI 指定，简写为DS:SI；</li>
<li>要传送到的目的地址由ES:DI 指定；</li>
<li>传送的字节数（movsb）或者字数（movsw）由CX指定。</li>
<li>还要指定是正向传送还是反向传送，正向传送是指传送操作的方向是从内存区域的低地址端到高地址端，反向传送则正好相反。正反向由 FLAG 寄存器的 DF 位设置，如下图所示</li>
</ul>
<p><img src="/images/assembly/mvsw.png" alt="mvsw 影响的 FLAG 寄存器"></p>
<p>在8086 处理器里，有一个特殊的寄存器，叫做标志寄存器FLAGS。作为一个例子，它的第6 位是ZF（Zero Flag），即零标志。当处理器执行一条算术或者逻辑运算指令后，算术逻辑部件送出的结果除了送到指令中指定位置（目的操作数指定的位置）外，还送到一个或非门。或非门的输出送到一个触发器，这就是标志寄存器的ZF 位。这就是说，如果计算结果为0，这一位被置成1，表示计算结果为零是“真”的；否则清除此位（0）。</p>
<p>源程序第19 行是方向标志清零指令cld。这是个无操作数指令，与其相反的是置方向标志指令std。cld 指令将DF 标志清零，以指示传送是正方向的。和cld 功能相反的是std 指令，它将DF标志置位（1）。此时，传送的方向是从高地址到低地址。</p>
<h3 id="4-2-loop"><a href="#4-2-loop" class="headerlink" title="4.2 loop"></a>4.2 loop</h3><p>loop 指令的功能是重复执行一段相同的代码，处理器在执行它的时候会顺序做两件事：</p>
<ol>
<li>将 CX 寄存器减去 1</li>
<li>如果 CX 不为 0，执行跳转，否则继续往下执行</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">digit: </div><div class="line">       xor dx,dx</div><div class="line">       div si</div><div class="line">       mov [bx],dl                   ;保存数位</div><div class="line">       inc bx </div><div class="line">       loop digit</div></pre></td></tr></table></figure>
<p>loop digit 指令，它的机器指令操作码是0xE2，后面跟着一个字节的操作数，而且也是相对于标号处的偏移量，是在编译阶段，编译器用标号digit 所在位置的汇编地址减去loop 指令的汇编地址，再减去loop 指令的长度（2）来得到的。</p>
<h3 id="4-3-8086-的通用寄存器"><a href="#4-3-8086-的通用寄存器" class="headerlink" title="4.3 8086 的通用寄存器"></a>4.3 8086 的通用寄存器</h3><p>8086 处理器内部有8 个16 位的通用寄存器，分别被命名为AX、BX、CX、DX、SI、DI、BP、SP。，其中:</p>
<ol>
<li>寄存器BX 最初的功能之一就是用来提供数据访问的基地址，所以又叫基址寄存器（Base Address Register）。</li>
<li>AX是累加器（Accumulator），与它有关的指令还会做指令长度上的优化（较短）；</li>
<li>CX 是计数器（Counter）；</li>
<li>DX 是数据（Data）寄存器，除了作为通用寄存器使用外，还专门用于和外设之间进行数据传送；</li>
<li>SI 是源索引寄存器（Source Index）；</li>
<li>DI 是目标索引寄存器（Destination Index），用于数据传送操作，</li>
</ol>
<p>像上面 <code>mov [bx],dl</code> 一样，要用寄存器来提供偏移地址，只能使用BX、SI、DI、BP，不能使用其他寄存器。像 <code>mov al,[bx+si]</code> SI 的作用相当于索引，因此它被称为索引寄存器（Index Register），或者叫变址寄存器。另一个常用的变址寄存器是DI。注意，INTEL8086 处理器只允许以下几种基址寄存器和变址寄存器的组合：</p>
<ul>
<li><code>[bx+si]</code></li>
<li><code>[bx+di]</code></li>
<li><code>[bp+si]</code></li>
<li><code>[bp+di]</code></li>
</ul>
<h3 id="4-4-负数的表示"><a href="#4-4-负数的表示" class="headerlink" title="4.4 负数的表示"></a>4.4 负数的表示</h3><p>在计算机中如何表示负数呢。-1 = 0 - 1，所以计算机使用二进制数 0 减去二进制数 1 来表示 -1，相减的过程要向左借位直至截断。你会发现，0x80 既是十进制数128，又是十进制数-128，为此计算机中的数分成两大类：无符号数和有符号数。有符号数是分正、负的，而且规定，数的正负要通过它的最高位来辨别。如果最高位是0，它就是正数；如果是1，就是负数。</p>
<p>正的有符号数，和与它同值的无符号数相同。但是，负数就不同了，在这里，10000000～11111111 这些负数，都是用0减去它们相对应的正数得到的。想知道它们各自对应的正数是谁吗？很简单，因为“负数的负数”是正数，所以只需要用0 减去这个负数就行。8086 处理器中，neg 只能专门用来实现这个功能: 用 0 减去指令中指定的操作数。</p>
<p>一个8 位的有符号数，要想用16 位的形式来表示，只需将其最高位，也就是用来辨别符号的那一位（几乎所有的书上都称之为符号位，实际上这并不严谨），扩展到高8 位即可。为了方便，处理器专门设计了两条指令来做这件事：cbw（Convert Byte to Word）和cwd（Convert Word to Double-word）。</p>
<h3 id="4-5-jns-条件跳转"><a href="#4-5-jns-条件跳转" class="headerlink" title="4.5 jns 条件跳转"></a>4.5 jns 条件跳转</h3><p>指令jns show 的意思是，如果未设置符号位，则转移到标号“show”所在的位置处执行，如果计算结果的最高位是比特“0”，处理器把SF 位置“0”，否则SF 位置“1”。所以上面代码的逻辑是，如果 si 未被剪成负数，则跳转到 digit。</p>
<p>jns 是条件转移指令，处理器在执行它的时候要参考标志寄存器的SF 位。除了只是在符合条件的时候才转移之外，它和jmp 指令很相似，它也是相对转移指令，编译后的机器指令操作数也是一个相对偏移量，是用标号处的汇编地址减去当前指令的汇编地址，再减去当前指令的长度得到的。</p>
<h4 id="FLAG-寄存器的其他位"><a href="#FLAG-寄存器的其他位" class="headerlink" title="FLAG 寄存器的其他位"></a>FLAG 寄存器的其他位</h4><p>除了上面介绍的 SF 符号位，ZF 零位。FLAG 寄存器还有下面一些标志位</p>
<ol>
<li>零位 ZF: 如果计算结果为0，这一位被置成1，表示计算结果为零是“真”的；否则清除此位（0）。</li>
<li>奇偶标志位PF: 最低8 位中，有偶数个为1 的比特，则PF=1；否则PF=0。</li>
<li>进位标志CF: <ul>
<li>如果最高位有向前进位或借位的情况发生，则CF=1；否则CF=0</li>
<li>CF 标志始终忠实地记录进位或者借位是否发生，但少数指令除外（如inc 和dec）</li>
</ul>
</li>
<li>溢出标志OF: <ul>
<li>对于无符号数运算来说，进位标志CF 通常意味着得到了错误的计算结果，因为目的操作数没能容纳那个进位。</li>
<li>但是对于有符号数运算，进位的是否导致溢出是不确定的，比如 112+112=-32 将导致溢出，但是 -1 + 2 并没有溢出。如果运算结果是正确的，那么OF=0，否则OF=1</li>
</ul>
</li>
</ol>
<h4 id="条件转移指令"><a href="#条件转移指令" class="headerlink" title="条件转移指令"></a>条件转移指令</h4><p>“jcc”不是一条指令，而是一个指令族（簇），功能是根据某些条件进行转移，比如:</p>
<ol>
<li>jns，意思是SF≠1（那就是SF=0 了）则转移</li>
<li>js 是 jns 相反的指令，意思是SF=1 则转移</li>
<li>jz 的意思是ZF 标志为1 则转移；jnz 的意思是ZF 标志不为1（为0）则转移。</li>
<li>jo 的意思是OF 标志为1 则转移，jno 的意思是OF 标志不为1（为0）则转移。</li>
<li>jc 的意思是CF 标志为1 则转移，jnc 的意思是CF 标志不为1（为0）则转移。</li>
<li>jp 的意思是PF 标志为1 则转移，jnp 的意思是PF 标志不为1（为0）则转移</li>
</ol>
<p>转移指令必须出现在影响标志的指令之后。但是通常情况下，我们的转移条件并不是某个标志位达到 0，比如AX等于0x30，好在 CPU  提供了 cmp 指令，cmp，它需要两个操作数。</p>
<p>cmp 指令在功能上和sub 指令相同，唯一不同之处在于，cmp 指令仅仅根据计算的结果设置相应的标志位，而不保留计算结果，因此也就不会改变两个操作数的原有内容。cmp 指令将会影响到CF、OF、SF、ZF、AF 和PF 标志位。</p>
<p>cmp ax,bx 来说，我们关心的是AX 中的内容是否等于BX 中的内容，AX 是被测量的对象，BX 是测量的基准。cmp 指令设置完相应标志位之后，我们就可以使用如下的跳转指令进行指令跳转了。</p>
<p><img src="/images/assembly/jcc.png" alt="jcc指令"></p>
<p>最后一个要讲述的条件转移指令是jcxz（jump if CX is zero），意思是当CX 寄存器的内容为零时则转移。执行这条指令时，处理器先测试寄存器CX 是否为零。如果CX 寄存器的内容为零，则转移；否则不转移，继续往下执行。</p>
<h2 id="5-示例实现三"><a href="#5-示例实现三" class="headerlink" title="5.示例实现三"></a>5.示例实现三</h2><p>示例实现三，我们将借助于栈实现。和代码段、数据段和附加段一样，栈也被定义成一个内存段，叫栈段（Stack Segment），由段寄存器SS 指向。栈有栈顶用栈指针寄存器SP （Stack Pointer）表示，SP 指向了数据从哪里出栈。定义栈需要两个连续的步骤，即初始化段寄存器SS 和栈指针SP 的内容。代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">         jmp near start</div><div class="line">	</div><div class="line"> message db &apos;1+2+3+...+100=&apos;</div><div class="line">        </div><div class="line"> start:</div><div class="line">         mov ax,0x7c0           ;设置数据段的段基地址 </div><div class="line">         mov ds,ax</div><div class="line"></div><div class="line">         mov ax,0xb800          ;设置附加段基址到显示缓冲区</div><div class="line">         mov es,ax</div><div class="line"></div><div class="line">         ;以下显示字符串 </div><div class="line">         mov si,message          </div><div class="line">         mov di,0</div><div class="line">         mov cx,start-message</div><div class="line">     @g:</div><div class="line">         mov al,[si]</div><div class="line">         mov [es:di],al</div><div class="line">         inc di</div><div class="line">         mov byte [es:di],0x07</div><div class="line">         inc di</div><div class="line">         inc si</div><div class="line">         loop @g</div><div class="line"></div><div class="line">         ;以下计算1到100的和 </div><div class="line">         xor ax,ax</div><div class="line">         mov cx,1</div><div class="line">     @f:</div><div class="line">         add ax,cx</div><div class="line">         inc cx</div><div class="line">         cmp cx,100</div><div class="line">         jle @f</div><div class="line"></div><div class="line">         ;以下计算累加和的每个数位 </div><div class="line">         xor cx,cx              ;设置堆栈段的段基地址</div><div class="line">         mov ss,cx</div><div class="line">         mov sp,cx</div><div class="line"></div><div class="line">         mov bx,10</div><div class="line">         xor cx,cx</div><div class="line">     @d:</div><div class="line">         inc cx</div><div class="line">         xor dx,dx</div><div class="line">         div bx</div><div class="line">         or dl,0x30</div><div class="line">         push dx</div><div class="line">         cmp ax,0</div><div class="line">         jne @d</div><div class="line"></div><div class="line">         ;以下显示各个数位 </div><div class="line">     @a:</div><div class="line">         pop dx</div><div class="line">         mov [es:di],dl</div><div class="line">         inc di</div><div class="line">         mov byte [es:di],0x07</div><div class="line">         inc di</div><div class="line">         loop @a</div><div class="line">       </div><div class="line">         jmp near $ </div><div class="line">       </div><div class="line"></div><div class="line">times 510-($-$$) db 0</div><div class="line">                 db 0x55,0xaa</div></pre></td></tr></table></figure>
<p>在上面的实现中，我们已经定义了3 个段，如下图所示，</p>
<ol>
<li>假定数据段的长度是64KB（实际上它的长度无关紧要）， 占据了物理地址0x07C00 ～ 0x17BFF ， 对应的逻辑地址范围是0x07C0:0x0000 ～ 0x07C0:0xFFFF；</li>
<li>代码段和栈段是同一个段，占据着物理地址0x00000～0x0FFFF，对应的逻辑地址范围是0x0000:0x0000～0x0000:0xFFFF。</li>
</ol>
<p><img src="/images/assembly/memery_stack.png" alt="内存代码段划分"></p>
<h3 id="5-1-入栈和出栈"><a href="#5-1-入栈和出栈" class="headerlink" title="5.1 入栈和出栈"></a>5.1 入栈和出栈</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">; ax 保存着被除数</div><div class="line">@d:</div><div class="line">    inc cx     ;记录当前是多少位，后面用于展示</div><div class="line">    xor dx,dx</div><div class="line">    div bx</div><div class="line">    or dl,0x30 ;相当于 “加上”0x30，得到 ascii 码</div><div class="line">    push dx    ;入栈</div><div class="line">    cmp ax,0   ;</div><div class="line">    jne @d     ; 余数不为 0 时跳转</div></pre></td></tr></table></figure>
<p>push dx 表示将 dx 寄存中的值压入栈中。处理器在执行push 指令时，首先将栈指针寄存器 SP 的内容减去操作数的字长（以字节为单位的长度，在 16 位处理器上是2），然后，把要压入栈的数据存放到逻辑地址SS:SP 所指向的内存位置。就8086 处理器来说，因为压入栈的内容必须是字。</p>
<p>很明显，不同于代码段，代码段在处理器上执行时，是由低地址端向高地址端推进的，而压栈操作则正好相反，是从高地址端向低地址端推进的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@a:</div><div class="line">    pop dx            ; 出栈</div><div class="line">    mov [es:di],dl    ; 保存至显存</div><div class="line">    inc di</div><div class="line">    mov byte [es:di],0x07</div><div class="line">    inc di            </div><div class="line">    loop @a            ; cx 中记录了要出栈的次数</div></pre></td></tr></table></figure>
<p>pop dx 指令的功能是将逻辑地址SS:SP 处的一个字弹出到寄存器DX 中，然后将SP 的内容加上操作数的字长（2）</p>
<h2 id="6-8086处理器的寻址方式"><a href="#6-8086处理器的寻址方式" class="headerlink" title="6.8086处理器的寻址方式"></a>6.8086处理器的寻址方式</h2><p>三个示例的实现已经展示完毕，最后我们来总结一下 8086处理器的寻址方式。简单地说，寻址方式就是如何找到要操作的数据，以及如何找到存放操作结果的地方。8086处理器的寻址方式有如下几种：</p>
<ol>
<li>寄存器寻址: <code>mov ax bc</code></li>
<li>立即寻址，指令的操作数是一个立即数: <code>mov bx 0x01</code></li>
<li>内存寻址: 但凡是表示内存地址的，都必须用中括号括起来。<ul>
<li>直接寻址，直接给出偏移地址的具体数值: <code>mv ax [0x5c0f]</code></li>
<li>基址寻址，使用<strong>基址寄存器</strong>BX 或者BP 来提供偏移地址: <ul>
<li><code>mov ax [bx + 2]</code>: 采用基址寄存器BX，默认的段寄存器是DS</li>
<li><code>mov ax [bp - 2]</code>: 采用基址寄存器BP，默认的段寄存器是SS。也就是说，它经常用于访问栈</li>
<li>基址寻址允许在基址寄存器的基础上使用一个偏移量。有时候，这使得它更加灵活</li>
<li>BP + SP 经常用于定位函数调用栈</li>
</ul>
</li>
<li>变址寻址: 类似于基址寻址但使用<strong>变址寄存器</strong>（或称索引寄存器）SI 和 DI 提供偏移地址<ul>
<li><code>mov ax [si + 0x001]</code>: si 和 di 默认的段寄存器是DS</li>
</ul>
</li>
<li>基址变址寻址: 使用一个基址寄存器（BX 或者BP），外加一个变址寄存器（SI 或者DI）提供偏移地址<ul>
<li><code>mov ax [bx + si + 2]</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>下面是一个使用基址变址寻址反转字符串的示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">string </div><div class="line">    db &quot;aaaagedddddgehrahege&quot;</div><div class="line">    mov bx string</div><div class="line">    mov si 0  ;正向索引</div><div class="line">    mov di 20 ;反向索引</div><div class="line"></div><div class="line">order</div><div class="line">    mov ah [bx + si]</div><div class="line">    mov al [bx + di]</div><div class="line">    mov [bx + si] al</div><div class="line">    mov [bx + di] ah</div><div class="line">    inc si</div><div class="line">    dec di</div><div class="line">    cmp si di</div><div class="line">    jl order</div></pre></td></tr></table></figure>
<p>注意，内存访问之所以要区分基址变址，是因为基址只能使用 bx，bp 寄存器，而变址只能使用 si，di 寄存器。</p>

        </div>
        <!--  -->
        <footer class="article-footer">
            



    <a data-url="http://yoursite.com/2021/07/04/assembley/x86/x86_04/" data-id="ckxy3rqo600d78ku9zglgn2me" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2021/07/05/assembley/x86/x86_05/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            5. 用户程序加载程序
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2021/07/03/assembley/x86/x86_03/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">3. x86 汇编环境准备</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/10/17/assembley/link/link_01/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/操作系统/">操作系统</a></p>
                            <p class="item-title"><a href="/2021/10/17/assembley/link/link_01/" class="title">1. 《程序员的自我修养》读书笔记</a></p>
                            <p class="item-date"><time datetime="2021-10-16T16:00:00.000Z" itemprop="datePublished">2021-10-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/11/assembley/x86/x86_11/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/task.png)" alt="11. 任务和特权级保护" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/11/assembley/x86/x86_11/" class="title">11. 任务和特权级保护</a></p>
                            <p class="item-date"><time datetime="2021-07-10T16:00:00.000Z" itemprop="datePublished">2021-07-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/10/assembley/x86/x86_10/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/memory_asign.png)" alt="10. 程序的动态加载和执行" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/10/assembley/x86/x86_10/" class="title">10. 程序的动态加载和执行</a></p>
                            <p class="item-date"><time datetime="2021-07-09T16:00:00.000Z" itemprop="datePublished">2021-07-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/09/assembley/x86/x86_09/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/seg_check.png)" alt="9. 存储器的保护" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/09/assembley/x86/x86_09/" class="title">9. 存储器的保护</a></p>
                            <p class="item-date"><time datetime="2021-07-08T16:00:00.000Z" itemprop="datePublished">2021-07-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/08/assembley/x86/x86_08/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/gdt.png)" alt="8. 进入保护模式" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/08/assembley/x86/x86_08/" class="title">8. 进入保护模式</a></p>
                            <p class="item-date"><time datetime="2021-07-07T16:00:00.000Z" itemprop="datePublished">2021-07-08</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">58</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/存储/">存储</a><span class="category-list-count">58</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">198</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">48</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">29</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">4</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Brendan-Gregg/">Brendan Gregg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML-CSS/">HTML&CSS</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8S/">K8S</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux性能调优/">Linux性能调优</a><span class="tag-list-count">49</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL实战45讲/">MySQL实战45讲</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openstack/">Openstack</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/">Vue</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go并发编程/">go并发编程</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go标准库及第三方库/">go标准库及第三方库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go语言入门/">go语言入门</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wrapt/">wrapt</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/x86-汇编/">x86 汇编</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/入门指南/">入门指南</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/好玩的数据结构与算法/">好玩的数据结构与算法</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据密集型应用/">数据密集型应用</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构与算法/">数据结构与算法</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/极客时间/">极客时间</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/程序员的自我修养/">程序员的自我修养</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马哥-Linux/">马哥 Linux</a><span class="tag-list-count">135</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马哥-MySQL-运维/">马哥 MySQL 运维</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能的MySQL/">高性能的MySQL</a><span class="tag-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Brendan-Gregg/" style="font-size: 10px;">Brendan Gregg</a> <a href="/tags/ES6/" style="font-size: 15.63px;">ES6</a> <a href="/tags/HTML-CSS/" style="font-size: 12.5px;">HTML&CSS</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/K8S/" style="font-size: 10px;">K8S</a> <a href="/tags/Kafka/" style="font-size: 16.25px;">Kafka</a> <a href="/tags/Linux性能调优/" style="font-size: 19.38px;">Linux性能调优</a> <a href="/tags/MySQL实战45讲/" style="font-size: 18.13px;">MySQL实战45讲</a> <a href="/tags/Openstack/" style="font-size: 13.75px;">Openstack</a> <a href="/tags/React/" style="font-size: 15.63px;">React</a> <a href="/tags/Vue/" style="font-size: 15.63px;">Vue</a> <a href="/tags/go并发编程/" style="font-size: 17.5px;">go并发编程</a> <a href="/tags/go标准库及第三方库/" style="font-size: 10.63px;">go标准库及第三方库</a> <a href="/tags/go语言入门/" style="font-size: 14.38px;">go语言入门</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/python/" style="font-size: 11.25px;">python</a> <a href="/tags/wrapt/" style="font-size: 16.88px;">wrapt</a> <a href="/tags/x86-汇编/" style="font-size: 14.38px;">x86 汇编</a> <a href="/tags/入门指南/" style="font-size: 16.25px;">入门指南</a> <a href="/tags/好玩的数据结构与算法/" style="font-size: 11.88px;">好玩的数据结构与算法</a> <a href="/tags/数据密集型应用/" style="font-size: 15.63px;">数据密集型应用</a> <a href="/tags/数据结构与算法/" style="font-size: 18.75px;">数据结构与算法</a> <a href="/tags/极客时间/" style="font-size: 18.13px;">极客时间</a> <a href="/tags/程序员的自我修养/" style="font-size: 10px;">程序员的自我修养</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/马哥-Linux/" style="font-size: 20px;">马哥 Linux</a> <a href="/tags/马哥-MySQL-运维/" style="font-size: 13.13px;">马哥 MySQL 运维</a> <a href="/tags/高性能的MySQL/" style="font-size: 11.88px;">高性能的MySQL</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">讨论区</h3>
        <div class="widget">
            <h4> 联系我 <h4>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2022 宋涛</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'http://yoursite.com/2021/07/04/assembley/x86/x86_04/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
