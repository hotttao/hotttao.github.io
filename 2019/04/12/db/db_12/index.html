<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>12. 流处理系统 | 宋涛的博客</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="数据密集型应用" />
    
    <meta name="description" content="派生数据">
<meta name="keywords" content="数据密集型应用">
<meta property="og:type" content="article">
<meta property="og:title" content="12. 流处理系统">
<meta property="og:url" content="http://yoursite.com/2019/04/12/db/db_12/index.html">
<meta property="og:site_name" content="宋涛的博客">
<meta property="og:description" content="派生数据">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/db/message_log.png">
<meta property="og:updated_time" content="2021-02-25T13:57:16.937Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="12. 流处理系统">
<meta name="twitter:description" content="派生数据">
<meta name="twitter:image" content="http://yoursite.com/images/db/message_log.png">
    

    
        <link rel="alternate" href="/" title="宋涛的博客" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">漫步在大陆上的海龟</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Go/">Go</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Python/">Python</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/分布式/">分布式</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端/">前端</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/存储/">存储</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/操作系统/">操作系统</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/运维/">运维</a></li></ul>
                                    
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/分布式/">分布式</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-db/db_12" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        12. 流处理系统
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2019/04/12/db/db_12/" class="article-date">
            <time datetime="2019-04-11T16:00:00.000Z" itemprop="datePublished">2019-04-12</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/数据密集型应用/">数据密集型应用<span class="tag-count">13</span></a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>派生数据</p>
<a id="more"></a>
<h2 id="1-流处理系统"><a href="#1-流处理系统" class="headerlink" title="1. 流处理系统"></a>1. 流处理系统</h2><p>前面讨论的批处理系统存在一个重要的假设: 输入是有界的，是已知的有限大小，所以批处理知道何时读完他们。比如MapReduce 核心的排序操作必须读取整个输入，然后才开始生成输出。</p>
<p>而实际上，有很多数据是无限的，而且随着时间的推移逐渐到达。数据集永远不会以任何有意义的方式”完成”。而批处理则必须人为将数据划分为固定时间段的数据库分批处理。批处理的问题是，输入的更改只会在一天之后的输出中反映出来。为了更快的响应用户，我们需要完全放弃固定的时间片，每当有事件就开始处理，这就是流处理背后的思想。</p>
<h3 id="1-1-发送事件流"><a href="#1-1-发送事件流" class="headerlink" title="1.1 发送事件流"></a>1.1 发送事件流</h3><p>在流处理的上下文中，记录通常被称为事件，改事件或者说对象，包含某个时间点发生的事件的细节。每个事件通常包含一个时间戳，用于指示事件发生的<strong>墙上时间</strong>。</p>
<p>事件由生产者生成一次，然后可能由多个消费者处理。相关的事件通常被组合成主题或流。为了更低的响应延时，当新事件出现时，最好通知消费者。</p>
<h3 id="1-2-消息系统"><a href="#1-2-消息系统" class="headerlink" title="1.2 消息系统"></a>1.2 消息系统</h3><p>向消费者通知新事件的常见方法是使用消息系统。在这种发布/订阅模式中，不同的系统采用了不同的方法，为了区分这些系统，提出以下两个问题对区分很有帮助:</p>
<ol>
<li>如果生产者发送消息的速度比消费者能处理的快，会发生什么？<ul>
<li>一般有三种选择: 系统丢弃消息；将消息缓存在队列中；激活背压(流量控制，即阻止生产者发送消息)</li>
<li>如果消息被缓存在队列中，那么队列增长时会发生什么非常重要</li>
<li>如果内存无法容纳所有队列，系统是否会崩溃，还是消息会被写入磁盘</li>
<li>如果消息会落盘，又会如何影响消息传递系统的性能</li>
</ul>
</li>
<li>如果节点崩溃或者暂时离线，是否会有消息丢失?<ul>
<li>持久化需要写入磁盘或者结合复制方案，这些都是有成本的</li>
<li>如果能够接受消息丢失，那么同样的硬件上可以获得更高的吞吐量和更低的延迟</li>
</ul>
</li>
</ol>
<p>消息传递有如下几种方式:</p>
<ol>
<li>生产者与消费者之间直接消息传递</li>
<li>消息代理</li>
</ol>
<h4 id="生产者与消费者之间直接消息传递"><a href="#生产者与消费者之间直接消息传递" class="headerlink" title="生产者与消费者之间直接消息传递"></a>生产者与消费者之间直接消息传递</h4><p>这种方式通常要求应用程序意识消息丢失的可能性，它们只支持有限的容错。通常还假定生产者和消费者同时在线。诸如 RPC 和 HTTP 请求，webhooks 都是这种消息传递方式</p>
<h4 id="消息代理"><a href="#消息代理" class="headerlink" title="消息代理"></a>消息代理</h4><p>消息代理本质上是一种针对<strong>处理消息而优化的数据库</strong>。将数据集中在代理上，可以更容易的适应不断变化的客户端。持久性问题被转移到代理。消息写入代理的结果也通常导致<strong>消费以异步方式工作</strong>。</p>
<h4 id="多个消费者"><a href="#多个消费者" class="headerlink" title="多个消费者"></a>多个消费者</h4><p>当多个消费者读取同一主题中的消息时，有两种主要的消息传递模式:</p>
<ol>
<li>负载均衡式: <ul>
<li>每一条消息都只被传递给其中一个消费者，所以消费者可以共享主题中处理消息的工作</li>
<li>通过增加消费者可以并行处理消息</li>
</ul>
</li>
<li>扇出式:<ul>
<li>每条消息都被传递给所有的消费者</li>
<li>独立的消费者独立接收相同的消息广播</li>
</ul>
</li>
</ol>
<p>这两种模式可以组合使用</p>
<h4 id="确认和重传"><a href="#确认和重传" class="headerlink" title="确认和重传"></a>确认和重传</h4><p>消费者可能在未处理完消息时就已经奔溃，为了确保消息不会丢失，消息代理使用<strong>确认</strong>: 客户端必须在处理完消息后显示的告诉代理，以便代理可以将其从队列中移除。</p>
<p>但是消息的确认/重传会导致以下两个问题:</p>
<ol>
<li>消息重复: 确认的消息可能在发送给代理的过程中丢失，导致代理重复发送和消息</li>
<li>消息乱序: 与负载均衡结合时，重传机制不可避免的会导致消息被重新排序，为了避免这个问题，可以为每个消费者使用单独的队列(即不使用负载均衡)</li>
</ol>
<p>注意如果消息之间存在因果依赖关系，消息的顺序就是至关重要的。</p>
<h2 id="2-分区日志"><a href="#2-分区日志" class="headerlink" title="2. 分区日志"></a>2. 分区日志</h2><p>消息代理是基于瞬间的消息传递思想构建的，因此尽管可以永久记录消息，但通常也不会这么做。如果将新的消费者添加到消息系统，通常它只会开始接收在它注册后发送的消息；任何之前的消息已经消失。</p>
<p>那为什么不把数据库的持久存储和消息传递的低延迟结合起来呢？这正是<strong>日志消息代理</strong>背后的思想。</p>
<h3 id="2-1-基于日志的消息存储"><a href="#2-1-基于日志的消息存储" class="headerlink" title="2.1 基于日志的消息存储"></a>2.1 基于日志的消息存储</h3><p>日志是磁盘上一个仅支持追加式修改记录的序列。与日志结构化存储引擎类似，我们可以使用相同结构来实现消息代理:</p>
<ol>
<li>生产者通过将消息追加到日志的末尾来发送消息</li>
<li>消费者通过一次读取日志来接受消息</li>
</ol>
<p>为了提升吞吐量，可以对日志进行分区，在每个分区中，代理为每个消息分配一个单调递增的序列号或偏移量。因为分区日志只能追加，所以分区内的消息是完全有序的。不同分区之间则没有顺序保证。</p>
<p><img src="/images/db/message_log.png" alt="基于日志的消息生产和消费"></p>
<p>kafka、Amazon Kinesis Stream 和 Twitter DistributedLog 都是这种基于日志的消息代理系统。尽管这些消息代理将所有消息写入磁盘，但是通过多台机器进行分区，能够实现每秒数百万条消息的吞吐量，并且通过复制消息实现容错性。</p>
<p>因为多个消费者可以独立读取日志而不相互有影响，而且消息不会从日志中删除，所以基于日志的方法很自然的支持扇出式消息传递。通过将整个分区分配给消费者组中的节点，每一个节点消费一个分区，可以在一组消费者之间实现负责均衡。</p>
<p>通常当消费者被分配了一个日志分区时，它会以直接的单线程方式顺序读取分区中的消息，这种粗粒度的负载均衡有一些缺点:</p>
<ol>
<li>消费者的最大数量等于主题的分区数</li>
<li>如果单个消息处理缓慢，会阻碍分区中后续消息的处理。可以将消息处理扩展至线程池，但这种方法消息的确认和消费者偏移管理变得复杂，通常单线程是优选。</li>
</ol>
<h4 id="对比日志与传统消息系统"><a href="#对比日志与传统消息系统" class="headerlink" title="对比日志与传统消息系统"></a>对比日志与传统消息系统</h4><p>AMQP 类型的消息代理更适合如下场景:</p>
<ul>
<li>消息处理的代价很高，希望在逐个消息的基础上并行处理</li>
<li>而且消息排序又不那么重要的情况下，并且需要在他们处理后返回并在此读取旧消息时 更可取</li>
</ul>
<p>相反，基于日志的消息系统更适用于:</p>
<ul>
<li>在消息吞吐量高，每个消息处理速度快</li>
<li>消息顺序有很重要</li>
<li>需要读取已经确认的旧消息</li>
</ul>
<h4 id="消费者偏移量"><a href="#消费者偏移量" class="headerlink" title="消费者偏移量"></a>消费者偏移量</h4><p>消费者偏移量用于记录消费者已经消费的消息位置，这样就无须跟踪每条消息的确认，减少记录开销。这种偏移量与主从复制数据库中的日志序列号非常相似。</p>
<p>如果消费者节点失败，消费者组中的另一节点将被分配到失败的消费者分区，并以最后记录的偏移量开始使用消息。</p>
<h4 id="磁盘使用"><a href="#磁盘使用" class="headerlink" title="磁盘使用"></a>磁盘使用</h4><p>不断追加的日志，磁盘空间最终会被耗尽。为了回收磁盘空间，日志实际上被分割成段，并不时地将旧段删除或归档保存。实际上，日志实现了一个有限大小的缓冲区，当缓冲区变满时，旧的消息被丢弃，该缓冲区被称为环形缓冲区。由于缓冲区在磁盘上，因此可以非常大。</p>
<h4 id="消费者跟不上生产者时"><a href="#消费者跟不上生产者时" class="headerlink" title="消费者跟不上生产者时"></a>消费者跟不上生产者时</h4><p>一开始我们讨论消费者跟不上生产者发送消息的速度时由三种选择。基于日志的方法是一种缓冲形式，它具有较大但固定大小的缓冲区。因此消费者落后太多，代理将丢弃缓冲区容量不能容纳的旧消息。可以监控消费者落后日志头部的距离，并在落后明显时发出警告。由于缓冲区很大，通常有足够的时间去修复缓慢的消费者，并允许它在开始丢失消息之前赶上。</p>
<p>即便落后太多并开始丢失消息也只有该消费者会受到影响，他不会中断其他消费者的服务。这是基于日志方法的消息代理带来的运营优势。在传统的消息代理中，需要小心删除消费者已经关闭的任何队列，否则他们讲继续不必要的积累消息，并占用其他活动消费者的内存。</p>
<h4 id="重新处理消息"><a href="#重新处理消息" class="headerlink" title="重新处理消息"></a>重新处理消息</h4><p>使用AMQP 风格的消息代理，由于会导致消息在代理上被删除，因此处理和确认操作可视为带有一定破坏性。另一方面基于日志的消息代理中，使用消息更像是从文件读取，并不会更改日志。除了消费者的输出外，唯一的副作用是消费偏移量前移了。但是偏移量在消费者的控制之下，可以轻松对其进行操作了。</p>
<p>这个特点使得基于日志的消息系统更像之前讲的批处理系统过程。派生数据通过可重复的转换过程与输入数据明确分离。支持更多的实验性尝试，也更容易从错误和故障中进行恢复。从而成为集成数据流的不错选择。</p>
<h2 id="3-数据库与流"><a href="#3-数据库与流" class="headerlink" title="3. 数据库与流"></a>3. 数据库与流</h2><p>事件是某个时刻发生的事情的记录，发生的事件可以是用户的操作，当然也可以是写入数据库。<strong>将内容写入数据库的事实</strong>是一个可以<strong>被捕获、存储和处理的事件</strong>。这一观察结果表明，<strong>数据库和数据流</strong>之间的联系比磁盘上<strong>日志的物理存储</strong>更紧密。</p>
<p>实际上<strong>复制日志</strong>是数据库写入事件的流，由主节点在处理事务时生成。从节点将写入流应用于他们自己的数据库副本，从而最终得到相同数据的准确副本。复制日志的事件描述了数据变化。</p>
<p>我们还在全序广播的中讨论了<strong>状态机复制原理</strong>，该原理指出: 如果每个事件代表对数据库的写入，并且每个副本按照相同的顺序处理相同的事件，则所有副本都将收敛于相同的最终状态。</p>
<h3 id="3-1-保持系统同步"><a href="#3-1-保持系统同步" class="headerlink" title="3.1 保持系统同步"></a>3.1 保持系统同步</h3><p>没有一个系统能够满足所有的数据<strong>存储、查询和处理需求</strong>。一个大型应用通常由多个异构系统组成，这些异构系统都有自己的数据副本，以自己的表示方法存储，并针对自己的设计目标优化。由于相同和相关的数据出现在多个不同的地方，因此它们需要保持同步: 如果数据库中的某项更新，则也需要在缓存、搜索引擎、数据仓库中进行更新。</p>
<p>保证异构系统数据同步的一种方法是使用 ETL，即批处理。如果定期的完整数据库转储过于缓慢，有时使用的替代方法是双重写入，由程序代码在数据更改时显示的写入每个系统。但是双重写入有一些严重的问题:</p>
<ol>
<li>因为写入是有不同客户端在并发写请求同时完成的，因此可能存在竞争条件(入下图)</li>
<li>其中一个写入可能成功，而另一个可能失败，确保他们都成功或者失败属于原子提交范畴</li>
</ol>
<p><img src="/images/db/double_write.png" alt="双重写入引发的竞争条件"></p>
<h3 id="3-2-变更捕获"><a href="#3-2-变更捕获" class="headerlink" title="3.2 变更捕获"></a>3.2 变更捕获</h3><p>变更数据捕获(Change Data Capture CDC) 记录了写入数据库的所有更改，兵役可复制到其他系统的形式提取数据。如果在写入时立即将更改作为一种流来发布(更改日志)，其他派生数据系统知识变更流的消费者，只要所有异构系统以相同的顺序应用于更改日志，那么所有异构系统将与数据库匹配。注意数据库系统会保证写入顺序，而在双重写入中并没有任何机制来保证多个客户端对所有系统都具有相同的写入顺序。</p>
<p><img src="/images/db/cdc.png" alt="变更数据捕获"></p>
<h4 id="实现变更数据捕获"><a href="#实现变更数据捕获" class="headerlink" title="实现变更数据捕获"></a>实现变更数据捕获</h4><p>从本质上讲，变更数据捕获使得一个数据库称为主节点(捕获变化的数据库)，并将其他编程从节点。由于基于日志的消息代理保留了消息的顺序，因此它非常适合从源数据库传输更改时间。</p>
<p>解析复制日志一捕获变更数据的好办法。LinkedIn Databus、Facebook Wormhole 和 Yahoo Sherpa 已经大规模部署。Bottled Water 使用解码雨鞋日志的 API 实现了 PostgreSQL 的 CDC，Maxwell 和 Debezinum 通过解析 binlog 为 MySQL 做类似的事情，Mongoriver 读取 MongoDB 的 oplog，Oracle GoldenGate 也提供类似功能。</p>
<p><strong>像消息代理一样，变更数据捕获通常是异步的</strong>: 记录系统不会再提交变更之前等待应用于消费者。这样做的优势是添加缓慢的消费者不会对记录系统产生影响，但是<strong>所有复制滞后问题</strong>在这里全部适用。</p>
<p>越来越多的数据库开始支持将变更流作为标准接口，例如 RethinkDB 支持订阅查询结果发生变化的通知，Firebase 和 CouchDB 的数据同步基于 change feed 并同时提供给应用层，而Meteor 适用 MongoDB oplog 来订阅数据更改消息并更新用户界面。</p>
<p>VoltDB 支持事务以流的形式连续从数据库导出数据。<strong>kafka Connect</strong>致力于将广泛的<strong>数据库系统变更数据采集工具</strong>与kafka 集成。一旦更改事件流汲取到 kafka，它就可以用来更新派生数据系统。</p>
<h2 id="4-事件溯源"><a href="#4-事件溯源" class="headerlink" title="4. 事件溯源"></a>4. 事件溯源</h2><p>事件溯源类似于变更数据捕获，但是它在不同的抽象层次上应用了这个想法。事件溯源类似于编年史数据模型，其小心的区分命令和事件，用户的请求到达时，它最初是一个命令，它必须被验证。如果验证成功，它将变成一个持久且不可变的事件。</p>
<p>与批处理受益于其输入文件的不变形。这种不变形原则也是事件溯源和变更数据捕获如此强大的原因。</p>
<p>我们通常<strong>将数据库看成是用来存储应用程序的当前状态</strong>，这种表示<strong>针对读取进行了优化</strong>。每当状态变卦，改状态就反映了随着时间推移而变化的事件的结果。无论状态如何变化，总有一系列事件导致这些变化。关键思路是可变的状态和不变事件的追加日志不想矛盾。</p>
<p>应用状态是事件流对时间的积分得到的，而变化流式状态对时间求导得到的。</p>
<p>事务日志记录了对数据库所做的所有更改。高速追加式更改日志的唯一方法。从这个角度看，<strong>数据库的内容保存了日志中最新记录值的缓存</strong>。日志是事实，数据库是<strong>日志子集的缓存</strong>。日志压缩则是链接日志和数据库区别的一种方式，它保留每条记录的最新版本，并丢弃被覆盖的版本。通过不可变事件的追加日志，诊断问题和从问题中恢复就要容易得多。</p>
<h3 id="4-1-相同的事件日志派生多个视图"><a href="#4-1-相同的事件日志派生多个视图" class="headerlink" title="4.1 相同的事件日志派生多个视图"></a>4.1 相同的事件日志派生多个视图</h3><p>此外通过从不变事件日志中分离可变状态，可以从相同的时间日志派生出多个面向读取的表示方式。分析型数据库Druid使用这种方式直接从Kafka摄取数据，Pistachio是一个分布式的键值存储，使用Kafka作为提交日志，<strong>Kafka Connect sinks</strong>能将来自Kafka的数据导出到各种不同的数据库与索引。</p>
<p>从事件日志到数据库有一个明确的转换步骤，可以更加容易的随时间来演进应用程序: 如果想要引入一个新的方式呈现现有数据，可以使用事件日志来构建一个单独针对新功能的读取优化视图，并与现有的系统一起运行，而不要修改它们。</p>
<p>如果不必担心如何去查询和访问数据，那么存储数据通常是非常简单的。<strong>模式设计、索引和存储引擎的许多复杂性</strong>多是源于<strong>希望支持某些查询和访问模式</strong>。因此将数据写入形式与读取形式分开，并允许多个不同的读取视图，可以获得更大的灵活性。这个想法有时被称为<strong>命令查询责任分离</strong>。</p>
<p>数据库和模式设计的传统方法是基于<strong>数据查询和数据写入的形式必须相同这一谬误</strong>。如果可以将数据从针对写入优化的事件日志转换为针对读取优化的应用状态，那么有关规范化和非规范化的争论就变得无关紧要了（参阅“多对一和多对多的关系”）：由于<strong>转换过程提供了响应机制使其与源事件日志保持一致</strong>，因此在度优化的视图中对数据进行反规范化处理完全合理的。</p>
<h3 id="4-2-不可变的限制"><a href="#4-2-不可变的限制" class="headerlink" title="4.2 不可变的限制"></a>4.2 不可变的限制</h3><p>事件捕获和变更数据捕获的最大缺点是<strong>事件日志的消费者是异步的</strong>，所有用户可能会写入日志，然后日志派生的视图中读取，却发现这些写操作还没有反应在读取视图中。</p>
<p>此外对于频换变化的数据集，保留所有变化的历史是不可行的，碎片化也可能称为一个问题，并且压缩和垃圾回收的性能对于运维的健壮性变得至关重要。</p>
<p>除了性能，还可能在某些情况下，由于监管方面的原因需要删除数据，尽管要求这些数据都是不可变的。比如法规要求用户关闭账户后必须删除个人所有数据。在这种情况下，标记删除是明显不够的。真正的删除数据反而会变得非常困难，因为数据副本可能在很多地方都有。</p>
<h2 id="5-流处理"><a href="#5-流处理" class="headerlink" title="5. 流处理"></a>5. 流处理</h2><p>前面我们已经讨论了<strong>流的来源</strong>，讨论了<strong>流是如何传输的</strong>，接下来我们要讨论的是: 有了流之后，可以用它来做什么，即怎么处理它，通常有三种选择:</p>
<ol>
<li>数据同步: 将数据写入数据库，缓存，搜索引擎等其他异构系统</li>
<li>通过某种方式推送给用户</li>
<li>处理一个或多个输入流以产生一个或多个输出流</li>
</ol>
<p>接下来我们将讨论选项3: 处理流以产生其他派生流。它与前面讨论 MapReduce 密切相关，并且数据流的模式是类似的: 流处理器以只读的方式接收输入流，并以仅追加方式将处理输出写入新的位置。流与批量作业的一个关键区别是，流不会结束。这种差别有很多含义:</p>
<ol>
<li>排序对无界数据集没有意义，因此不能使用排序合并 join </li>
<li>容错机制必须改变: 对于已经运行了几分钟的批处理作业，可以简单从头开始重新执行，但是对于运行了好几年的流处理作业，重新执行几乎不可能</li>
</ol>
<h3 id="5-1-流处理的适用场景"><a href="#5-1-流处理的适用场景" class="headerlink" title="5.1 流处理的适用场景"></a>5.1 流处理的适用场景</h3><p>流长期以来一直被用于监控目的，随着时间推移也出现了如下的新用途:</p>
<ol>
<li>复杂事件处理: </li>
<li>流分析: 按照一个时间窗口对数据进行聚合操作</li>
<li>维护物化视图: 变更数据捕获来保持不同数据系统间的数据同步</li>
<li>在流上搜索</li>
<li>消息传递和 RPC</li>
</ol>
<h3 id="5-2-流的时间问题"><a href="#5-2-流的时间问题" class="headerlink" title="5.2 流的时间问题"></a>5.2 流的时间问题</h3><p>流处理系统经常需要和时间打交道:</p>
<ol>
<li>许多流处理框架使用处理节点上的本地系统时钟(处理时间)来确定窗口，但这个有效的前提是事件发生和事件处理的间隔可以忽略不计，然而显著滞后的情况也时有发生。</li>
</ol>
<h4 id="事件时间和处理时间"><a href="#事件时间和处理时间" class="headerlink" title="事件时间和处理时间"></a>事件时间和处理时间</h4><p>事件处理时间比发生时间滞后的原因有很多，例如排队、网络故障、重启动消费者、重新处理过去的事件等等。而且消息延迟还可能导致<strong>消息的不可预知排序</strong>。<strong>混淆事件发生时间和处理会导致错误的结果</strong>。</p>
<h4 id="什么时候准备就绪"><a href="#什么时候准备就绪" class="headerlink" title="什么时候准备就绪"></a>什么时候准备就绪</h4><p>如果基于事件发生时间而定义窗口，面临一个棘手的问题是，你无法确定<strong>什么时候能收到特定窗口内的所有事件</strong>，或者<strong>是否还有一些事件尚未到来</strong>。由于网络中断和延迟，可能某些发生的事件还缓存在另一台机器上。需要能够处理<strong>在窗口已经声明完成后才到达的这样的滞后事件</strong>。大体上行有两种选择:</p>
<ol>
<li>忽略这些滞后事件</li>
<li>发布一个更正: 针对滞后事件的一个更新值</li>
</ol>
<h4 id="你用谁的时间"><a href="#你用谁的时间" class="headerlink" title="你用谁的时间"></a>你用谁的时间</h4><p>当事件可能在系统的多个点缓冲时，为事件分配事件比较困难。考虑一个可离线使用的应用:</p>
<ol>
<li>事件可能在本地离线缓存，在下一次连接网络时被发送至服务器。这时事件的时间戳实际上指的是发生交互时的时间，然后用户设备上的时间通常是不可信的</li>
<li>服务器收到事件的时间可能更准确，但在描述用户交互方面的意义不大</li>
</ol>
<p>为了调整不正确的设备时钟，一种方法是记录三个时间戳:</p>
<ol>
<li>根据设备的时钟，记录事件发生的时间</li>
<li>根据设备的时钟，记录事件发送到服务器的时间</li>
<li>根据服务器时钟，记录服务器收到事件的时间</li>
</ol>
<p>3-2 可以估计出设备和服务器时钟之间的偏移量，从而估算出事件实际发生的时间。</p>
<h3 id="5-3-窗口类型"><a href="#5-3-窗口类型" class="headerlink" title="5.3 窗口类型"></a>5.3 窗口类型</h3><p>一旦明确了如何确定事件的时间戳，下一步就是决定如何定义时间段即窗口，有如下几种常见的窗口类型:</p>
<ol>
<li>轮转窗口: 翻滚窗口的长度固定，每一个事件都属于一个窗口</li>
<li>跳跃窗口: 跳跃窗口也有固定长度，但允许窗口重叠以提供一些平滑过渡</li>
<li>滑动窗口： 滑动窗口包含在彼此的某个时间间隔内的所有事件</li>
<li>会话窗口：没有固定的持续时间，通过将同一用户在时间上机密相关的所有事件分组在一起而定义</li>
</ol>
<h3 id="5-3-流式-join"><a href="#5-3-流式-join" class="headerlink" title="5.3 流式 join"></a>5.3 流式 join</h3><p>因为流的无界，以及新事件随时可能出现在流中，使得流式join比批处理作业更具挑战性，我们区分了三种不同类型的join:</p>
<ol>
<li>流与流join</li>
<li>流与表join</li>
<li>表与表join</li>
</ol>
<h4 id="流与流join"><a href="#流与流join" class="headerlink" title="流与流join"></a>流与流join</h4><h4 id="流与表join"><a href="#流与表join" class="headerlink" title="流与表join"></a>流与表join</h4><h4 id="表与表join"><a href="#表与表join" class="headerlink" title="表与表join"></a>表与表join</h4><p>这三种类型的 join 有很多相似之处，它们都需要流处理系统根据一个 join 输入 来维护某些状态，并在来自另一个 join 输入的消息上查询状态。</p>
<p>维持这个状态的事件的顺序非常关键。在分区日志中单个分区内的事件顺序被保留，但是通常不同流或分区之间没有排序保证。这就产生一个问题: <strong>如果不同流中的事件发生在相近的时间里，它们按照何种顺序进行处理</strong>。在流与表的join 中，如果用户更新了资料，哪些活动事件会与旧资料join，哪些又与新资料join。换句话说，如果状态随时间改变，join 操作需要输入状态信息，那么应该使用什么时间点的状态来 join 呢？</p>
<p>如果垮流的时间排序是不确定的，那么 join 也变成非确定性的。这意味着<strong>不能在相同的输入上重新运行同一作业来得到相同的结果</strong>: 因为再次运行任务时，输入流上的事件可能以不同的方式交叉在一起。</p>
<h3 id="5-4-流处理容错"><a href="#5-4-流处理容错" class="headerlink" title="5.4 流处理容错"></a>5.4 流处理容错</h3><p>流处理面临和批处理一样失败任务重试的问题。但是处理起来并不简单: 流处理无法像批处理一样，在使输出结果可见之前等待某个任务完成，因为流是无限的，因此几乎永远无法完成这个任务。</p>
<h4 id="微批处理和校验点"><a href="#微批处理和校验点" class="headerlink" title="微批处理和校验点"></a>微批处理和校验点</h4><p>一种解决方案是将流分解成多个小块，冰箱小型批处理一样处理每个块。这种方法称为微批处理，已经用于 SparkStreaming。批处理大小通常约为 1s，这是一个折中的考虑:</p>
<ol>
<li>较小的批处理会导致更大的调度和协调开销</li>
<li>较大的批处理意味着流处理器的结果需要更长的延迟才能看见</li>
</ol>
<p>微批处理隐含的设置了与批处理大小相等的轮转窗口(基于处理时间而不是事件时间)。任何需要更大窗口的作业都需要显示的将状态从一个微批处理保留至下一个微批处理。</p>
<p>Apache Flink 中使用了该方法的一个变体，它定期生成状态滚动检查点并将其写入持久化存储。如果流操作发生崩溃，他可以从最近的检查点重新启动，并丢弃检查点和崩溃之间的所有输出。检查点由消息流中的barrier 触发，类似于微批处理的边界，但不强制特定的窗口大小。</p>
<p>在流处理框架内，微批处理和检查点提供了与批处理一样的恰好一次语义，但是一旦输出脱离了流处理系统，框架将无法丢失失败批处理的输出。</p>
<p>微批处理存在处理之后消息和跨批量边界的窗口等问题。</p>
<h4 id="重新审视原子提交"><a href="#重新审视原子提交" class="headerlink" title="重新审视原子提交"></a>重新审视原子提交</h4><p>在出现故障时，为了看起来实现<strong>恰好一次</strong>语义，我们需要确保当且仅当处理成功时，所有输出和副作用才生效。这包括发送给下游的操作和外部消息传递系统的任何消息。所有数据库写入，以及对操作状态的更改和任何对输入消息的确认。</p>
<p>这些事要么原子的发生，要么都不发生，我们在之前分布式事务和共识中已经有所讨论。</p>
<h4 id="幂等性"><a href="#幂等性" class="headerlink" title="幂等性"></a>幂等性</h4><p>我们的目标是<strong>丢弃任何失败的部分输出</strong>，以便可以安全的重试而不会两次生效。分布式事务是实现的一种方式，另一种方式则是依赖幂等性。即使操作本身不具有幂等，往往也可以使用一些额外的元数据(唯一键)使其变得幂等。</p>
<p>依赖幂等性意味着基于一些假设: 重启失败的任务必须以相同的顺序重新处理相同的消息，处理必须是确定的，<strong>并且没有其他节点并发更新相同的值</strong>。</p>
<p><strong>任何需要状态的流处理，都必须确保在故障发生后状态可以恢复</strong>。有两种选择:</p>
<ol>
<li>将状态保存在远程存储中并采取复制，然而为每个消息去查询远程数据库可能会很慢</li>
<li>将状态保存在本地，并定期进行复制</li>
</ol>
<p>当流处理器从故障中恢复时，新任务可以读取副本并在不丢失数据的情况下恢复处理。在某些情况下，甚至可能不需要复制状态，而是从输入流开始重建。</p>
<p>所有权衡取决于底层基础架构的性能表现，网络延迟和磁盘访问延迟，网络带宽和磁盘带宽到底谁大，都是需要权衡的因素。</p>

        </div>
        <!--  -->
        <footer class="article-footer">
            



    <a data-url="http://yoursite.com/2019/04/12/db/db_12/" data-id="ckxy3rqf4004k8ku94ant1yte" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2019/04/13/db/db_100/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            13. 数据系统的未来
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2019/04/11/db/db_11/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">11. 批处理系统</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/10/17/assembley/link/link_01/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/操作系统/">操作系统</a></p>
                            <p class="item-title"><a href="/2021/10/17/assembley/link/link_01/" class="title">1. 《程序员的自我修养》读书笔记</a></p>
                            <p class="item-date"><time datetime="2021-10-16T16:00:00.000Z" itemprop="datePublished">2021-10-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/11/assembley/x86/x86_11/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/task.png)" alt="11. 任务和特权级保护" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/11/assembley/x86/x86_11/" class="title">11. 任务和特权级保护</a></p>
                            <p class="item-date"><time datetime="2021-07-10T16:00:00.000Z" itemprop="datePublished">2021-07-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/10/assembley/x86/x86_10/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/memory_asign.png)" alt="10. 程序的动态加载和执行" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/10/assembley/x86/x86_10/" class="title">10. 程序的动态加载和执行</a></p>
                            <p class="item-date"><time datetime="2021-07-09T16:00:00.000Z" itemprop="datePublished">2021-07-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/09/assembley/x86/x86_09/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/seg_check.png)" alt="9. 存储器的保护" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/09/assembley/x86/x86_09/" class="title">9. 存储器的保护</a></p>
                            <p class="item-date"><time datetime="2021-07-08T16:00:00.000Z" itemprop="datePublished">2021-07-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/07/08/assembley/x86/x86_08/" class="thumbnail">
    
    
        <span style="background-image:url(/images/assembly/gdt.png)" alt="8. 进入保护模式" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Go/">Go</a></p>
                            <p class="item-title"><a href="/2021/07/08/assembley/x86/x86_08/" class="title">8. 进入保护模式</a></p>
                            <p class="item-date"><time datetime="2021-07-07T16:00:00.000Z" itemprop="datePublished">2021-07-08</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">58</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/存储/">存储</a><span class="category-list-count">58</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">198</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">48</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">29</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">4</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Brendan-Gregg/">Brendan Gregg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML-CSS/">HTML&CSS</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8S/">K8S</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux性能调优/">Linux性能调优</a><span class="tag-list-count">49</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL实战45讲/">MySQL实战45讲</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openstack/">Openstack</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/">Vue</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go并发编程/">go并发编程</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go标准库及第三方库/">go标准库及第三方库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go语言入门/">go语言入门</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wrapt/">wrapt</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/x86-汇编/">x86 汇编</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/入门指南/">入门指南</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/好玩的数据结构与算法/">好玩的数据结构与算法</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据密集型应用/">数据密集型应用</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构与算法/">数据结构与算法</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/极客时间/">极客时间</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/程序员的自我修养/">程序员的自我修养</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马哥-Linux/">马哥 Linux</a><span class="tag-list-count">135</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马哥-MySQL-运维/">马哥 MySQL 运维</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能的MySQL/">高性能的MySQL</a><span class="tag-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Brendan-Gregg/" style="font-size: 10px;">Brendan Gregg</a> <a href="/tags/ES6/" style="font-size: 15.63px;">ES6</a> <a href="/tags/HTML-CSS/" style="font-size: 12.5px;">HTML&CSS</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/K8S/" style="font-size: 10px;">K8S</a> <a href="/tags/Kafka/" style="font-size: 16.25px;">Kafka</a> <a href="/tags/Linux性能调优/" style="font-size: 19.38px;">Linux性能调优</a> <a href="/tags/MySQL实战45讲/" style="font-size: 18.13px;">MySQL实战45讲</a> <a href="/tags/Openstack/" style="font-size: 13.75px;">Openstack</a> <a href="/tags/React/" style="font-size: 15.63px;">React</a> <a href="/tags/Vue/" style="font-size: 15.63px;">Vue</a> <a href="/tags/go并发编程/" style="font-size: 17.5px;">go并发编程</a> <a href="/tags/go标准库及第三方库/" style="font-size: 10.63px;">go标准库及第三方库</a> <a href="/tags/go语言入门/" style="font-size: 14.38px;">go语言入门</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/python/" style="font-size: 11.25px;">python</a> <a href="/tags/wrapt/" style="font-size: 16.88px;">wrapt</a> <a href="/tags/x86-汇编/" style="font-size: 14.38px;">x86 汇编</a> <a href="/tags/入门指南/" style="font-size: 16.25px;">入门指南</a> <a href="/tags/好玩的数据结构与算法/" style="font-size: 11.88px;">好玩的数据结构与算法</a> <a href="/tags/数据密集型应用/" style="font-size: 15.63px;">数据密集型应用</a> <a href="/tags/数据结构与算法/" style="font-size: 18.75px;">数据结构与算法</a> <a href="/tags/极客时间/" style="font-size: 18.13px;">极客时间</a> <a href="/tags/程序员的自我修养/" style="font-size: 10px;">程序员的自我修养</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/马哥-Linux/" style="font-size: 20px;">马哥 Linux</a> <a href="/tags/马哥-MySQL-运维/" style="font-size: 13.13px;">马哥 MySQL 运维</a> <a href="/tags/高性能的MySQL/" style="font-size: 11.88px;">高性能的MySQL</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">讨论区</h3>
        <div class="widget">
            <h4> 联系我 <h4>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2022 宋涛</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'http://yoursite.com/2019/04/12/db/db_12/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
